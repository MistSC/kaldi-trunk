<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kaldi: Intermediate-level functions used in building the tree</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <td id="projectlogo"><a href="http://kaldi-asr.org/"><img alt="Logo" src="KaldiTextAndLogoSmall.png"/ style="padding: 3px 5px 1px 5px"></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">Kaldi
   </div>
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief" style="display:none"></div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__tree__group__intermediate.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Intermediate-level functions used in building the tree<div class="ingroups"><a class="el" href="group__tree__group.html">Modules involved in tree building</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>These functions are are used in top-level tree-building code (<a class="el" href="group__tree__group__top.html">Top-level tree-building functions</a>); see <a class="el" href="tree_internals.html">Decision tree internals</a> for documentation.  
<a href="#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for Intermediate-level functions used in building the tree:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__tree__group__intermediate.png" border="0" alt="" usemap="#group____tree____group____intermediate"/>
<map name="group____tree____group____intermediate" id="group____tree____group____intermediate">
<area shape="rect" id="node2" href="group__tree__group.html" title="See. " alt="" coords="5,11,152,53"/></map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga99ffe41731f87e233abaaf5087773f61"><td class="memItemLeft" align="right" valign="top">EventMap *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tree__group__intermediate.html#ga99ffe41731f87e233abaaf5087773f61">TrivialTree</a> (int32 *num_leaves)</td></tr>
<tr class="memdesc:ga99ffe41731f87e233abaaf5087773f61"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns a tree with just one node.  <a href="#ga99ffe41731f87e233abaaf5087773f61">More...</a><br/></td></tr>
<tr class="separator:ga99ffe41731f87e233abaaf5087773f61"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga48de6ffb976fe28a9acfed11af8783f9"><td class="memItemLeft" align="right" valign="top">EventMap *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tree__group__intermediate.html#ga48de6ffb976fe28a9acfed11af8783f9">DoTableSplit</a> (const EventMap &amp;orig, EventKeyType key, const BuildTreeStatsType &amp;stats, int32 *num_leaves)</td></tr>
<tr class="memdesc:ga48de6ffb976fe28a9acfed11af8783f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">DoTableSplit does a complete split on this key (e.g.  <a href="#ga48de6ffb976fe28a9acfed11af8783f9">More...</a><br/></td></tr>
<tr class="separator:ga48de6ffb976fe28a9acfed11af8783f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4792f64d66cd9846376de3e58cabe482"><td class="memItemLeft" align="right" valign="top">EventMap *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tree__group__intermediate.html#ga4792f64d66cd9846376de3e58cabe482">DoTableSplitMultiple</a> (const EventMap &amp;orig, const std::vector&lt; EventKeyType &gt; &amp;keys, const BuildTreeStatsType &amp;stats, int32 *num_leaves)</td></tr>
<tr class="memdesc:ga4792f64d66cd9846376de3e58cabe482"><td class="mdescLeft">&#160;</td><td class="mdescRight">DoTableSplitMultiple does a complete split on all the keys, in order from keys[0], keys[1] and so on.  <a href="#ga4792f64d66cd9846376de3e58cabe482">More...</a><br/></td></tr>
<tr class="separator:ga4792f64d66cd9846376de3e58cabe482"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga61b77a16e20b9438c1e523bea73e7c21"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tree__group__intermediate.html#ga61b77a16e20b9438c1e523bea73e7c21">ClusterEventMapGetMapping</a> (const EventMap &amp;e_in, const BuildTreeStatsType &amp;stats, BaseFloat thresh, std::vector&lt; EventMap * &gt; *mapping)</td></tr>
<tr class="memdesc:ga61b77a16e20b9438c1e523bea73e7c21"><td class="mdescLeft">&#160;</td><td class="mdescRight">"ClusterEventMapGetMapping" clusters the leaves of the <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a>, with "thresh" a delta-likelihood threshold to control how many leaves we combine (might be the same as the delta-like threshold used in splitting.  <a href="#ga61b77a16e20b9438c1e523bea73e7c21">More...</a><br/></td></tr>
<tr class="separator:ga61b77a16e20b9438c1e523bea73e7c21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1b9fb1772db76d08aa37f00c9eb47e5e"><td class="memItemLeft" align="right" valign="top">EventMap *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tree__group__intermediate.html#ga1b9fb1772db76d08aa37f00c9eb47e5e">ClusterEventMap</a> (const EventMap &amp;e_in, const BuildTreeStatsType &amp;stats, BaseFloat thresh, int32 *num_removed)</td></tr>
<tr class="memdesc:ga1b9fb1772db76d08aa37f00c9eb47e5e"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is as ClusterEventMapGetMapping but a more convenient interface that exposes less of the internals.  <a href="#ga1b9fb1772db76d08aa37f00c9eb47e5e">More...</a><br/></td></tr>
<tr class="separator:ga1b9fb1772db76d08aa37f00c9eb47e5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5e0a77980515ac6ac5d28454a889e4f2"><td class="memItemLeft" align="right" valign="top">EventMap *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tree__group__intermediate.html#ga5e0a77980515ac6ac5d28454a889e4f2">ClusterEventMapRestrictedByKeys</a> (const EventMap &amp;e_in, const BuildTreeStatsType &amp;stats, BaseFloat thresh, const std::vector&lt; EventKeyType &gt; &amp;keys, int32 *num_removed)</td></tr>
<tr class="memdesc:ga5e0a77980515ac6ac5d28454a889e4f2"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is as ClusterEventMap, but first splits the stats on the keys specified in "keys" (e.g.  <a href="#ga5e0a77980515ac6ac5d28454a889e4f2">More...</a><br/></td></tr>
<tr class="separator:ga5e0a77980515ac6ac5d28454a889e4f2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf574b973abbfd92e5c789f7d6821f19f"><td class="memItemLeft" align="right" valign="top">EventMap *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tree__group__intermediate.html#gaf574b973abbfd92e5c789f7d6821f19f">ClusterEventMapRestrictedByMap</a> (const EventMap &amp;e_in, const BuildTreeStatsType &amp;stats, BaseFloat thresh, const EventMap &amp;e_restrict, int32 *num_removed)</td></tr>
<tr class="memdesc:gaf574b973abbfd92e5c789f7d6821f19f"><td class="mdescLeft">&#160;</td><td class="mdescRight">This version of ClusterEventMapRestricted restricts the clustering to only allow things that "e_restrict" maps to the same value to be clustered together.  <a href="#gaf574b973abbfd92e5c789f7d6821f19f">More...</a><br/></td></tr>
<tr class="separator:gaf574b973abbfd92e5c789f7d6821f19f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf37866e2792ecbd810617da2577e41d8"><td class="memItemLeft" align="right" valign="top">EventMap *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tree__group__intermediate.html#gaf37866e2792ecbd810617da2577e41d8">RenumberEventMap</a> (const EventMap &amp;e_in, int32 *num_leaves)</td></tr>
<tr class="memdesc:gaf37866e2792ecbd810617da2577e41d8"><td class="mdescLeft">&#160;</td><td class="mdescRight">RenumberEventMap [intended to be used after calling ClusterEventMap] renumbers an <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a> so its leaves are consecutive.  <a href="#gaf37866e2792ecbd810617da2577e41d8">More...</a><br/></td></tr>
<tr class="separator:gaf37866e2792ecbd810617da2577e41d8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9de82568c2869cba7854e3c954d905cd"><td class="memItemLeft" align="right" valign="top">EventMap *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tree__group__intermediate.html#ga9de82568c2869cba7854e3c954d905cd">MapEventMapLeaves</a> (const EventMap &amp;e_in, const std::vector&lt; int32 &gt; &amp;mapping)</td></tr>
<tr class="memdesc:ga9de82568c2869cba7854e3c954d905cd"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function remaps the event-map leaves using this mapping, indexed by the number at leaf.  <a href="#ga9de82568c2869cba7854e3c954d905cd">More...</a><br/></td></tr>
<tr class="separator:ga9de82568c2869cba7854e3c954d905cd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga495ab0f2b490051b68a93c11d5878331"><td class="memItemLeft" align="right" valign="top">EventMap *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tree__group__intermediate.html#ga495ab0f2b490051b68a93c11d5878331">ShareEventMapLeaves</a> (const EventMap &amp;e_in, EventKeyType key, std::vector&lt; std::vector&lt; EventValueType &gt; &gt; &amp;values, int32 *num_leaves)</td></tr>
<tr class="memdesc:ga495ab0f2b490051b68a93c11d5878331"><td class="mdescLeft">&#160;</td><td class="mdescRight">ShareEventMapLeaves performs a quite specific function that allows us to generate trees where, for a certain list of phones, and for all states in the phone, all the pdf's are shared.  <a href="#ga495ab0f2b490051b68a93c11d5878331">More...</a><br/></td></tr>
<tr class="separator:ga495ab0f2b490051b68a93c11d5878331"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa4da1fcb3f12d5c116948d37448d9e46"><td class="memItemLeft" align="right" valign="top">EventMap *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tree__group__intermediate.html#gaa4da1fcb3f12d5c116948d37448d9e46">SplitDecisionTree</a> (const EventMap &amp;orig, const BuildTreeStatsType &amp;stats, Questions &amp;qcfg, BaseFloat thresh, int32 max_leaves,int32 *num_leaves, BaseFloat *objf_impr_out, BaseFloat *smallest_split_change_out)</td></tr>
<tr class="memdesc:gaa4da1fcb3f12d5c116948d37448d9e46"><td class="mdescLeft">&#160;</td><td class="mdescRight">Does a decision-tree split at the leaves of an <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a>.  <a href="#gaa4da1fcb3f12d5c116948d37448d9e46">More...</a><br/></td></tr>
<tr class="separator:gaa4da1fcb3f12d5c116948d37448d9e46"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga32fb7c47bd1abc95a1dbd06839ed143a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tree__group__intermediate.html#ga32fb7c47bd1abc95a1dbd06839ed143a">CreateRandomQuestions</a> (const BuildTreeStatsType &amp;stats, int32 num_quest, Questions *cfg_out)</td></tr>
<tr class="memdesc:ga32fb7c47bd1abc95a1dbd06839ed143a"><td class="mdescLeft">&#160;</td><td class="mdescRight">CreateRandomQuestions will initialize a <a class="el" href="classkaldi_1_1Questions.html" title="This class defines, for each EventKeyType, a set of initial questions that it tries and also a number...">Questions</a> randomly, in a reasonable way [for testing purposes, or when hand-designed questions are not available].  <a href="#ga32fb7c47bd1abc95a1dbd06839ed143a">More...</a><br/></td></tr>
<tr class="separator:ga32fb7c47bd1abc95a1dbd06839ed143a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gadee0a1252d3f117baa58bc77a2f8d807"><td class="memItemLeft" align="right" valign="top">BaseFloat&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tree__group__intermediate.html#gadee0a1252d3f117baa58bc77a2f8d807">FindBestSplitForKey</a> (const BuildTreeStatsType &amp;stats, const Questions &amp;qcfg, EventKeyType key, std::vector&lt; EventValueType &gt; *yes_set)</td></tr>
<tr class="memdesc:gadee0a1252d3f117baa58bc77a2f8d807"><td class="mdescLeft">&#160;</td><td class="mdescRight">FindBestSplitForKey is a function used in DoDecisionTreeSplit.  <a href="#gadee0a1252d3f117baa58bc77a2f8d807">More...</a><br/></td></tr>
<tr class="separator:gadee0a1252d3f117baa58bc77a2f8d807"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga7e642ce32f4019c2987e0a168445c1ff"><td class="memItemLeft" align="right" valign="top">EventMap *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__tree__group__intermediate.html#ga7e642ce32f4019c2987e0a168445c1ff">GetStubMap</a> (int32 P, const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;phone_sets, const std::vector&lt; int32 &gt; &amp;phone2num_pdf_classes, const std::vector&lt; bool &gt; &amp;share_roots,int32 *num_leaves)</td></tr>
<tr class="memdesc:ga7e642ce32f4019c2987e0a168445c1ff"><td class="mdescLeft">&#160;</td><td class="mdescRight">GetStubMap is used in tree-building functions to get the initial to-states map, before the decision-tree-building process.  <a href="#ga7e642ce32f4019c2987e0a168445c1ff">More...</a><br/></td></tr>
<tr class="separator:ga7e642ce32f4019c2987e0a168445c1ff"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>These functions are are used in top-level tree-building code (<a class="el" href="group__tree__group__top.html">Top-level tree-building functions</a>); see <a class="el" href="tree_internals.html">Decision tree internals</a> for documentation. </p>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga1b9fb1772db76d08aa37f00c9eb47e5e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EventMap * ClusterEventMap </td>
          <td>(</td>
          <td class="paramtype">const EventMap &amp;&#160;</td>
          <td class="paramname"><em>e_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const BuildTreeStatsType &amp;&#160;</td>
          <td class="paramname"><em>stats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BaseFloat&#160;</td>
          <td class="paramname"><em>thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_removed</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This is as ClusterEventMapGetMapping but a more convenient interface that exposes less of the internals. </p>
<p>It uses a bottom-up clustering to combine the leaves, until the log-likelihood decrease from combinging two leaves exceeds the threshold. </p>

<p>Definition at line <a class="el" href="build-tree-utils_8cc_source.html#l00699">699</a> of file <a class="el" href="build-tree-utils_8cc_source.html">build-tree-utils.cc</a>.</p>

<p>References <a class="el" href="build-tree-utils_8cc_source.html#l00599">kaldi::ClusterEventMapGetMapping()</a>, <a class="el" href="classkaldi_1_1EventMap.html#a6b4a37746dabb0f5ffb448433a128d34">EventMap::Copy()</a>, and <a class="el" href="stl-utils_8h_source.html#l00198">kaldi::DeletePointers()</a>.</p>

<p>Referenced by <a class="el" href="build-tree-utils-test_8cc_source.html#l00376">kaldi::TestClusterEventMap()</a>, and <a class="el" href="build-tree-utils-test_8cc_source.html#l00437">kaldi::TestClusterEventMapRestricted()</a>.</p>
<div class="fragment"><div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;                                                                    {</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  std::vector&lt;EventMap*&gt; mapping;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> num_removed = <a class="code" href="group__tree__group__intermediate.html#ga61b77a16e20b9438c1e523bea73e7c21">ClusterEventMapGetMapping</a>(e_in, stats, thresh, &amp;mapping);</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  EventMap *ans = e_in.Copy(mapping);</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;  <a class="code" href="namespacekaldi.html#a93a4038983f8cd71e343b85f1d117cac">DeletePointers</a>(&amp;mapping);</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;  <span class="keywordflow">if</span> (num_removed_ptr != NULL) *num_removed_ptr = num_removed;</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;  <span class="keywordflow">return</span> ans;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;}</div>
<div class="ttc" id="group__tree__group__intermediate_html_ga61b77a16e20b9438c1e523bea73e7c21"><div class="ttname"><a href="group__tree__group__intermediate.html#ga61b77a16e20b9438c1e523bea73e7c21">kaldi::ClusterEventMapGetMapping</a></div><div class="ttdeci">int ClusterEventMapGetMapping(const EventMap &amp;e_in, const BuildTreeStatsType &amp;stats, BaseFloat thresh, std::vector&lt; EventMap * &gt; *mapping)</div><div class="ttdoc">&quot;ClusterEventMapGetMapping&quot; clusters the leaves of the EventMap, with &quot;thresh&quot; a delta-likelihood thr...</div><div class="ttdef"><b>Definition:</b> <a href="build-tree-utils_8cc_source.html#l00599">build-tree-utils.cc:599</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab7903878916593daecbeb95b98115ab0"><div class="ttname"><a href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">kaldi::int32</a></div><div class="ttdeci">int32_t int32</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00047">kaldi-types.h:47</a></div></div>
<div class="ttc" id="namespacekaldi_html_a93a4038983f8cd71e343b85f1d117cac"><div class="ttname"><a href="namespacekaldi.html#a93a4038983f8cd71e343b85f1d117cac">kaldi::DeletePointers</a></div><div class="ttdeci">void DeletePointers(std::vector&lt; A * &gt; *v)</div><div class="ttdoc">Deletes any non-NULL pointers in the vector v, and sets the corresponding entries of v to NULL...</div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00198">stl-utils.h:198</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga61b77a16e20b9438c1e523bea73e7c21"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int ClusterEventMapGetMapping </td>
          <td>(</td>
          <td class="paramtype">const EventMap &amp;&#160;</td>
          <td class="paramname"><em>e_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const BuildTreeStatsType &amp;&#160;</td>
          <td class="paramname"><em>stats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BaseFloat&#160;</td>
          <td class="paramname"><em>thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; EventMap * &gt; *&#160;</td>
          <td class="paramname"><em>mapping</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>"ClusterEventMapGetMapping" clusters the leaves of the <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a>, with "thresh" a delta-likelihood threshold to control how many leaves we combine (might be the same as the delta-like threshold used in splitting. </p>

<p>Definition at line <a class="el" href="build-tree-utils_8cc_source.html#l00599">599</a> of file <a class="el" href="build-tree-utils_8cc_source.html">build-tree-utils.cc</a>.</p>

<p>References <a class="el" href="cluster-utils_8cc_source.html#l00407">kaldi::ClusterBottomUp()</a>, <a class="el" href="stl-utils_8h_source.html#l00198">kaldi::DeletePointers()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00143">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00166">KALDI_VLOG</a>, <a class="el" href="kaldi-error_8h_source.html#l00162">KALDI_WARN</a>, <a class="el" href="build-tree-utils_8cc_source.html#l00172">kaldi::SplitStatsByMap()</a>, <a class="el" href="cluster-utils_8cc_source.html#l00054">kaldi::SumClusterableNormalizer()</a>, and <a class="el" href="build-tree-utils_8cc_source.html#l00279">kaldi::SumStatsVec()</a>.</p>

<p>Referenced by <a class="el" href="build-tree-utils_8cc_source.html#l00699">kaldi::ClusterEventMap()</a>, <a class="el" href="build-tree-utils_8cc_source.html#l00840">kaldi::ClusterEventMapRestrictedByMap()</a>, <a class="el" href="build-tree-utils_8cc_source.html#l00805">kaldi::ClusterEventMapRestrictedHelper()</a>, <a class="el" href="build-tree-utils-test_8cc_source.html#l00256">kaldi::TestClusterEventMapGetMappingAndRenumberEventMap()</a>, and <a class="el" href="build-tree-utils-test_8cc_source.html#l00315">kaldi::TestClusterEventMapGetMappingAndRenumberEventMap2()</a>.</p>
<div class="fragment"><div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                                                             {</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;  <span class="comment">// First map stats</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(stats.size() != 0);</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;  std::vector&lt;BuildTreeStatsType&gt; split_stats;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;  <a class="code" href="group__tree__group__lower.html#ga7c608e9645daa472fc1dfbdebae86254">SplitStatsByMap</a>(stats, e_in, &amp;split_stats);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;  std::vector&lt;Clusterable*&gt; summed_stats;</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;  <a class="code" href="group__tree__group__lower.html#ga8c594556191d0401cf83ebab7bebf068">SumStatsVec</a>(split_stats, &amp;summed_stats);</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;  std::vector&lt;int32&gt; indexes;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;  std::vector&lt;Clusterable*&gt; summed_stats_contiguous;</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;  <span class="keywordtype">size_t</span> max_index = 0;</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0;<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; summed_stats.size();<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;    <span class="keywordflow">if</span> (summed_stats[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] != NULL) {</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;      indexes.push_back(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;      summed_stats_contiguous.push_back(summed_stats[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;      <span class="keywordflow">if</span> (i &gt; max_index) max_index = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;    }</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;  }</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;  <span class="keywordflow">if</span> (summed_stats_contiguous.empty()) {</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;    <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;ClusterBottomUp: nothing to cluster.&quot;</span>;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;    <span class="keywordflow">return</span> 0;  <span class="comment">// nothing merged.</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;  }</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;  std::vector&lt;int32&gt; assignments;</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> normalizer = <a class="code" href="group__clustering__group__simple.html#gab13a71ba2459d0dab7158bed4cc0c446">SumClusterableNormalizer</a>(summed_stats_contiguous),</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;      change;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;  change = <a class="code" href="group__clustering__group__algo.html#gae13c55f284aeed0245a059489a0f1960">ClusterBottomUp</a>(summed_stats_contiguous,</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;                           thresh,</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;                           0,  <span class="comment">// no min-clust: use threshold for now.</span></div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;                           NULL,  <span class="comment">// don&#39;t need clusters out.</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                           &amp;assignments);  <span class="comment">// this algorithm is quadratic, so might be quite slow.</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(assignments.size() == summed_stats_contiguous.size() &amp;&amp; !assignments.empty());</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;  <span class="keywordtype">size_t</span> num_clust = * std::max_element(assignments.begin(), assignments.end()) + 1;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> num_combined = summed_stats_contiguous.size() - num_clust;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_combined &gt;= 0);</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;  <a class="code" href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a>(2) &lt;&lt;  <span class="stringliteral">&quot;ClusterBottomUp combined &quot;</span>&lt;&lt; num_combined</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;                &lt;&lt; <span class="stringliteral">&quot; leaves and gave a likelihood change of &quot;</span> &lt;&lt; change</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;, normalized = &quot;</span> &lt;&lt; (change/normalizer)</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;, normalizer = &quot;</span> &lt;&lt; normalizer;</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(change &lt; 0.0001);  <span class="comment">// should be negative or zero.</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(mapping != NULL);</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;  <span class="keywordflow">if</span> (max_index &gt;= mapping-&gt;size()) mapping-&gt;resize(max_index+1, NULL);</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0;<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; summed_stats_contiguous.size();<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="keywordtype">size_t</span> index = indexes[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="keywordtype">size_t</span> new_index = indexes[assignments[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]];  <span class="comment">// index assigned by clusterig-- map to existing indices in the map,</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="comment">// that we clustered from, so we don&#39;t conflict with indices in other parts</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="comment">// of the tree.</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>((*mapping)[index] == NULL || <span class="stringliteral">&quot;Error: Cluster seems to have been &quot;</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                 <span class="stringliteral">&quot;called for different parts of the tree with overlapping sets of &quot;</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                 <span class="stringliteral">&quot;indices.&quot;</span>);</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    (*mapping)[index] = <span class="keyword">new</span> ConstantEventMap(new_index);</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;  }</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;  <a class="code" href="namespacekaldi.html#a93a4038983f8cd71e343b85f1d117cac">DeletePointers</a>(&amp;summed_stats);</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;  <span class="keywordflow">return</span> num_combined;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;}</div>
<div class="ttc" id="group__clustering__group__simple_html_gab13a71ba2459d0dab7158bed4cc0c446"><div class="ttname"><a href="group__clustering__group__simple.html#gab13a71ba2459d0dab7158bed4cc0c446">kaldi::SumClusterableNormalizer</a></div><div class="ttdeci">BaseFloat SumClusterableNormalizer(const std::vector&lt; Clusterable * &gt; &amp;vec)</div><div class="ttdoc">Returns the total normalizer (usually count) of the cluster (pointers may be NULL). </div><div class="ttdef"><b>Definition:</b> <a href="cluster-utils_8cc_source.html#l00054">cluster-utils.cc:54</a></div></div>
<div class="ttc" id="group__tree__group__lower_html_ga7c608e9645daa472fc1dfbdebae86254"><div class="ttname"><a href="group__tree__group__lower.html#ga7c608e9645daa472fc1dfbdebae86254">kaldi::SplitStatsByMap</a></div><div class="ttdeci">void SplitStatsByMap(const BuildTreeStatsType &amp;stats, const EventMap &amp;e, std::vector&lt; BuildTreeStatsType &gt; *stats_out)</div><div class="ttdoc">Splits stats according to the EventMap, indexing them at output by the leaf type. ...</div><div class="ttdef"><b>Definition:</b> <a href="build-tree-utils_8cc_source.html#l00172">build-tree-utils.cc:172</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="group__clustering__group__algo_html_gae13c55f284aeed0245a059489a0f1960"><div class="ttname"><a href="group__clustering__group__algo.html#gae13c55f284aeed0245a059489a0f1960">kaldi::ClusterBottomUp</a></div><div class="ttdeci">BaseFloat ClusterBottomUp(const std::vector&lt; Clusterable * &gt; &amp;points, BaseFloat max_merge_thresh, int32 min_clust, std::vector&lt; Clusterable * &gt; *clusters_out, std::vector&lt; int32 &gt; *assignments_out)</div><div class="ttdoc">A bottom-up clustering algorithm. </div><div class="ttdef"><b>Definition:</b> <a href="cluster-utils_8cc_source.html#l00407">cluster-utils.cc:407</a></div></div>
<div class="ttc" id="group__tree__group__lower_html_ga8c594556191d0401cf83ebab7bebf068"><div class="ttname"><a href="group__tree__group__lower.html#ga8c594556191d0401cf83ebab7bebf068">kaldi::SumStatsVec</a></div><div class="ttdeci">void SumStatsVec(const std::vector&lt; BuildTreeStatsType &gt; &amp;stats_in, std::vector&lt; Clusterable * &gt; *stats_out)</div><div class="ttdoc">Sum a vector of stats. </div><div class="ttdef"><b>Definition:</b> <a href="build-tree-utils_8cc_source.html#l00279">build-tree-utils.cc:279</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00162">kaldi-error.h:162</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab7903878916593daecbeb95b98115ab0"><div class="ttname"><a href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">kaldi::int32</a></div><div class="ttdeci">int32_t int32</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00047">kaldi-types.h:47</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
<div class="ttc" id="group__error__group_html_ga16c81ec6ff3ba04c6ff96fdaed9d854e"><div class="ttname"><a href="group__error__group.html#ga16c81ec6ff3ba04c6ff96fdaed9d854e">KALDI_VLOG</a></div><div class="ttdeci">#define KALDI_VLOG(v)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00166">kaldi-error.h:166</a></div></div>
<div class="ttc" id="namespacekaldi_html_a93a4038983f8cd71e343b85f1d117cac"><div class="ttname"><a href="namespacekaldi.html#a93a4038983f8cd71e343b85f1d117cac">kaldi::DeletePointers</a></div><div class="ttdeci">void DeletePointers(std::vector&lt; A * &gt; *v)</div><div class="ttdoc">Deletes any non-NULL pointers in the vector v, and sets the corresponding entries of v to NULL...</div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00198">stl-utils.h:198</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga5e0a77980515ac6ac5d28454a889e4f2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EventMap * ClusterEventMapRestrictedByKeys </td>
          <td>(</td>
          <td class="paramtype">const EventMap &amp;&#160;</td>
          <td class="paramname"><em>e_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const BuildTreeStatsType &amp;&#160;</td>
          <td class="paramname"><em>stats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BaseFloat&#160;</td>
          <td class="paramname"><em>thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; EventKeyType &gt; &amp;&#160;</td>
          <td class="paramname"><em>keys</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_removed</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This is as ClusterEventMap, but first splits the stats on the keys specified in "keys" (e.g. </p>
<p>typically keys = [ -1, P ]), and only clusters within the classes defined by that splitting. Note&ndash; leaves will be non-consecutive at output, use RenumberEventMap. </p>

<p>Definition at line <a class="el" href="build-tree-utils_8cc_source.html#l00824">824</a> of file <a class="el" href="build-tree-utils_8cc_source.html">build-tree-utils.cc</a>.</p>

<p>References <a class="el" href="build-tree-utils_8cc_source.html#l00805">kaldi::ClusterEventMapRestrictedHelper()</a>, <a class="el" href="classkaldi_1_1EventMap.html#a6b4a37746dabb0f5ffb448433a128d34">EventMap::Copy()</a>, and <a class="el" href="stl-utils_8h_source.html#l00198">kaldi::DeletePointers()</a>.</p>

<p>Referenced by <a class="el" href="build-tree-utils-test_8cc_source.html#l00437">kaldi::TestClusterEventMapRestricted()</a>.</p>
<div class="fragment"><div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;                                                              {</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  std::vector&lt;EventMap*&gt; leaf_mapping;  <span class="comment">// For output of ClusterEventMapGetMapping.</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> nr = <a class="code" href="namespacekaldi.html#a7144486c88bd0cdfd34a729acafc8d6f">ClusterEventMapRestrictedHelper</a>(e_in, stats, thresh, keys, &amp;leaf_mapping);</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;  <span class="keywordflow">if</span> (num_removed != NULL) *num_removed = nr;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  EventMap *ans = e_in.Copy(leaf_mapping);</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  <a class="code" href="namespacekaldi.html#a93a4038983f8cd71e343b85f1d117cac">DeletePointers</a>(&amp;leaf_mapping);</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  <span class="keywordflow">return</span> ans;</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;}</div>
<div class="ttc" id="namespacekaldi_html_a7144486c88bd0cdfd34a729acafc8d6f"><div class="ttname"><a href="namespacekaldi.html#a7144486c88bd0cdfd34a729acafc8d6f">kaldi::ClusterEventMapRestrictedHelper</a></div><div class="ttdeci">static int32 ClusterEventMapRestrictedHelper(const EventMap &amp;e_in, const BuildTreeStatsType &amp;stats, BaseFloat thresh, std::vector&lt; EventKeyType &gt; keys, std::vector&lt; EventMap * &gt; *leaf_mapping)</div><div class="ttdef"><b>Definition:</b> <a href="build-tree-utils_8cc_source.html#l00805">build-tree-utils.cc:805</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab7903878916593daecbeb95b98115ab0"><div class="ttname"><a href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">kaldi::int32</a></div><div class="ttdeci">int32_t int32</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00047">kaldi-types.h:47</a></div></div>
<div class="ttc" id="namespacekaldi_html_a93a4038983f8cd71e343b85f1d117cac"><div class="ttname"><a href="namespacekaldi.html#a93a4038983f8cd71e343b85f1d117cac">kaldi::DeletePointers</a></div><div class="ttdeci">void DeletePointers(std::vector&lt; A * &gt; *v)</div><div class="ttdoc">Deletes any non-NULL pointers in the vector v, and sets the corresponding entries of v to NULL...</div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00198">stl-utils.h:198</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gaf574b973abbfd92e5c789f7d6821f19f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EventMap * ClusterEventMapRestrictedByMap </td>
          <td>(</td>
          <td class="paramtype">const EventMap &amp;&#160;</td>
          <td class="paramname"><em>e_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const BuildTreeStatsType &amp;&#160;</td>
          <td class="paramname"><em>stats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BaseFloat&#160;</td>
          <td class="paramname"><em>thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const EventMap &amp;&#160;</td>
          <td class="paramname"><em>e_restrict</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_removed</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This version of ClusterEventMapRestricted restricts the clustering to only allow things that "e_restrict" maps to the same value to be clustered together. </p>

<p>Definition at line <a class="el" href="build-tree-utils_8cc_source.html#l00840">840</a> of file <a class="el" href="build-tree-utils_8cc_source.html">build-tree-utils.cc</a>.</p>

<p>References <a class="el" href="build-tree-utils_8cc_source.html#l00599">kaldi::ClusterEventMapGetMapping()</a>, <a class="el" href="classkaldi_1_1EventMap.html#a6b4a37746dabb0f5ffb448433a128d34">EventMap::Copy()</a>, <a class="el" href="stl-utils_8h_source.html#l00198">kaldi::DeletePointers()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="build-tree-utils_8cc_source.html#l00172">kaldi::SplitStatsByMap()</a>.</p>

<p>Referenced by <a class="el" href="tree_2build-tree_8cc_source.html#l00135">kaldi::BuildTree()</a>, <a class="el" href="tree_2build-tree_8cc_source.html#l00313">kaldi::BuildTreeTwoLevel()</a>, and <a class="el" href="build-tree-utils-test_8cc_source.html#l00437">kaldi::TestClusterEventMapRestricted()</a>.</p>
<div class="fragment"><div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;                                                                 {</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;  std::vector&lt;EventMap*&gt; leaf_mapping;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  std::vector&lt;BuildTreeStatsType&gt; split_stats;</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  <span class="keywordtype">int</span> num_removed = 0;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;  <a class="code" href="group__tree__group__lower.html#ga7c608e9645daa472fc1dfbdebae86254">SplitStatsByMap</a>(stats, e_restrict, &amp;split_stats);</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; split_stats.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    <span class="keywordflow">if</span> (!split_stats[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].empty())</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;      num_removed += <a class="code" href="group__tree__group__intermediate.html#ga61b77a16e20b9438c1e523bea73e7c21">ClusterEventMapGetMapping</a>(e_in, split_stats[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>], thresh,</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;                                               &amp;leaf_mapping);</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;  }</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  <span class="keywordflow">if</span> (num_removed_ptr != NULL) *num_removed_ptr = num_removed;</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  EventMap *ans = e_in.Copy(leaf_mapping);</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <a class="code" href="namespacekaldi.html#a93a4038983f8cd71e343b85f1d117cac">DeletePointers</a>(&amp;leaf_mapping);</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;  <span class="keywordflow">return</span> ans;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;}</div>
<div class="ttc" id="group__tree__group__lower_html_ga7c608e9645daa472fc1dfbdebae86254"><div class="ttname"><a href="group__tree__group__lower.html#ga7c608e9645daa472fc1dfbdebae86254">kaldi::SplitStatsByMap</a></div><div class="ttdeci">void SplitStatsByMap(const BuildTreeStatsType &amp;stats, const EventMap &amp;e, std::vector&lt; BuildTreeStatsType &gt; *stats_out)</div><div class="ttdoc">Splits stats according to the EventMap, indexing them at output by the leaf type. ...</div><div class="ttdef"><b>Definition:</b> <a href="build-tree-utils_8cc_source.html#l00172">build-tree-utils.cc:172</a></div></div>
<div class="ttc" id="group__tree__group__intermediate_html_ga61b77a16e20b9438c1e523bea73e7c21"><div class="ttname"><a href="group__tree__group__intermediate.html#ga61b77a16e20b9438c1e523bea73e7c21">kaldi::ClusterEventMapGetMapping</a></div><div class="ttdeci">int ClusterEventMapGetMapping(const EventMap &amp;e_in, const BuildTreeStatsType &amp;stats, BaseFloat thresh, std::vector&lt; EventMap * &gt; *mapping)</div><div class="ttdoc">&quot;ClusterEventMapGetMapping&quot; clusters the leaves of the EventMap, with &quot;thresh&quot; a delta-likelihood thr...</div><div class="ttdef"><b>Definition:</b> <a href="build-tree-utils_8cc_source.html#l00599">build-tree-utils.cc:599</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_a93a4038983f8cd71e343b85f1d117cac"><div class="ttname"><a href="namespacekaldi.html#a93a4038983f8cd71e343b85f1d117cac">kaldi::DeletePointers</a></div><div class="ttdeci">void DeletePointers(std::vector&lt; A * &gt; *v)</div><div class="ttdoc">Deletes any non-NULL pointers in the vector v, and sets the corresponding entries of v to NULL...</div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00198">stl-utils.h:198</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga32fb7c47bd1abc95a1dbd06839ed143a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::CreateRandomQuestions </td>
          <td>(</td>
          <td class="paramtype">const BuildTreeStatsType &amp;&#160;</td>
          <td class="paramname"><em>stats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>num_quest</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Questions *&#160;</td>
          <td class="paramname"><em>cfg_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>CreateRandomQuestions will initialize a <a class="el" href="classkaldi_1_1Questions.html" title="This class defines, for each EventKeyType, a set of initial questions that it tries and also a number...">Questions</a> randomly, in a reasonable way [for testing purposes, or when hand-designed questions are not available]. </p>
<p>e.g. num_quest = 5 might be a reasonable value if num_iters &gt; 0, or num_quest = 20 otherwise. </p>

</div>
</div>
<a class="anchor" id="ga48de6ffb976fe28a9acfed11af8783f9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EventMap * DoTableSplit </td>
          <td>(</td>
          <td class="paramtype">const EventMap &amp;&#160;</td>
          <td class="paramname"><em>orig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">EventKeyType&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const BuildTreeStatsType &amp;&#160;</td>
          <td class="paramname"><em>stats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_leaves</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>DoTableSplit does a complete split on this key (e.g. </p>
<p>might correspond to central phone (key = P-1), or HMM-state position (key == kPdfClass == -1). Stats used to work out possible values of the event. "num_leaves" is used to allocate new leaves. All stats must have this key defined, or this function will crash. </p>

<p>Definition at line <a class="el" href="build-tree-utils_8cc_source.html#l00126">126</a> of file <a class="el" href="build-tree-utils_8cc_source.html">build-tree-utils.cc</a>.</p>

<p>References <a class="el" href="classkaldi_1_1EventMap.html#a6b4a37746dabb0f5ffb448433a128d34">EventMap::Copy()</a>, <a class="el" href="stl-utils_8h_source.html#l00198">kaldi::DeletePointers()</a>, <a class="el" href="kaldi-error_8h_source.html#l00143">KALDI_ASSERT</a>, <a class="el" href="build-tree-utils_8cc_source.html#l00063">kaldi::PossibleValues()</a>, and <a class="el" href="build-tree-utils_8cc_source.html#l00172">kaldi::SplitStatsByMap()</a>.</p>

<p>Referenced by <a class="el" href="build-tree-utils_8cc_source.html#l00156">kaldi::DoTableSplitMultiple()</a>, <a class="el" href="build-tree-utils-test_8cc_source.html#l00376">kaldi::TestClusterEventMap()</a>, <a class="el" href="build-tree-utils-test_8cc_source.html#l00256">kaldi::TestClusterEventMapGetMappingAndRenumberEventMap()</a>, <a class="el" href="build-tree-utils-test_8cc_source.html#l00315">kaldi::TestClusterEventMapGetMappingAndRenumberEventMap2()</a>, and <a class="el" href="build-tree-utils-test_8cc_source.html#l00206">kaldi::TestDoTableSplit()</a>.</p>
<div class="fragment"><div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                                          {</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;  <span class="comment">// First-- map the stats to each leaf in the EventMap.</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;  std::vector&lt;BuildTreeStatsType&gt; split_stats;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;  <a class="code" href="group__tree__group__lower.html#ga7c608e9645daa472fc1dfbdebae86254">SplitStatsByMap</a>(stats, orig, &amp;split_stats);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;  <span class="comment">// Now for each leaf that has stats in it, do the table split according to the given name.</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;  std::vector&lt;EventMap*&gt; splits(split_stats.size(), NULL);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#acd9d0bb620ecb065a310cc0b42ea736f">EventAnswerType</a> leaf = 0; leaf &lt; (<a class="code" href="namespacekaldi.html#acd9d0bb620ecb065a310cc0b42ea736f">EventAnswerType</a>)split_stats.size(); leaf++) {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;    <span class="keywordflow">if</span> (!split_stats[leaf].empty()) {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;      <span class="comment">// first work out the possible values the name takes.</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      std::vector&lt;EventValueType&gt; vals;  <span class="comment">// vals are put here, sorted.</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;      <span class="keywordtype">bool</span> all_present = <a class="code" href="group__tree__group__lower.html#ga173f643fb842958832b4b40edce2eb69">PossibleValues</a>(key, split_stats[leaf], &amp;vals);</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(all_present);  <span class="comment">// currently do not support mapping undefined values.</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!vals.empty() &amp;&amp; vals.front() &gt;= 0);  <span class="comment">// don&#39;t support mapping negative values</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      <span class="comment">// at present time-- would need different EventMap type, not TableEventMap.</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;      std::vector&lt;EventMap*&gt; table(vals.back()+1, (EventMap*)NULL);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> idx = 0;idx &lt; vals.size();idx++) {</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <a class="code" href="namespacekaldi.html#a568b789a0df90eb2b79de13c95133b1b">EventValueType</a> val = vals[idx];</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="keywordflow">if</span> (idx == 0) table[val] = <span class="keyword">new</span> ConstantEventMap(leaf);  <span class="comment">// reuse current leaf.</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="keywordflow">else</span> table[val] = <span class="keyword">new</span> ConstantEventMap( (*num_leaves)++ );  <span class="comment">// else take new leaf id.</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;      }</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;      <span class="comment">// takes ownershipof stats.</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;      splits[leaf] = <span class="keyword">new</span> TableEventMap(key, table);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    }</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;  }</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  EventMap *ans = orig.Copy(splits);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <a class="code" href="namespacekaldi.html#a93a4038983f8cd71e343b85f1d117cac">DeletePointers</a>(&amp;splits);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordflow">return</span> ans;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;}</div>
<div class="ttc" id="group__tree__group__lower_html_ga7c608e9645daa472fc1dfbdebae86254"><div class="ttname"><a href="group__tree__group__lower.html#ga7c608e9645daa472fc1dfbdebae86254">kaldi::SplitStatsByMap</a></div><div class="ttdeci">void SplitStatsByMap(const BuildTreeStatsType &amp;stats, const EventMap &amp;e, std::vector&lt; BuildTreeStatsType &gt; *stats_out)</div><div class="ttdoc">Splits stats according to the EventMap, indexing them at output by the leaf type. ...</div><div class="ttdef"><b>Definition:</b> <a href="build-tree-utils_8cc_source.html#l00172">build-tree-utils.cc:172</a></div></div>
<div class="ttc" id="group__tree__group__lower_html_ga173f643fb842958832b4b40edce2eb69"><div class="ttname"><a href="group__tree__group__lower.html#ga173f643fb842958832b4b40edce2eb69">kaldi::PossibleValues</a></div><div class="ttdeci">bool PossibleValues(EventKeyType key, const BuildTreeStatsType &amp;stats, std::vector&lt; EventValueType &gt; *ans)</div><div class="ttdoc">Convenience function e.g. </div><div class="ttdef"><b>Definition:</b> <a href="build-tree-utils_8cc_source.html#l00063">build-tree-utils.cc:63</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
<div class="ttc" id="namespacekaldi_html_acd9d0bb620ecb065a310cc0b42ea736f"><div class="ttname"><a href="namespacekaldi.html#acd9d0bb620ecb065a310cc0b42ea736f">kaldi::EventAnswerType</a></div><div class="ttdeci">int32 EventAnswerType</div><div class="ttdoc">As far as the event-map code itself is concerned, things of type EventAnswerType may take any value e...</div><div class="ttdef"><b>Definition:</b> <a href="event-map_8h_source.html#l00056">event-map.h:56</a></div></div>
<div class="ttc" id="namespacekaldi_html_a568b789a0df90eb2b79de13c95133b1b"><div class="ttname"><a href="namespacekaldi.html#a568b789a0df90eb2b79de13c95133b1b">kaldi::EventValueType</a></div><div class="ttdeci">int32 EventValueType</div><div class="ttdoc">Given current code, things of type EventValueType should generally be nonnegative and in a reasonably...</div><div class="ttdef"><b>Definition:</b> <a href="event-map_8h_source.html#l00051">event-map.h:51</a></div></div>
<div class="ttc" id="namespacekaldi_html_a93a4038983f8cd71e343b85f1d117cac"><div class="ttname"><a href="namespacekaldi.html#a93a4038983f8cd71e343b85f1d117cac">kaldi::DeletePointers</a></div><div class="ttdeci">void DeletePointers(std::vector&lt; A * &gt; *v)</div><div class="ttdoc">Deletes any non-NULL pointers in the vector v, and sets the corresponding entries of v to NULL...</div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00198">stl-utils.h:198</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga4792f64d66cd9846376de3e58cabe482"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EventMap * DoTableSplitMultiple </td>
          <td>(</td>
          <td class="paramtype">const EventMap &amp;&#160;</td>
          <td class="paramname"><em>orig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; EventKeyType &gt; &amp;&#160;</td>
          <td class="paramname"><em>keys</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const BuildTreeStatsType &amp;&#160;</td>
          <td class="paramname"><em>stats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_leaves</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>DoTableSplitMultiple does a complete split on all the keys, in order from keys[0], keys[1] and so on. </p>
<p>The stats are used to work out possible values corresponding to the key. "num_leaves" is used to allocate new leaves. All stats must have the keys defined, or this function will crash. Returns a newly allocated event map. </p>

<p>Definition at line <a class="el" href="build-tree-utils_8cc_source.html#l00156">156</a> of file <a class="el" href="build-tree-utils_8cc_source.html">build-tree-utils.cc</a>.</p>

<p>References <a class="el" href="classkaldi_1_1EventMap.html#a6b4a37746dabb0f5ffb448433a128d34">EventMap::Copy()</a>, <a class="el" href="build-tree-utils_8cc_source.html#l00126">kaldi::DoTableSplit()</a>, and <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>.</p>

<p>Referenced by <a class="el" href="build-tree-utils-test_8cc_source.html#l00437">kaldi::TestClusterEventMapRestricted()</a>, and <a class="el" href="build-tree-utils-test_8cc_source.html#l00535">kaldi::TestShareEventMapLeaves()</a>.</p>
<div class="fragment"><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                                                                                                                                               {</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="keywordflow">if</span> (keys.empty()) <span class="keywordflow">return</span> orig.Copy();</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    EventMap *cur = NULL;  <span class="comment">// would make it &amp;orig, except for const issues.</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; keys.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;      EventMap *next = <a class="code" href="group__tree__group__intermediate.html#ga48de6ffb976fe28a9acfed11af8783f9">DoTableSplit</a>( (cur ? *cur : orig), keys[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>], stats, num_leaves);</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;      <span class="keyword">delete</span> cur;  <span class="comment">// delete intermediate maps.</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;      cur = next;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    }</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">return</span> cur;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;  }</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;}</div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__tree__group__intermediate_html_ga48de6ffb976fe28a9acfed11af8783f9"><div class="ttname"><a href="group__tree__group__intermediate.html#ga48de6ffb976fe28a9acfed11af8783f9">kaldi::DoTableSplit</a></div><div class="ttdeci">EventMap * DoTableSplit(const EventMap &amp;orig, EventKeyType key, const BuildTreeStatsType &amp;stats, int32 *num_leaves)</div><div class="ttdoc">DoTableSplit does a complete split on this key (e.g. </div><div class="ttdef"><b>Definition:</b> <a href="build-tree-utils_8cc_source.html#l00126">build-tree-utils.cc:126</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gadee0a1252d3f117baa58bc77a2f8d807"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BaseFloat FindBestSplitForKey </td>
          <td>(</td>
          <td class="paramtype">const BuildTreeStatsType &amp;&#160;</td>
          <td class="paramname"><em>stats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Questions &amp;&#160;</td>
          <td class="paramname"><em>qcfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">EventKeyType&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; EventValueType &gt; *&#160;</td>
          <td class="paramname"><em>yes_set</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>FindBestSplitForKey is a function used in DoDecisionTreeSplit. </p>
<p>It finds the best split for this key, given these stats. It will return 0 if the key was not always defined for the stats. </p>

<p>Definition at line <a class="el" href="build-tree-utils_8cc_source.html#l00348">348</a> of file <a class="el" href="build-tree-utils_8cc_source.html">build-tree-utils.cc</a>.</p>

<p>References <a class="el" href="cluster-utils_8cc_source.html#l00108">kaldi::AddToClusters()</a>, <a class="el" href="kaldi-math_8h_source.html#l00262">kaldi::ApproxEqual()</a>, <a class="el" href="build-tree-utils_8cc_source.html#l00297">kaldi::ComputeInitialSplit()</a>, <a class="el" href="stl-utils_8h_source.html#l00198">kaldi::DeletePointers()</a>, <a class="el" href="cluster-utils_8cc_source.html#l00082">kaldi::EnsureClusterableVectorNotNull()</a>, <a class="el" href="build-tree-questions_8h_source.html#l00079">Questions::GetQuestionsOf()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00143">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00162">KALDI_WARN</a>, <a class="el" href="cluster-utils_8h_source.html#l00130">RefineClustersOptions::num_iters</a>, <a class="el" href="build-tree-utils_8cc_source.html#l00063">kaldi::PossibleValues()</a>, <a class="el" href="build-tree-questions_8h_source.html#l00053">QuestionsForKey::refine_opts</a>, <a class="el" href="cluster-utils_8cc_source.html#l00894">kaldi::RefineClusters()</a>, <a class="el" href="build-tree-utils_8cc_source.html#l00198">kaldi::SplitStatsByKey()</a>, and <a class="el" href="build-tree-utils_8cc_source.html#l00279">kaldi::SumStatsVec()</a>.</p>

<p>Referenced by <a class="el" href="build-tree-utils_8cc_source.html#l00489">DecisionTreeSplitter::FindBestSplit()</a>.</p>
<div class="fragment"><div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                                                                      {</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;  <span class="keywordflow">if</span> (stats.size()&lt;=1) <span class="keywordflow">return</span> 0.0;  <span class="comment">// cannot split if only zero or one instance of stats.</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="group__tree__group__lower.html#ga173f643fb842958832b4b40edce2eb69">PossibleValues</a>(key, stats, NULL)) {</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    yes_set_out-&gt;clear();</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;    <span class="keywordflow">return</span> 0.0;  <span class="comment">// Can&#39;t split as key not always defined.</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  }</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;  std::vector&lt;Clusterable*&gt; summed_stats;  <span class="comment">// indexed by value corresponding to key. owned here.</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;  {  <span class="comment">// compute summed_stats</span></div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;    std::vector&lt;BuildTreeStatsType&gt; split_stats;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;    <a class="code" href="group__tree__group__lower.html#gaec24b5b9b04af079fd741a4c262fc654">SplitStatsByKey</a>(stats, key, &amp;split_stats);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <a class="code" href="group__tree__group__lower.html#ga8c594556191d0401cf83ebab7bebf068">SumStatsVec</a>(split_stats, &amp;summed_stats);</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;  }</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;  std::vector&lt;EventValueType&gt; yes_set;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> improvement = <a class="code" href="namespacekaldi.html#a9bc20e1fa0f42020ff67c07b75e829b9">ComputeInitialSplit</a>(summed_stats,</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                                               q_opts, key, &amp;yes_set);</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;  <span class="comment">// find best basic question.</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  std::vector&lt;int32&gt; assignments(summed_stats.size(), 0);  <span class="comment">// assigns to &quot;no&quot; (0) by default.</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <span class="keywordflow">for</span> (std::vector&lt;EventValueType&gt;::const_iterator iter = yes_set.begin(); iter != yes_set.end(); ++iter) {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(*iter&gt;=0);</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;    <span class="keywordflow">if</span> (*iter &lt; (<a class="code" href="namespacekaldi.html#a568b789a0df90eb2b79de13c95133b1b">EventValueType</a>)assignments.size()) {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;      <span class="comment">// this guard necessary in case stats did not have all the</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;      <span class="comment">// values present in &quot;yes_set&quot;.</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;      assignments[*iter] = 1;  <span class="comment">// assign to &quot;yes&quot; (1).</span></div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    }</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  }</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  std::vector&lt;Clusterable*&gt; clusters(2, (Clusterable*)NULL);  <span class="comment">// no, yes.</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;  <a class="code" href="group__clustering__group__simple.html#ga136f93226cb2868e7b39bdb2a676e82e">kaldi::AddToClusters</a>(summed_stats, assignments, &amp;clusters);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;  <a class="code" href="group__clustering__group__simple.html#gaf94c6539a2a7130fc9ab220318dcbdd9">EnsureClusterableVectorNotNull</a>(&amp;summed_stats);</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;  <a class="code" href="group__clustering__group__simple.html#gaf94c6539a2a7130fc9ab220318dcbdd9">EnsureClusterableVectorNotNull</a>(&amp;clusters);</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;  <span class="comment">// even if improvement == 0 we continue; if we do RefineClusters we may get further improvement.</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="comment">// now do the RefineClusters stuff.  Note that this is null-op if</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  <span class="comment">// q_opts.GetQuestionsOf(key).refine_opts.num_iters == 0.  We could check for this but don&#39;t bother;</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="comment">// it happens in RefineClusters anyway.</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  <span class="keywordflow">if</span> (q_opts.GetQuestionsOf(key).refine_opts.num_iters &gt; 0) {</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="comment">// If we want to refine the questions... (a bit like k-means w/ 2 classes).</span></div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;    <span class="comment">// Note: the only reason we introduced the if-statement is so the yes_set</span></div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;    <span class="comment">// doesn&#39;t get modified (truncated, actually) if we do the refine stuff with</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <span class="comment">// zero iters.</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> refine_impr = <a class="code" href="group__clustering__group__algo.html#gabc769f73ac32a09d383bfbd139f6326b">RefineClusters</a>(summed_stats, &amp;clusters, &amp;assignments,</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;                                           q_opts.GetQuestionsOf(key).refine_opts);</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(refine_impr &gt; std::min(-1.0, -0.1*fabs(improvement)));</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;    <span class="comment">// refine_impr should always be positive</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    improvement += refine_impr;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    yes_set.clear();</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0;<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; assignments.size();<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) <span class="keywordflow">if</span> (assignments[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] == 1) yes_set.push_back(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  }</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  *yes_set_out = yes_set;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    </div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;  <a class="code" href="namespacekaldi.html#a93a4038983f8cd71e343b85f1d117cac">DeletePointers</a>(&amp;clusters);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;<span class="preprocessor">#ifdef KALDI_PARANOID</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;<span class="preprocessor"></span>  {  <span class="comment">// Check the &quot;ans&quot; is correct.</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(clusters.size() == 2 &amp;&amp; clusters[0] == 0 &amp;&amp; clusters[1] == 0);</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    <a class="code" href="group__clustering__group__simple.html#ga136f93226cb2868e7b39bdb2a676e82e">AddToClusters</a>(summed_stats, assignments, &amp;clusters);</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> impr;</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordflow">if</span> (clusters[0] == NULL || clusters[1] == NULL) impr = 0.0;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    <span class="keywordflow">else</span> impr = clusters[0]-&gt;Distance(*(clusters[1]));</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;    <span class="keywordflow">if</span> (!<a class="code" href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">ApproxEqual</a>(impr, improvement) &amp;&amp; fabs(impr-improvement) &gt; 0.01) {</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;      <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;FindBestSplitForKey: improvements do not agree: &quot;</span>&lt;&lt; impr</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                 &lt;&lt; <span class="stringliteral">&quot; vs. &quot;</span> &lt;&lt; improvement;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;    }</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <a class="code" href="namespacekaldi.html#a93a4038983f8cd71e343b85f1d117cac">DeletePointers</a>(&amp;clusters);</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;  }</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;<span class="preprocessor"></span>  <a class="code" href="namespacekaldi.html#a93a4038983f8cd71e343b85f1d117cac">DeletePointers</a>(&amp;summed_stats);</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;  <span class="keywordflow">return</span> improvement; <span class="comment">// objective-function improvement.</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;}</div>
<div class="ttc" id="group__clustering__group__algo_html_gabc769f73ac32a09d383bfbd139f6326b"><div class="ttname"><a href="group__clustering__group__algo.html#gabc769f73ac32a09d383bfbd139f6326b">kaldi::RefineClusters</a></div><div class="ttdeci">BaseFloat RefineClusters(const std::vector&lt; Clusterable * &gt; &amp;points, std::vector&lt; Clusterable * &gt; *clusters, std::vector&lt; int32 &gt; *assignments, RefineClustersOptions cfg)</div><div class="ttdoc">RefineClusters is mainly used internally by other clustering algorithms. </div><div class="ttdef"><b>Definition:</b> <a href="cluster-utils_8cc_source.html#l00894">cluster-utils.cc:894</a></div></div>
<div class="ttc" id="group__tree__group__lower_html_gaec24b5b9b04af079fd741a4c262fc654"><div class="ttname"><a href="group__tree__group__lower.html#gaec24b5b9b04af079fd741a4c262fc654">kaldi::SplitStatsByKey</a></div><div class="ttdeci">void SplitStatsByKey(const BuildTreeStatsType &amp;stats_in, EventKeyType key, std::vector&lt; BuildTreeStatsType &gt; *stats_out)</div><div class="ttdoc">SplitStatsByKey splits stats up according to the value of a particular key, which must be always defi...</div><div class="ttdef"><b>Definition:</b> <a href="build-tree-utils_8cc_source.html#l00198">build-tree-utils.cc:198</a></div></div>
<div class="ttc" id="group__tree__group__lower_html_ga173f643fb842958832b4b40edce2eb69"><div class="ttname"><a href="group__tree__group__lower.html#ga173f643fb842958832b4b40edce2eb69">kaldi::PossibleValues</a></div><div class="ttdeci">bool PossibleValues(EventKeyType key, const BuildTreeStatsType &amp;stats, std::vector&lt; EventValueType &gt; *ans)</div><div class="ttdoc">Convenience function e.g. </div><div class="ttdef"><b>Definition:</b> <a href="build-tree-utils_8cc_source.html#l00063">build-tree-utils.cc:63</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="group__clustering__group__simple_html_gaf94c6539a2a7130fc9ab220318dcbdd9"><div class="ttname"><a href="group__clustering__group__simple.html#gaf94c6539a2a7130fc9ab220318dcbdd9">kaldi::EnsureClusterableVectorNotNull</a></div><div class="ttdeci">void EnsureClusterableVectorNotNull(std::vector&lt; Clusterable * &gt; *stats)</div><div class="ttdoc">Fills in any (NULL) holes in &quot;stats&quot; vector, with empty stats, because certain algorithms require non...</div><div class="ttdef"><b>Definition:</b> <a href="cluster-utils_8cc_source.html#l00082">cluster-utils.cc:82</a></div></div>
<div class="ttc" id="group__tree__group__lower_html_ga8c594556191d0401cf83ebab7bebf068"><div class="ttname"><a href="group__tree__group__lower.html#ga8c594556191d0401cf83ebab7bebf068">kaldi::SumStatsVec</a></div><div class="ttdeci">void SumStatsVec(const std::vector&lt; BuildTreeStatsType &gt; &amp;stats_in, std::vector&lt; Clusterable * &gt; *stats_out)</div><div class="ttdoc">Sum a vector of stats. </div><div class="ttdef"><b>Definition:</b> <a href="build-tree-utils_8cc_source.html#l00279">build-tree-utils.cc:279</a></div></div>
<div class="ttc" id="group__clustering__group__simple_html_ga136f93226cb2868e7b39bdb2a676e82e"><div class="ttname"><a href="group__clustering__group__simple.html#ga136f93226cb2868e7b39bdb2a676e82e">kaldi::AddToClusters</a></div><div class="ttdeci">void AddToClusters(const std::vector&lt; Clusterable * &gt; &amp;stats, const std::vector&lt; int32 &gt; &amp;assignments, std::vector&lt; Clusterable * &gt; *clusters)</div><div class="ttdoc">Given stats and a vector &quot;assignments&quot; of the same size (that maps to cluster indices), sums the stats up into &quot;clusters.&quot; It will add to any stats already present in &quot;clusters&quot; (although typically &quot;clusters&quot; will be empty when called), and it will extend with NULL pointers for any unseen indices. </div><div class="ttdef"><b>Definition:</b> <a href="cluster-utils_8cc_source.html#l00108">cluster-utils.cc:108</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00162">kaldi-error.h:162</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
<div class="ttc" id="namespacekaldi_html_a9bc20e1fa0f42020ff67c07b75e829b9"><div class="ttname"><a href="namespacekaldi.html#a9bc20e1fa0f42020ff67c07b75e829b9">kaldi::ComputeInitialSplit</a></div><div class="ttdeci">BaseFloat ComputeInitialSplit(const std::vector&lt; Clusterable * &gt; &amp;summed_stats, const Questions &amp;q_opts, EventKeyType key, std::vector&lt; EventValueType &gt; *yes_set)</div><div class="ttdef"><b>Definition:</b> <a href="build-tree-utils_8cc_source.html#l00297">build-tree-utils.cc:297</a></div></div>
<div class="ttc" id="namespacekaldi_html_a568b789a0df90eb2b79de13c95133b1b"><div class="ttname"><a href="namespacekaldi.html#a568b789a0df90eb2b79de13c95133b1b">kaldi::EventValueType</a></div><div class="ttdeci">int32 EventValueType</div><div class="ttdoc">Given current code, things of type EventValueType should generally be nonnegative and in a reasonably...</div><div class="ttdef"><b>Definition:</b> <a href="event-map_8h_source.html#l00051">event-map.h:51</a></div></div>
<div class="ttc" id="namespacekaldi_html_a93a4038983f8cd71e343b85f1d117cac"><div class="ttname"><a href="namespacekaldi.html#a93a4038983f8cd71e343b85f1d117cac">kaldi::DeletePointers</a></div><div class="ttdeci">void DeletePointers(std::vector&lt; A * &gt; *v)</div><div class="ttdoc">Deletes any non-NULL pointers in the vector v, and sets the corresponding entries of v to NULL...</div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00198">stl-utils.h:198</a></div></div>
<div class="ttc" id="namespacekaldi_html_a99dcbb9fdaa6c980ba67941d45adf017"><div class="ttname"><a href="namespacekaldi.html#a99dcbb9fdaa6c980ba67941d45adf017">kaldi::ApproxEqual</a></div><div class="ttdeci">static bool ApproxEqual(float a, float b, float relative_tolerance=0.001)</div><div class="ttdoc">return abs(a - b) &lt;= relative_tolerance * (abs(a)+abs(b)). </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00262">kaldi-math.h:262</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga7e642ce32f4019c2987e0a168445c1ff"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EventMap * GetStubMap </td>
          <td>(</td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>P</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>phone_sets</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>phone2num_pdf_classes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; bool &gt; &amp;&#160;</td>
          <td class="paramname"><em>share_roots</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_leaves</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>GetStubMap is used in tree-building functions to get the initial to-states map, before the decision-tree-building process. </p>
<p>It creates a simple map that splits on groups of phones. For the set of phones in phone_sets[i] it creates either: if share_roots[i] == true, a single leaf node, or if share_roots[i] == false, separate root nodes for each HMM-position (it goes up to the highest position for any phone in the set, although it will warn if you share roots between phones with different numbers of states, which is a weird thing to do but should still work. If any phone is present in "phone_sets" but "phone2num_pdf_classes" does not map it to a length, it is an error. Note that the behaviour of the resulting map is undefined for phones not present in "phone_sets". At entry, this function should be called with (*num_leaves == 0). It will number the leaves starting from (*num_leaves). </p>

<p>Definition at line <a class="el" href="build-tree-utils_8cc_source.html#l00865">865</a> of file <a class="el" href="build-tree-utils_8cc_source.html">build-tree-utils.cc</a>.</p>

<p>References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="stl-utils_8h_source.html#l00075">kaldi::IsSortedAndUniq()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00143">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00162">KALDI_WARN</a>, and <a class="el" href="context-dep_8h_source.html#l00038">kaldi::kPdfClass</a>.</p>

<p>Referenced by <a class="el" href="tree_2build-tree_8cc_source.html#l00135">kaldi::BuildTree()</a>, <a class="el" href="context-dep_8cc_source.html#l00224">kaldi::MonophoneContextDependency()</a>, and <a class="el" href="context-dep_8cc_source.html#l00236">kaldi::MonophoneContextDependencyShared()</a>.</p>
<div class="fragment"><div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                                            {</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  {  <span class="comment">// Checking inputs.</span></div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!phone_sets.empty() &amp;&amp; share_roots.size() == phone_sets.size());</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    std::set&lt;int32&gt; all_phones;</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; phone_sets.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi.html#a81dfa76eeac63eba502e32ee58e37d57">IsSortedAndUniq</a>(phone_sets[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]));</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!phone_sets[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].empty());</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; phone_sets[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(all_phones.count(phone_sets[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>]) == 0);  <span class="comment">// check not present.</span></div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;        all_phones.insert(phone_sets[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>][j]);</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;      }</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    }</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;  }</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;  <span class="comment">// Initially create a single leaf for each phone set.</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;  <span class="keywordtype">size_t</span> max_set_size = 0;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> highest_numbered_phone = 0;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; phone_sets.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    max_set_size = std::max(max_set_size, phone_sets[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size());</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    highest_numbered_phone =</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;        std::max(highest_numbered_phone,</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                 * std::max_element(phone_sets[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].begin(), phone_sets[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].end()));</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;  }</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;  <span class="keywordflow">if</span> (phone_sets.size() == 1) {  <span class="comment">// there is only one set so the recursion finishes.</span></div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;    <span class="keywordflow">if</span> (share_roots[0]) {  <span class="comment">// if &quot;shared roots&quot; return a single leaf.</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">new</span> ConstantEventMap( (*num_leaves_out)++ );</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    } <span class="keywordflow">else</span> {  <span class="comment">// not sharing roots -&gt; work out the length and return a</span></div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;             <span class="comment">// TableEventMap splitting on length.</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;      <a class="code" href="namespacekaldi.html#acd9d0bb620ecb065a310cc0b42ea736f">EventAnswerType</a> max_len = 0;</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; phone_sets[0].size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        <a class="code" href="namespacekaldi.html#acd9d0bb620ecb065a310cc0b42ea736f">EventAnswerType</a> len;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;        <a class="code" href="namespacekaldi.html#a568b789a0df90eb2b79de13c95133b1b">EventValueType</a> phone = phone_sets[0][<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(static_cast&lt;size_t&gt;(phone) &lt; phone2num_pdf_classes.size());</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        len = phone2num_pdf_classes[phone];</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(len &gt; 0);</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> == 0) max_len = len;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;        <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;          <span class="keywordflow">if</span> (len != max_len) {</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;            <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;Mismatching lengths within a phone set: &quot;</span> &lt;&lt; len</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;                       &lt;&lt; <span class="stringliteral">&quot; vs. &quot;</span> &lt;&lt; max_len &lt;&lt; <span class="stringliteral">&quot; [unusual, but not necessarily fatal]. &quot;</span>;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;            max_len = std::max(len, max_len);</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;          }</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        }</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;      }</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      std::map&lt;EventValueType, EventAnswerType&gt; m;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#acd9d0bb620ecb065a310cc0b42ea736f">EventAnswerType</a> p = 0; p &lt; max_len; p++)</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;        m[p] = (*num_leaves_out)++;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;      <span class="keywordflow">return</span> <span class="keyword">new</span> TableEventMap(<a class="code" href="namespacekaldi.html#a4f60ee3443b23229d5ef766a26c289f9">kPdfClass</a>,  <span class="comment">// split on hmm-position</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                               m);</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;    }</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (max_set_size == 1</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;            &amp;&amp; static_cast&lt;int32&gt;(phone_sets.size()) &lt;= 2*highest_numbered_phone) {</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;    <span class="comment">// create table map splitting on phone-- more efficient.</span></div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;    <span class="comment">// the part after the &amp;&amp; checks that this would not contain a very sparse vector.</span></div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;    std::map&lt;EventValueType, EventMap*&gt; m;</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; phone_sets.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;      std::vector&lt;std::vector&lt;int32&gt; &gt; phone_sets_tmp;</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;      phone_sets_tmp.push_back(phone_sets[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;      std::vector&lt;bool&gt; share_roots_tmp;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;      share_roots_tmp.push_back(share_roots[i]);</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;      EventMap *this_stub = <a class="code" href="group__tree__group__intermediate.html#ga7e642ce32f4019c2987e0a168445c1ff">GetStubMap</a>(P, phone_sets_tmp, phone2num_pdf_classes,</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;                                       share_roots_tmp,</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                                       num_leaves_out);</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(m.count(phone_sets_tmp[0][0]) == 0);</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;      m[phone_sets_tmp[0][0]] = this_stub;</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;    }</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> TableEventMap(P, m);</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;    <span class="comment">// Do a split.  Recurse.</span></div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;    <span class="keywordtype">size_t</span> half_sz = phone_sets.size() / 2;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;    std::vector&lt;std::vector&lt;int32&gt; &gt;::const_iterator half_phones =</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;        phone_sets.begin() + half_sz;  </div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    std::vector&lt;bool&gt;::const_iterator half_share =</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;        share_roots.begin() + half_sz;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;    std::vector&lt;std::vector&lt;int32&gt; &gt; phone_sets_1, phone_sets_2;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;    std::vector&lt;bool&gt; share_roots_1, share_roots_2;</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;    phone_sets_1.insert(phone_sets_1.end(), phone_sets.begin(), half_phones);</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;    phone_sets_2.insert(phone_sets_2.end(), half_phones, phone_sets.end());</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;    share_roots_1.insert(share_roots_1.end(), share_roots.begin(), half_share);</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;    share_roots_2.insert(share_roots_2.end(), half_share, share_roots.end());</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;    EventMap *map1 = <a class="code" href="group__tree__group__intermediate.html#ga7e642ce32f4019c2987e0a168445c1ff">GetStubMap</a>(P, phone_sets_1, phone2num_pdf_classes, share_roots_1, num_leaves_out);</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;    EventMap *map2 = <a class="code" href="group__tree__group__intermediate.html#ga7e642ce32f4019c2987e0a168445c1ff">GetStubMap</a>(P, phone_sets_2, phone2num_pdf_classes, share_roots_2, num_leaves_out);</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    std::vector&lt;EventKeyType&gt; all_in_first_set;</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; half_sz; i++)</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; phone_sets[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++)</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;        all_in_first_set.push_back(phone_sets[i][<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>]);</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;    std::sort(all_in_first_set.begin(), all_in_first_set.end());</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi.html#a81dfa76eeac63eba502e32ee58e37d57">IsSortedAndUniq</a>(all_in_first_set));</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">new</span> SplitEventMap(P, all_in_first_set, map1, map2);</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  }</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;}</div>
<div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_a4f60ee3443b23229d5ef766a26c289f9"><div class="ttname"><a href="namespacekaldi.html#a4f60ee3443b23229d5ef766a26c289f9">kaldi::kPdfClass</a></div><div class="ttdeci">static const EventKeyType kPdfClass</div><div class="ttdef"><b>Definition:</b> <a href="context-dep_8h_source.html#l00038">context-dep.h:38</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00162">kaldi-error.h:162</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab7903878916593daecbeb95b98115ab0"><div class="ttname"><a href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">kaldi::int32</a></div><div class="ttdeci">int32_t int32</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00047">kaldi-types.h:47</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__tree__group__intermediate_html_ga7e642ce32f4019c2987e0a168445c1ff"><div class="ttname"><a href="group__tree__group__intermediate.html#ga7e642ce32f4019c2987e0a168445c1ff">kaldi::GetStubMap</a></div><div class="ttdeci">EventMap * GetStubMap(int32 P, const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;phone_sets, const std::vector&lt; int32 &gt; &amp;phone2num_pdf_classes, const std::vector&lt; bool &gt; &amp;share_roots, int32 *num_leaves_out)</div><div class="ttdoc">GetStubMap is used in tree-building functions to get the initial to-states map, before the decision-t...</div><div class="ttdef"><b>Definition:</b> <a href="build-tree-utils_8cc_source.html#l00865">build-tree-utils.cc:865</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
<div class="ttc" id="namespacekaldi_html_acd9d0bb620ecb065a310cc0b42ea736f"><div class="ttname"><a href="namespacekaldi.html#acd9d0bb620ecb065a310cc0b42ea736f">kaldi::EventAnswerType</a></div><div class="ttdeci">int32 EventAnswerType</div><div class="ttdoc">As far as the event-map code itself is concerned, things of type EventAnswerType may take any value e...</div><div class="ttdef"><b>Definition:</b> <a href="event-map_8h_source.html#l00056">event-map.h:56</a></div></div>
<div class="ttc" id="namespacekaldi_html_a568b789a0df90eb2b79de13c95133b1b"><div class="ttname"><a href="namespacekaldi.html#a568b789a0df90eb2b79de13c95133b1b">kaldi::EventValueType</a></div><div class="ttdeci">int32 EventValueType</div><div class="ttdoc">Given current code, things of type EventValueType should generally be nonnegative and in a reasonably...</div><div class="ttdef"><b>Definition:</b> <a href="event-map_8h_source.html#l00051">event-map.h:51</a></div></div>
<div class="ttc" id="namespacekaldi_html_a81dfa76eeac63eba502e32ee58e37d57"><div class="ttname"><a href="namespacekaldi.html#a81dfa76eeac63eba502e32ee58e37d57">kaldi::IsSortedAndUniq</a></div><div class="ttdeci">bool IsSortedAndUniq(const std::vector&lt; T &gt; &amp;vec)</div><div class="ttdoc">Returns true if the vector is sorted and contains each element only once. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00075">stl-utils.h:75</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga9de82568c2869cba7854e3c954d905cd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EventMap * MapEventMapLeaves </td>
          <td>(</td>
          <td class="paramtype">const EventMap &amp;&#160;</td>
          <td class="paramname"><em>e_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>mapping</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function remaps the event-map leaves using this mapping, indexed by the number at leaf. </p>

<p>Definition at line <a class="el" href="build-tree-utils_8cc_source.html#l00689">689</a> of file <a class="el" href="build-tree-utils_8cc_source.html">build-tree-utils.cc</a>.</p>

<p>References <a class="el" href="classkaldi_1_1EventMap.html#a6b4a37746dabb0f5ffb448433a128d34">EventMap::Copy()</a>, <a class="el" href="stl-utils_8h_source.html#l00198">kaldi::DeletePointers()</a>, and <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>.</p>

<p>Referenced by <a class="el" href="tree_2build-tree_8cc_source.html#l00313">kaldi::BuildTreeTwoLevel()</a>.</p>
<div class="fragment"><div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                                                                {</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;  std::vector&lt;EventMap*&gt; mapping(mapping_in.size());</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; mapping_in.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;    mapping[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <span class="keyword">new</span> ConstantEventMap(mapping_in[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;  EventMap *ans = e_in.Copy(mapping);</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;  <a class="code" href="namespacekaldi.html#a93a4038983f8cd71e343b85f1d117cac">DeletePointers</a>(&amp;mapping);</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;  <span class="keywordflow">return</span> ans;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;}</div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_a93a4038983f8cd71e343b85f1d117cac"><div class="ttname"><a href="namespacekaldi.html#a93a4038983f8cd71e343b85f1d117cac">kaldi::DeletePointers</a></div><div class="ttdeci">void DeletePointers(std::vector&lt; A * &gt; *v)</div><div class="ttdoc">Deletes any non-NULL pointers in the vector v, and sets the corresponding entries of v to NULL...</div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00198">stl-utils.h:198</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gaf37866e2792ecbd810617da2577e41d8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EventMap * RenumberEventMap </td>
          <td>(</td>
          <td class="paramtype">const EventMap &amp;&#160;</td>
          <td class="paramname"><em>e_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_leaves</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>RenumberEventMap [intended to be used after calling ClusterEventMap] renumbers an <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a> so its leaves are consecutive. </p>
<p>It puts the number of leaves in *num_leaves. If later you need the mapping of the leaves, modify the function and add a new argument. </p>

<p>Definition at line <a class="el" href="build-tree-utils_8cc_source.html#l00664">664</a> of file <a class="el" href="build-tree-utils_8cc_source.html">build-tree-utils.cc</a>.</p>

<p>References <a class="el" href="classkaldi_1_1EventMap.html#a6b4a37746dabb0f5ffb448433a128d34">EventMap::Copy()</a>, <a class="el" href="stl-utils_8h_source.html#l00198">kaldi::DeletePointers()</a>, <a class="el" href="kaldi-error_8h_source.html#l00143">KALDI_ASSERT</a>, <a class="el" href="classkaldi_1_1EventMap.html#a1d30678a24dc75f8b076db81ad1711bd">EventMap::MultiMap()</a>, and <a class="el" href="stl-utils_8h_source.html#l00051">kaldi::SortAndUniq()</a>.</p>

<p>Referenced by <a class="el" href="tree_2build-tree_8cc_source.html#l00135">kaldi::BuildTree()</a>, <a class="el" href="tree_2build-tree_8cc_source.html#l00313">kaldi::BuildTreeTwoLevel()</a>, <a class="el" href="build-tree-utils_8cc_source.html#l00710">kaldi::ShareEventMapLeaves()</a>, <a class="el" href="build-tree-utils-test_8cc_source.html#l00256">kaldi::TestClusterEventMapGetMappingAndRenumberEventMap()</a>, and <a class="el" href="build-tree-utils-test_8cc_source.html#l00315">kaldi::TestClusterEventMapGetMappingAndRenumberEventMap2()</a>.</p>
<div class="fragment"><div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;                                                                    {</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;  <a class="code" href="namespacekaldi.html#ad52ff1019e01de1ec06a179d33d3768a">EventType</a> empty_vec;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;  std::vector&lt;EventAnswerType&gt; initial_leaves;  <span class="comment">// before renumbering.</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;  e_in.MultiMap(empty_vec, &amp;initial_leaves);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;  <span class="keywordflow">if</span> (initial_leaves.empty()) {</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_leaves);</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;    <span class="keywordflow">if</span> (num_leaves) *num_leaves = 0;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;    <span class="keywordflow">return</span> e_in.Copy();</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;  }</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;  <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;initial_leaves);</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;  <a class="code" href="namespacekaldi.html#acd9d0bb620ecb065a310cc0b42ea736f">EventAnswerType</a> max_leaf_plus_one = initial_leaves.back() + 1;  <span class="comment">// will typically, but not always, equal *num_leaves.</span></div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;  std::vector&lt;EventMap*&gt; mapping(max_leaf_plus_one, (EventMap*)NULL);</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;  std::vector&lt;EventAnswerType&gt;::iterator iter = initial_leaves.begin(), end = initial_leaves.end();</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  <a class="code" href="namespacekaldi.html#acd9d0bb620ecb065a310cc0b42ea736f">EventAnswerType</a> cur_leaf = 0;</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;  <span class="keywordflow">for</span> (; iter != end; ++iter) {</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(*iter &gt;= 0 &amp;&amp; *iter&lt;max_leaf_plus_one);</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;    mapping[*iter] = <span class="keyword">new</span> ConstantEventMap(cur_leaf++);</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;  }</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;  EventMap *ans = e_in.Copy(mapping);</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;  <a class="code" href="namespacekaldi.html#a93a4038983f8cd71e343b85f1d117cac">DeletePointers</a>(&amp;mapping);</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>((<span class="keywordtype">size_t</span>)cur_leaf == initial_leaves.size());</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;  <span class="keywordflow">if</span> (num_leaves) *num_leaves = cur_leaf;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;  <span class="keywordflow">return</span> ans;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;}</div>
<div class="ttc" id="namespacekaldi_html_a3dd7a9cc33032bfb870b4b6c053822db"><div class="ttname"><a href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">kaldi::SortAndUniq</a></div><div class="ttdeci">void SortAndUniq(std::vector&lt; T &gt; *vec)</div><div class="ttdoc">Sorts and uniq&#39;s (removes duplicates) from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00051">stl-utils.h:51</a></div></div>
<div class="ttc" id="namespacekaldi_html_ad52ff1019e01de1ec06a179d33d3768a"><div class="ttname"><a href="namespacekaldi.html#ad52ff1019e01de1ec06a179d33d3768a">kaldi::EventType</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; EventKeyType, EventValueType &gt; &gt; EventType</div><div class="ttdef"><b>Definition:</b> <a href="event-map_8h_source.html#l00058">event-map.h:58</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
<div class="ttc" id="namespacekaldi_html_acd9d0bb620ecb065a310cc0b42ea736f"><div class="ttname"><a href="namespacekaldi.html#acd9d0bb620ecb065a310cc0b42ea736f">kaldi::EventAnswerType</a></div><div class="ttdeci">int32 EventAnswerType</div><div class="ttdoc">As far as the event-map code itself is concerned, things of type EventAnswerType may take any value e...</div><div class="ttdef"><b>Definition:</b> <a href="event-map_8h_source.html#l00056">event-map.h:56</a></div></div>
<div class="ttc" id="namespacekaldi_html_a93a4038983f8cd71e343b85f1d117cac"><div class="ttname"><a href="namespacekaldi.html#a93a4038983f8cd71e343b85f1d117cac">kaldi::DeletePointers</a></div><div class="ttdeci">void DeletePointers(std::vector&lt; A * &gt; *v)</div><div class="ttdoc">Deletes any non-NULL pointers in the vector v, and sets the corresponding entries of v to NULL...</div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00198">stl-utils.h:198</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga495ab0f2b490051b68a93c11d5878331"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EventMap * ShareEventMapLeaves </td>
          <td>(</td>
          <td class="paramtype">const EventMap &amp;&#160;</td>
          <td class="paramname"><em>e_in</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">EventKeyType&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; std::vector&lt; EventValueType &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>values</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_leaves</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>ShareEventMapLeaves performs a quite specific function that allows us to generate trees where, for a certain list of phones, and for all states in the phone, all the pdf's are shared. </p>
<p>Each element of "values" contains a list of phones (may be just one phone), all states of which we want shared together). Typically at input, "key" will equal P, the central-phone position, and "values" will contain just one list containing the silence phone. This function renumbers the event map leaves after doing the sharing, to make the event-map leaves contiguous. </p>

<p>Definition at line <a class="el" href="build-tree-utils_8cc_source.html#l00710">710</a> of file <a class="el" href="build-tree-utils_8cc_source.html">build-tree-utils.cc</a>.</p>

<p>References <a class="el" href="classkaldi_1_1EventMap.html#a6b4a37746dabb0f5ffb448433a128d34">EventMap::Copy()</a>, <a class="el" href="stl-utils_8h_source.html#l00198">kaldi::DeletePointers()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00143">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00162">KALDI_WARN</a>, <a class="el" href="event-map_8h_source.html#l00062">kaldi::MakeEventPair()</a>, <a class="el" href="classkaldi_1_1EventMap.html#a1d30678a24dc75f8b076db81ad1711bd">EventMap::MultiMap()</a>, <a class="el" href="build-tree-utils_8cc_source.html#l00664">kaldi::RenumberEventMap()</a>, and <a class="el" href="stl-utils_8h_source.html#l00051">kaldi::SortAndUniq()</a>.</p>

<p>Referenced by <a class="el" href="build-tree-utils-test_8cc_source.html#l00535">kaldi::TestShareEventMapLeaves()</a>.</p>
<div class="fragment"><div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                                                 {</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <span class="comment">// the use of &quot;pdfs&quot; as the name of the next variable reflects the anticipated</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;  <span class="comment">// use of this function.</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;  std::vector&lt;std::vector&lt;EventAnswerType&gt; &gt; pdfs(values.size());</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; values.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <a class="code" href="namespacekaldi.html#ad52ff1019e01de1ec06a179d33d3768a">EventType</a> evec;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 0; <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> &lt; values[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size(); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;      evec.push_back(<a class="code" href="namespacekaldi.html#a9fd8ef2727913ab19e0ef9a3eebac388">MakeEventPair</a>(key, values[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>]));</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;      <span class="keywordtype">size_t</span> size_at_start = pdfs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size();</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;      e_in.MultiMap(evec, &amp;(pdfs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]));  <span class="comment">// append any corresponding pdfs to pdfs[i].</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      <span class="keywordflow">if</span> (pdfs[i].size() == size_at_start) {  <span class="comment">// Nothing added... unexpected.</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;ShareEventMapLeaves: had no leaves for key = &quot;</span> &lt;&lt; key</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;                   &lt;&lt; <span class="stringliteral">&quot;, value = &quot;</span> &lt;&lt; (values[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>]);</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;      }</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    }</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;(pdfs[i]));</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;  }</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;  std::vector&lt;EventMap*&gt; remapping;</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; values.size(); i++) {</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    <span class="keywordflow">if</span> (pdfs[i].empty())</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;      <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;ShareEventMapLeaves: no leaves in one bucket.&quot;</span>;  <span class="comment">// not expected.</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      <a class="code" href="namespacekaldi.html#acd9d0bb620ecb065a310cc0b42ea736f">EventAnswerType</a> map_to_this = pdfs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>][0];  <span class="comment">// map all in this bucket</span></div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      <span class="comment">// to this value.</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> j = 1; j &lt; pdfs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size(); j++) {</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        <a class="code" href="namespacekaldi.html#acd9d0bb620ecb065a310cc0b42ea736f">EventAnswerType</a> leaf = pdfs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>][<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(leaf&gt;=0);</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        <span class="keywordflow">if</span> (remapping.size() &lt;= <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(leaf))</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;          remapping.resize(leaf+1, NULL);</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(remapping[leaf] == NULL);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        remapping[leaf] = <span class="keyword">new</span> ConstantEventMap(map_to_this);</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;      }</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;    }</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;  }</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;  EventMap *shared = e_in.Copy(remapping);</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;  <a class="code" href="namespacekaldi.html#a93a4038983f8cd71e343b85f1d117cac">DeletePointers</a>(&amp;remapping);</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;  EventMap *renumbered = <a class="code" href="group__tree__group__intermediate.html#gaf37866e2792ecbd810617da2577e41d8">RenumberEventMap</a>(*shared, num_leaves);</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;  <span class="keyword">delete</span> shared;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;  <span class="keywordflow">return</span> renumbered;</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;}</div>
<div class="ttc" id="namespacekaldi_html_a9fd8ef2727913ab19e0ef9a3eebac388"><div class="ttname"><a href="namespacekaldi.html#a9fd8ef2727913ab19e0ef9a3eebac388">kaldi::MakeEventPair</a></div><div class="ttdeci">std::pair&lt; EventKeyType, EventValueType &gt; MakeEventPair(EventKeyType k, EventValueType v)</div><div class="ttdef"><b>Definition:</b> <a href="event-map_8h_source.html#l00062">event-map.h:62</a></div></div>
<div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_html_a3dd7a9cc33032bfb870b4b6c053822db"><div class="ttname"><a href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">kaldi::SortAndUniq</a></div><div class="ttdeci">void SortAndUniq(std::vector&lt; T &gt; *vec)</div><div class="ttdoc">Sorts and uniq&#39;s (removes duplicates) from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00051">stl-utils.h:51</a></div></div>
<div class="ttc" id="namespacekaldi_html_ad52ff1019e01de1ec06a179d33d3768a"><div class="ttname"><a href="namespacekaldi.html#ad52ff1019e01de1ec06a179d33d3768a">kaldi::EventType</a></div><div class="ttdeci">std::vector&lt; std::pair&lt; EventKeyType, EventValueType &gt; &gt; EventType</div><div class="ttdef"><b>Definition:</b> <a href="event-map_8h_source.html#l00058">event-map.h:58</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00162">kaldi-error.h:162</a></div></div>
<div class="ttc" id="group__tree__group__intermediate_html_gaf37866e2792ecbd810617da2577e41d8"><div class="ttname"><a href="group__tree__group__intermediate.html#gaf37866e2792ecbd810617da2577e41d8">kaldi::RenumberEventMap</a></div><div class="ttdeci">EventMap * RenumberEventMap(const EventMap &amp;e_in, int32 *num_leaves)</div><div class="ttdoc">RenumberEventMap [intended to be used after calling ClusterEventMap] renumbers an EventMap so its lea...</div><div class="ttdef"><b>Definition:</b> <a href="build-tree-utils_8cc_source.html#l00664">build-tree-utils.cc:664</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
<div class="ttc" id="namespacekaldi_html_acd9d0bb620ecb065a310cc0b42ea736f"><div class="ttname"><a href="namespacekaldi.html#acd9d0bb620ecb065a310cc0b42ea736f">kaldi::EventAnswerType</a></div><div class="ttdeci">int32 EventAnswerType</div><div class="ttdoc">As far as the event-map code itself is concerned, things of type EventAnswerType may take any value e...</div><div class="ttdef"><b>Definition:</b> <a href="event-map_8h_source.html#l00056">event-map.h:56</a></div></div>
<div class="ttc" id="namespacekaldi_html_a93a4038983f8cd71e343b85f1d117cac"><div class="ttname"><a href="namespacekaldi.html#a93a4038983f8cd71e343b85f1d117cac">kaldi::DeletePointers</a></div><div class="ttdeci">void DeletePointers(std::vector&lt; A * &gt; *v)</div><div class="ttdoc">Deletes any non-NULL pointers in the vector v, and sets the corresponding entries of v to NULL...</div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00198">stl-utils.h:198</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gaa4da1fcb3f12d5c116948d37448d9e46"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">EventMap * SplitDecisionTree </td>
          <td>(</td>
          <td class="paramtype">const EventMap &amp;&#160;</td>
          <td class="paramname"><em>orig</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const BuildTreeStatsType &amp;&#160;</td>
          <td class="paramname"><em>stats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Questions &amp;&#160;</td>
          <td class="paramname"><em>qcfg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BaseFloat&#160;</td>
          <td class="paramname"><em>thresh</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32&#160;</td>
          <td class="paramname"><em>max_leaves</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_leaves</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BaseFloat *&#160;</td>
          <td class="paramname"><em>objf_impr_out</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BaseFloat *&#160;</td>
          <td class="paramname"><em>smallest_split_change_out</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Does a decision-tree split at the leaves of an <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">orig</td><td>[in] The <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a> whose leaves we want to split. [may be either a trivial or a non-trivial one]. </td></tr>
    <tr><td class="paramname">stats</td><td>[in] The statistics for splitting the tree; if you do not want a particular subset of leaves to be split, make sure the stats corresponding to those leaves are not present in "stats". </td></tr>
    <tr><td class="paramname">qcfg</td><td>[in] Configuration class that contains initial questions (e.g. sets of phones) for each key and says whether to refine these questions during tree building. </td></tr>
    <tr><td class="paramname">thresh</td><td>[in] A log-likelihood threshold (e.g. 300) that can be used to limit the number of leaves; you can use zero and set max_leaves instead. </td></tr>
    <tr><td class="paramname">max_leaves</td><td>[in] Will stop leaves being split after they reach this number. </td></tr>
    <tr><td class="paramname">num_leaves</td><td>[in,out] A pointer used to allocate leaves; always corresponds to the current number of leaves (is incremented when this is increased). </td></tr>
    <tr><td class="paramname">objf_impr_out</td><td>[out] If non-NULL, will be set to the objective improvement due to splitting (not normalized by the number of frames). </td></tr>
    <tr><td class="paramname">smallest_split_change_out</td><td>If non-NULL, will be set to the smallest objective-function improvement that we got from splitting any leaf; useful to provide a threshold for ClusterEventMap. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a> after splitting is returned; pointer is owned by caller. </dd></dl>

<p>Definition at line <a class="el" href="build-tree-utils_8cc_source.html#l00532">532</a> of file <a class="el" href="build-tree-utils_8cc_source.html">build-tree-utils.cc</a>.</p>

<p>References <a class="el" href="classkaldi_1_1EventMap.html#a6b4a37746dabb0f5ffb448433a128d34">EventMap::Copy()</a>, <a class="el" href="arpa-file-parser-test_8cc_source.html#l00065">count</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00143">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00164">KALDI_LOG</a>, and <a class="el" href="build-tree-utils_8cc_source.html#l00172">kaldi::SplitStatsByMap()</a>.</p>

<p>Referenced by <a class="el" href="tree_2build-tree_8cc_source.html#l00135">kaldi::BuildTree()</a>, <a class="el" href="tree_2build-tree_8cc_source.html#l00313">kaldi::BuildTreeTwoLevel()</a>, <a class="el" href="build-tree-utils-test_8cc_source.html#l00437">kaldi::TestClusterEventMapRestricted()</a>, <a class="el" href="build-tree-utils-test_8cc_source.html#l00535">kaldi::TestShareEventMapLeaves()</a>, and <a class="el" href="build-tree-utils-test_8cc_source.html#l00730">kaldi::TestSplitDecisionTree()</a>.</p>
<div class="fragment"><div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                                                                  {</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(num_leaves != NULL &amp;&amp; *num_leaves &gt; 0);  <span class="comment">// can&#39;t be 0 or input_map would be empty.</span></div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> num_empty_leaves = 0;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> like_impr = 0.0;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> smallest_split_change = 1.0e+20;</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;  std::vector&lt;DecisionTreeSplitter*&gt; builders;</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;  {  <span class="comment">// set up &quot;builders&quot; [one for each current leaf].  This array is never extended.</span></div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="comment">// the structures generated during splitting remain as trees at each array location.</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    std::vector&lt;BuildTreeStatsType&gt; split_stats;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <a class="code" href="group__tree__group__lower.html#ga7c608e9645daa472fc1dfbdebae86254">SplitStatsByMap</a>(stats, input_map, &amp;split_stats);</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(split_stats.size() != 0);</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;    builders.resize(split_stats.size());  <span class="comment">// size == #leaves.</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0;<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; split_stats.size();<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;      <a class="code" href="namespacekaldi.html#acd9d0bb620ecb065a310cc0b42ea736f">EventAnswerType</a> leaf = <span class="keyword">static_cast&lt;</span><a class="code" href="namespacekaldi.html#acd9d0bb620ecb065a310cc0b42ea736f">EventAnswerType</a><span class="keyword">&gt;</span>(<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;      <span class="keywordflow">if</span> (split_stats[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].size() == 0) num_empty_leaves++;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;      builders[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <span class="keyword">new</span> DecisionTreeSplitter(leaf, split_stats[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>], q_opts);</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;    }</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;  }</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;  {  <span class="comment">// Do the splitting.</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;    <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> <a class="code" href="arpa-file-parser-test_8cc.html#a951345011b75d2e8d9bfc18ca63510d2">count</a> = 0;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    std::priority_queue&lt;std::pair&lt;BaseFloat, size_t&gt; &gt; queue;  <span class="comment">// use size_t because logically these</span></div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;    <span class="comment">// are just indexes into the array, not leaf-ids (after splitting they are no longer leaf id&#39;s).</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;    <span class="comment">// Initialize queue.</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; builders.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;      queue.push(std::make_pair(builders[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;BestSplit(), <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>));</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="comment">// Note-- queue&#39;s size never changes from now.  All the alternatives leaves to split are</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;    <span class="comment">// inside the &quot;DecisionTreeSplitter*&quot; objects, in a tree structure.</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keywordflow">while</span> (queue.top().first &gt; thresh</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;          &amp;&amp; (max_leaves&lt;=0 || *num_leaves &lt; max_leaves)) {</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;      smallest_split_change = std::min(smallest_split_change, queue.top().first);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;      <span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = queue.top().second;</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;      like_impr += queue.top().first;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;      builders[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;DoSplit(num_leaves);</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;      queue.pop();</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;      queue.push(std::make_pair(builders[i]-&gt;BestSplit(), i));</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;      count++;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    }</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;DoDecisionTreeSplit: split &quot;</span>&lt;&lt; count &lt;&lt; <span class="stringliteral">&quot; times, #leaves now &quot;</span> &lt;&lt; (*num_leaves);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  }</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;  <span class="keywordflow">if</span> (smallest_split_change_out)</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;    *smallest_split_change_out = smallest_split_change;</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;  EventMap *answer = NULL;</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;  {  <span class="comment">// Create the output EventMap.</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;    std::vector&lt;EventMap*&gt; sub_trees(builders.size());</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; sub_trees.size();i++) sub_trees[i] = builders[i]-&gt;GetMap();</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;    answer = input_map.Copy(sub_trees);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; sub_trees.size();i++) <span class="keyword">delete</span> sub_trees[i];</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;  }</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;  <span class="comment">// Free up memory.</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0;i &lt; builders.size();i++) <span class="keyword">delete</span> builders[i];</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;  <span class="keywordflow">if</span> (obj_impr_out != NULL) *obj_impr_out = like_impr;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;  <span class="keywordflow">return</span> answer;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;}</div>
<div class="ttc" id="group__tree__group__lower_html_ga7c608e9645daa472fc1dfbdebae86254"><div class="ttname"><a href="group__tree__group__lower.html#ga7c608e9645daa472fc1dfbdebae86254">kaldi::SplitStatsByMap</a></div><div class="ttdeci">void SplitStatsByMap(const BuildTreeStatsType &amp;stats, const EventMap &amp;e, std::vector&lt; BuildTreeStatsType &gt; *stats_out)</div><div class="ttdoc">Splits stats according to the EventMap, indexing them at output by the leaf type. ...</div><div class="ttdef"><b>Definition:</b> <a href="build-tree-utils_8cc_source.html#l00172">build-tree-utils.cc:172</a></div></div>
<div class="ttc" id="arpa-file-parser-test_8cc_html_a951345011b75d2e8d9bfc18ca63510d2"><div class="ttname"><a href="arpa-file-parser-test_8cc.html#a951345011b75d2e8d9bfc18ca63510d2">count</a></div><div class="ttdeci">const size_t count</div><div class="ttdef"><b>Definition:</b> <a href="arpa-file-parser-test_8cc_source.html#l00065">arpa-file-parser-test.cc:65</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab7903878916593daecbeb95b98115ab0"><div class="ttname"><a href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">kaldi::int32</a></div><div class="ttdeci">int32_t int32</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00047">kaldi-types.h:47</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
<div class="ttc" id="namespacekaldi_html_acd9d0bb620ecb065a310cc0b42ea736f"><div class="ttname"><a href="namespacekaldi.html#acd9d0bb620ecb065a310cc0b42ea736f">kaldi::EventAnswerType</a></div><div class="ttdeci">int32 EventAnswerType</div><div class="ttdoc">As far as the event-map code itself is concerned, things of type EventAnswerType may take any value e...</div><div class="ttdef"><b>Definition:</b> <a href="event-map_8h_source.html#l00056">event-map.h:56</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00164">kaldi-error.h:164</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga99ffe41731f87e233abaaf5087773f61"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">EventMap* kaldi::TrivialTree </td>
          <td>(</td>
          <td class="paramtype">int32 *&#160;</td>
          <td class="paramname"><em>num_leaves</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns a tree with just one node. </p>
<p>Used @ start of tree-building process. Not really used in current recipes. </p>

<p>Definition at line <a class="el" href="build-tree-utils_8h_source.html#l00152">152</a> of file <a class="el" href="build-tree-utils_8h_source.html">build-tree-utils.h</a>.</p>

<p>Referenced by <a class="el" href="build-tree-utils-test_8cc_source.html#l00376">kaldi::TestClusterEventMap()</a>, <a class="el" href="build-tree-utils-test_8cc_source.html#l00256">kaldi::TestClusterEventMapGetMappingAndRenumberEventMap()</a>, <a class="el" href="build-tree-utils-test_8cc_source.html#l00315">kaldi::TestClusterEventMapGetMappingAndRenumberEventMap2()</a>, <a class="el" href="build-tree-utils-test_8cc_source.html#l00437">kaldi::TestClusterEventMapRestricted()</a>, <a class="el" href="build-tree-utils-test_8cc_source.html#l00206">kaldi::TestDoTableSplit()</a>, <a class="el" href="build-tree-utils-test_8cc_source.html#l00535">kaldi::TestShareEventMapLeaves()</a>, <a class="el" href="build-tree-utils-test_8cc_source.html#l00730">kaldi::TestSplitDecisionTree()</a>, and <a class="el" href="build-tree-utils-test_8cc_source.html#l00028">kaldi::TestTrivialTree()</a>.</p>
<div class="fragment"><div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                                                {</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(*num_leaves == 0);  <span class="comment">// in envisaged usage.</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;  <span class="keywordflow">return</span> <span class="keyword">new</span> ConstantEventMap( (*num_leaves)++ );</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;}</div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Apr 26 2016 14:54:46 for Kaldi by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
