<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kaldi: Decision tree internals</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <td id="projectlogo"><a href="http://kaldi-asr.org/"><img alt="Logo" src="KaldiTextAndLogoSmall.png"/ style="padding: 3px 5px 1px 5px"></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">Kaldi
   </div>
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief" style="display:none"></div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('tree_internals.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Decision tree internals </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This page describes the internals of the phonetic decision-tree clustering code, which are implemented as quite generic structures and algorithms.</p>
<p>For a higher-level view that explains the overall algorithm being implemented and how it is used by the toolkit, see <a class="el" href="tree_externals.html">How decision trees are used in Kaldi</a>.</p>
<h1><a class="anchor" id="treei_event_map"></a>
Event maps</h1>
<p>The central concept in the decision-tree building code is the event map, represented by type <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a>. Don't be misled by the term "event" to think that this is something happening at a particular time. An event is just a set of (key,value) pairs, with no key repeated. Conceptually, it could be represented by the type std::map&lt;int32,int32&gt;. In fact, for efficiency we represent it as a sorted vector of pairs, via the typedef: </p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> std::vector&lt;std::pair&lt;EventKeyType,EventValueType&gt; &gt; <a class="code" href="namespacekaldi.html#ad52ff1019e01de1ec06a179d33d3768a">EventType</a>; </div>
</div><!-- fragment --><p> Here, EventKeyType and EventValueType are just typedefs to int32, but the code is easier to understand if we use distinct names for them. Think of an Event (type EventType) as being like a collection of variables, except that the names and values of the variables are both integers. There is also the type <a class="el" href="namespacekaldi.html#acd9d0bb620ecb065a310cc0b42ea736f">EventAnswerType</a>, and this is also int32. It is the type returned by the <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a>; in practice it is a pdf identifier (acoustic-state index). Functions that require EventType expect you to have sorted it first (e.g. by calling std::sort(e.begin(),e.end()); )</p>
<p>The purpose of the <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a> class is best illustrated via an example. Suppose our phone-in-context is a/b/c; suppose we have the standard 3-state topology; and suppose we want to ask what is the index of the pdf for the central state of phone "b" in this context. The state in question would be state 1, since we use zero-based indexing. We are skimming over a few details here when we refer to "state"; see <a class="el" href="hmm.html#pdf_class">Pdf-classes</a> for more information. Suppose the integer indices of phones a, b and c are 10, 11 and 12 respectively. The "event" would correspond to the mapping: </p>
<pre class="fragment">   (0  -&gt; 10), (1  -&gt; 11), (2  -&gt; 12), (-1 -&gt; 1)</pre><p> where 0, 1 and 2 are the positions in the 3-phone window "a/b/c", and -1 is a special index we use to encode the state-id (c.f. the constant <a class="el" href="namespacekaldi.html#a4f60ee3443b23229d5ef766a26c289f9">kPdfClass</a> = -1). The way this would be represented as a sorted vector of pairs is: </p>
<div class="fragment"><div class="line"><span class="comment">// caution: not valid C++.</span></div>
<div class="line">EventType e = { {-1,1}, {0,10}, {1,11}, {2,12} }; </div>
</div><!-- fragment --><p> Suppose we that the acoustic-state index (pdf-id) corresponding to this acoustic state happens to be 1000. Then if we have an <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a> "emap" representing the tree, then we would expect the following assert not to fail: </p>
<div class="fragment"><div class="line"><a class="code" href="namespacekaldi.html#acd9d0bb620ecb065a310cc0b42ea736f">EventAnswerType</a> ans;</div>
<div class="line"><span class="keywordtype">bool</span> ret = emap.Map(e, &amp;ans); <span class="comment">// emap is of type EventMap; e is EventType</span></div>
<div class="line"><a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ret == <span class="keyword">true</span> &amp;&amp; ans == 1000);</div>
</div><!-- fragment --><p> So when we state that an <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a> is a map from EventType to EventAnswerType, you can think of this roughly as a map from a phone-in-context to an integer index. The phone-in-context is represented as a set of (key-value) pairs, and in principle we could add new keys and put in more information. Notice that the <a class="el" href="classkaldi_1_1EventMap.html#ab9622897fd6f8cb26fe2d5846416ed3f">EventMap::Map()</a> function returns bool. This is because it's possible for certain events not to map to any answer at all (e.g. consider an invalid phone, or imagine what happens when the EventType doesn't contain all the keys that the <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a> is querying).</p>
<p>The <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a> is a very passive object. It does not have any capability to learn decision-trees, it is just a means to store decision-trees. Think of it as a structure that represents a function from EventType to EventAnswerType. <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a> is a polymorphic, pure-virtual class (i.e. it cannot be instantiated because it has virtual functions that are not implemented). There are three concrete classes that implement the <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a> interface:</p>
<ul>
<li><a class="el" href="classkaldi_1_1ConstantEventMap.html">ConstantEventMap</a>: Think of this as a decision-tree leaf node. This class stores an integer of type EventAnswerType and its Map function always returns that value.</li>
<li><a class="el" href="classkaldi_1_1SplitEventMap.html">SplitEventMap</a>: Think of this as a decision-tree non-leaf node that queries a certain key and goes to the "yes" or "no" child node depending on the answer. Its Map function calls the Map function of the appropriate child node. It stores a set of integers of type kAnswerType that correspond to the "yes" child (everything else goes to "no").</li>
<li><a class="el" href="classkaldi_1_1TableEventMap.html">TableEventMap</a>: This does a complete split on a particular key. A typical example is: you might first split completely on the central phone and then have a separate decision tree for each value of that phone. Internally it stores a vector of EventMap* pointers. It looks up the value corresponding to the key that it is splitting on, and calls the Map function of the <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a> at the corresponding position in the vector.</li>
</ul>
<p>The <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a> cannot really do very much apart from map EventType to EventAnswerType. Its interface does not provide functions that allow you to traverse the tree, either up or down. There is just one function that allows you to modify the <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a>, and this is the <a class="el" href="classkaldi_1_1EventMap.html#a6b4a37746dabb0f5ffb448433a128d34">EventMap::Copy()</a> function, declared like this (as a class-member): </p>
<div class="fragment"><div class="line"><span class="keyword">virtual</span> EventMap *<a class="code" href="namespacekaldi_1_1cu.html#a42584465c09901a98e3c5094d881215e">Copy</a>(<span class="keyword">const</span> std::vector&lt;EventMap*&gt; &amp;new_leaves) <span class="keyword">const</span>;</div>
</div><!-- fragment --><p> This has an effect similar to function composition. If you call <a class="el" href="namespacekaldi_1_1cu.html#a42584465c09901a98e3c5094d881215e" title="Copies elements from src into tgt as given by copy_from_indices. ">Copy()</a> with an empty vector "new_leaves", it will just return a deep copy of the entire object, copying all the pointers as it goes down the tree. However, if new_leaves is nonempty, each time the <a class="el" href="namespacekaldi_1_1cu.html#a42584465c09901a98e3c5094d881215e" title="Copies elements from src into tgt as given by copy_from_indices. ">Copy()</a> function reaches a leaf, if that leaf <code>l</code> is within the range (0, new_leaves.size()-1) and <code>new_leaves</code>[<code>l</code>] is non-NULL, the <a class="el" href="namespacekaldi_1_1cu.html#a42584465c09901a98e3c5094d881215e" title="Copies elements from src into tgt as given by copy_from_indices. ">Copy()</a> function will return the result of calling <code>new_leaves</code>[<code>l</code>]-&gt;<code><a class="el" href="namespacekaldi_1_1cu.html#a42584465c09901a98e3c5094d881215e" title="Copies elements from src into tgt as given by copy_from_indices. ">Copy()</a></code>, rather than the <code><a class="el" href="namespacekaldi_1_1cu.html#a42584465c09901a98e3c5094d881215e" title="Copies elements from src into tgt as given by copy_from_indices. ">Copy()</a></code> function of the leaf itself (which would have returned a new <a class="el" href="classkaldi_1_1ConstantEventMap.html">ConstantEventMap</a>). A typical example is where you decide to split a particular leaf, say leaf 852. You could create an object of type vector&lt;EventMap*&gt; whose only non-NULL member is as position 852. It would contain a pointer to an object whose real type is <a class="el" href="classkaldi_1_1SplitEventMap.html">SplitEventMap</a>, and the "yes" and "no" pointers would be to type <a class="el" href="classkaldi_1_1ConstantEventMap.html">ConstantEventMap</a> with leaf values, say, 852 and 1234 (we reuse the old leaf-node id for the new leaf). The real tree-building code is not this inefficient.</p>
<h1><a class="anchor" id="treei_stats"></a>
Statistics for building the tree</h1>
<p>The statistics used to build the phonetic decision tree are of the following type: </p>
<div class="fragment"><div class="line"><span class="keyword">typedef</span> std::vector&lt;std::pair&lt;EventType, Clusterable*&gt; &gt; <a class="code" href="group__tree__group.html#gab329e7820899feed82ce631806c61975">BuildTreeStatsType</a>;</div>
</div><!-- fragment --><p> A reference to an object of this type is passed to all the decision-tree building routines. These statistics are expected to contain no duplicates with the same EventType member, i.e. they conceptually represent a map from <a class="el" href="namespacekaldi.html#ad52ff1019e01de1ec06a179d33d3768a">EventType</a> to <a class="el" href="classkaldi_1_1Clusterable.html">Clusterable</a>. In our current code the <a class="el" href="classkaldi_1_1Clusterable.html">Clusterable</a> objects are really of type <a class="el" href="classkaldi_1_1GaussClusterable.html" title="GaussClusterable wraps Gaussian statistics in a form accessible to generic clustering algorithms...">GaussClusterable</a>, but the tree-building code doesn't know this. A program that accumulates these statistics is <a class="el" href="acc-tree-stats_8cc.html">acc-tree-stats.cc</a>.</p>
<h1><a class="anchor" id="treei_func"></a>
Classes and functions involved in tree-building</h1>
<h2><a class="anchor" id="treei_func_questions"></a>
Questions (config class)</h2>
<p>The class <a class="el" href="classkaldi_1_1Questions.html" title="This class defines, for each EventKeyType, a set of initial questions that it tries and also a number...">Questions</a> is a class that in its interaction with the tree-building code, behaves a little bit like a "configuration" class. It is really a map from the "key" value (of type <a class="el" href="namespacekaldi.html#aecf39f5f52172bb00dbbe738ca2d7d51">EventKeyType</a>), to a configuration class of type <a class="el" href="structkaldi_1_1QuestionsForKey.html" title="QuestionsForKey is a class used to define the questions for a key, and also options that allow us to ...">QuestionsForKey</a>.</p>
<p>Class <a class="el" href="structkaldi_1_1QuestionsForKey.html" title="QuestionsForKey is a class used to define the questions for a key, and also options that allow us to ...">QuestionsForKey</a> has a set of "questions", each of which is just a set of integers of type <a class="el" href="namespacekaldi.html#a568b789a0df90eb2b79de13c95133b1b">EventValueType</a>; these mostly correspond to sets of phones, or if the key is -1, they would in the typical case correspond to sets of HMM-state indices, i.e. subsets of {0,1,2}. <a class="el" href="structkaldi_1_1QuestionsForKey.html" title="QuestionsForKey is a class used to define the questions for a key, and also options that allow us to ...">QuestionsForKey</a> also contains a configuration class of type <a class="el" href="structkaldi_1_1RefineClustersOptions.html">RefineClustersOptions</a>. This controls tree-building behaviour in that the tree-building code will attempt to iteratively move values (e.g. phones) between the two sides of the split in order to maximize likelihood (as in K-means with K=2). However, this can be turned off by setting the number of iterations of "refining clusters" to zero, which corresponds to just choosing from among a fixed list of questions. This seems to work a bit better.</p>
<h2><a class="anchor" id="treei_func_low"></a>
Lowest-level functions</h2>
<p>See <a class="el" href="group__tree__group__lower.html">Low-level functions for manipulating statistics and event-maps</a> for a complete list; we summarize some important ones here.</p>
<p>These functions mostly involve manipulations of objects of type BuildTreeStatsType, which as we saw above is a vector of pairs of (EventType, Clusterable*). The simplest ones are <a class="el" href="group__tree__group__lower.html#ga33e6c91c3ab79436fae03a307d89fa5d" title="This frees the Clusterable* pointers in &quot;stats&quot;, where non-NULL, and sets them to NULL...">DeleteBuildTreeStats()</a>, <a class="el" href="group__tree__group__lower.html#ga9a15a2d49fdd5c582a8cf297d318bba9" title="Writes BuildTreeStats object. This works even if pointers are NULL. ">WriteBuildTreeStats()</a> and <a class="el" href="group__tree__group__lower.html#gade1498f052d23c6b9ce3af76deb4f870" title="Reads BuildTreeStats object. ">ReadBuildTreeStats()</a>.</p>
<p>The function <a class="el" href="group__tree__group__lower.html#ga173f643fb842958832b4b40edce2eb69" title="Convenience function e.g. ">PossibleValues()</a> finds out which values a particular key takes within a collection of statistics (and informs the user whether or not the key was always defined); <a class="el" href="group__tree__group__lower.html#gaec24b5b9b04af079fd741a4c262fc654" title="SplitStatsByKey splits stats up according to the value of a particular key, which must be always defi...">SplitStatsByKey()</a> will split up an object of type BuildTreeStatsType into a vector&lt;BuildTreeStatsType&gt; according to the value taken by a particular key (e.g. splitting on the central phone); <a class="el" href="group__tree__group__lower.html#ga7c608e9645daa472fc1dfbdebae86254" title="Splits stats according to the EventMap, indexing them at output by the leaf type. ...">SplitStatsByMap()</a> does the same but the index is not the value for that key, but the answer returned by an <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a> that is provided to the function.</p>
<p><a class="el" href="group__tree__group__lower.html#ga70816f7f5e5240ac2f61e70c8d6a9640" title="Sums stats, or returns NULL stats_in has no non-NULL stats. ">SumStats()</a> sums up the statistics (i.e. the <a class="el" href="classkaldi_1_1Clusterable.html">Clusterable</a> objects) in an object of BuildTreeStatsType and returns corresponding Clusterable* object. <a class="el" href="group__tree__group__lower.html#ga8c594556191d0401cf83ebab7bebf068" title="Sum a vector of stats. ">SumStatsVec()</a> takes an object of type vector&lt;BuildTreeStatsType&gt; and outputs something of type vector&lt;Clusterable*&gt;, i.e. it's like <a class="el" href="group__tree__group__lower.html#ga70816f7f5e5240ac2f61e70c8d6a9640" title="Sums stats, or returns NULL stats_in has no non-NULL stats. ">SumStats()</a> but for a vector; it's useful in processing the output of <a class="el" href="group__tree__group__lower.html#gaec24b5b9b04af079fd741a4c262fc654" title="SplitStatsByKey splits stats up according to the value of a particular key, which must be always defi...">SplitStatsByKey()</a> and <a class="el" href="group__tree__group__lower.html#ga7c608e9645daa472fc1dfbdebae86254" title="Splits stats according to the EventMap, indexing them at output by the leaf type. ...">SplitStatsByMap()</a>.</p>
<p><a class="el" href="group__tree__group__lower.html#ga9d8695592350c5d11ae73317d261cd1d" title="Cluster the stats given the event map return the total objf given those clusters. ...">ObjfGivenMap()</a> evaluates the objective function given some statistics and an <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a>: it sums up all the statistics within each cluster (corresponding to each distinct answer of the <a class="el" href="classkaldi_1_1EventMap.html#ab9622897fd6f8cb26fe2d5846416ed3f">EventMap::Map()</a> function), adds up the objective functions across the clusters, and returns the total.</p>
<p><a class="el" href="group__tree__group__lower.html#gafb5056f250693994d84f68ae6b07e8e3" title="FindAllKeys puts in *keys the (sorted, unique) list of all key identities in the stats. ">FindAllKeys()</a> will find all the keys that are defined in a collection of statistics, and depending on the arguments it can find all keys that are defined for all the events, or all the keys that are defined for any event (i.e. take the intersection or union of sets of defined keys).</p>
<h2><a class="anchor" id="treei_func_intermediate"></a>
Intermediate-level functions</h2>
<p>The next group of functions involved in tree building are listed <a class="el" href="group__tree__group__intermediate.html">here</a> and correspond to various stages of tree building. We will now only mention some representative ones.</p>
<p>Firstly, we point out that a lot of these functions have a parameter int32 num_leaves. The integer which this points to acts as a counter to allocate new leaves. At the start of tree building the caller would set it to zero. Aach time a new leaf is required, the tree-building code takes the number it currently points to as the new leaf-id, and then increments it.</p>
<p>One important function is <a class="el" href="group__tree__group__intermediate.html#ga7e642ce32f4019c2987e0a168445c1ff" title="GetStubMap is used in tree-building functions to get the initial to-states map, before the decision-t...">GetStubMap()</a>. This function returns a tree that has not yet been split, i.e. the pdfs do not depend on the context. The input to this function controls whether all the phones are distinct or some of them share decision-tree roots, and whether all the states within a particular phone share the same decision-tree root.</p>
<p>The function <a class="el" href="group__tree__group__intermediate.html#gaa4da1fcb3f12d5c116948d37448d9e46" title="Does a decision-tree split at the leaves of an EventMap. ">SplitDecisionTree()</a> takes as input an <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a> that would normally correspond to a non-split "stub" decision tree of the type created by <a class="el" href="group__tree__group__intermediate.html#ga7e642ce32f4019c2987e0a168445c1ff" title="GetStubMap is used in tree-building functions to get the initial to-states map, before the decision-t...">GetStubMap()</a>, and does the decision-tree splitting until either the maximum number of leaves has been reached, or the gain from splitting a leaf is less than a specified threshold.</p>
<p>The function <a class="el" href="group__tree__group__intermediate.html#ga1b9fb1772db76d08aa37f00c9eb47e5e" title="This is as ClusterEventMapGetMapping but a more convenient interface that exposes less of the interna...">ClusterEventMap()</a> takes an <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a> and a threshold, and merges the leaves of the <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a> as long as the cost of doing so is less than the threshold. This function would normally be called after <a class="el" href="group__tree__group__intermediate.html#gaa4da1fcb3f12d5c116948d37448d9e46" title="Does a decision-tree split at the leaves of an EventMap. ">SplitDecisionTree()</a>. There are other versions of this function that operate with restrictions (e.g. to avoid merging leaves from distinct phones).</p>
<h2><a class="anchor" id="treei_func_top"></a>
Top-level tree-building functions</h2>
<p>The top-level tree-building functions are listed <a class="el" href="group__tree__group__top.html">here</a>. These functions are called directly from the command-line programs. The most important one is <a class="el" href="group__tree__group__top.html#gad6daf95a27b092517d50f0acbcea4b59" title="BuildTree is the normal way to build a set of decision trees. ">BuildTree()</a>. It is given a <a class="el" href="classkaldi_1_1Questions.html" title="This class defines, for each EventKeyType, a set of initial questions that it tries and also a number...">Questions</a> configuration class, and some information about sets of phones whose roots to share and (for each set of phones) whether to share the <a class="el" href="hmm.html#pdf_class">pdf-classes</a> in a single decision tree root or to have a separate root for each pdf-class. It is also passed information about the lengths of the phones, plus various thresholds. It builds the tree and returns the <a class="el" href="classkaldi_1_1EventMap.html" title="A class that is capable of representing a generic mapping from EventType (which is a vector of (key...">EventMap</a> object which is used to construct the <a class="el" href="classkaldi_1_1ContextDependency.html">ContextDependency</a> object.</p>
<p>Another important routine in this group is <a class="el" href="group__tree__group__top.html#gaaa86991990615fc25dce24e8e13e1fb4" title="Outputs sets of phones that are reasonable for questions to ask in the tree-building algorithm...">AutomaticallyObtainQuestions()</a>, which used to obtain questions via automatic clustering of phones. It clusters the phones into a tree, and for each node in the tree, all leaves accessible from that node form one question (questions are equivalent to sets of phones). This (called from <a class="el" href="cluster-phones_8cc.html">cluster-phones.cc</a>) makes our recipes independent of human-generated phone sets.</p>
<p>The function <a class="el" href="namespacekaldi.html#a8be6e4d8555478bf47183acd8d8337ee" title="Accumulates the stats needed for training context-dependency trees (in the &quot;normal&quot; way)...">AccumulateTreeStats()</a> accumulates statistics for training the tree, given features and an alignment that is a sequence of transition-ids (see <a class="el" href="hmm.html#transition_model_identifiers">Integer identifiers used by TransitionModel</a>). This function is defined in a different directory from the other tree-building-related functions (hmm/ not tree/) as it depends on more code (e.g. it knows about the the <a class="el" href="classkaldi_1_1TransitionModel.html">TransitionModel</a> class), and we preferred to keep the dependencies of the core tree-building code to a minimum.</p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Kaldi</a></li>
    <li class="footer">Generated on Thu Apr 28 2016 15:42:38 for Kaldi by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
