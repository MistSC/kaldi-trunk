<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kaldi: Classes and functions for creating FSTs from HMMs</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <td id="projectlogo"><a href="http://kaldi-asr.org/"><img alt="Logo" src="KaldiTextAndLogoSmall.png"/ style="padding: 3px 5px 1px 5px"></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">Kaldi
   </div>
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief" style="display:none"></div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__hmm__group__graph.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Classes and functions for creating FSTs from HMMs<div class="ingroups"><a class="el" href="group__hmm__group.html">Classes and functions related to HMM topology and transition modeling</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for Classes and functions for creating FSTs from HMMs:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__hmm__group__graph.png" border="0" alt="" usemap="#group____hmm____group____graph"/>
<map name="group____hmm____group____graph" id="group____hmm____group____graph">
<area shape="rect" id="node1" href="group__hmm__group.html" title="Classes and functions\l related to HMM topology\l and transition modeling" alt="" coords="6,4,189,60"/></map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1HTransducerConfig.html">HTransducerConfig</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Configuration class for the <a class="el" href="group__hmm__group__graph.html#gade0dda4e298562cc32dee6962e0ff0c9" title="Returns the H tranducer; result owned by caller. ">GetHTransducer()</a> function; see <a class="el" href="hmm.html#hmm_graph_config">The HTransducerConfig configuration class</a> for context.  <a href="structkaldi_1_1HTransducerConfig.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structkaldi_1_1HmmCacheHash.html">HmmCacheHash</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:gaf603f501ad03cb3632179ef5aa36b73e"><td class="memItemLeft" align="right" valign="top">typedef unordered_map<br class="typebreak"/>
&lt; std::pair&lt; int32, <br class="typebreak"/>
std::vector&lt; int32 &gt;<br class="typebreak"/>
 &gt;, fst::VectorFst<br class="typebreak"/>
&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt;<br class="typebreak"/>
 *, HmmCacheHash &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hmm__group__graph.html#gaf603f501ad03cb3632179ef5aa36b73e">HmmCacheType</a></td></tr>
<tr class="memdesc:gaf603f501ad03cb3632179ef5aa36b73e"><td class="mdescLeft">&#160;</td><td class="mdescRight">HmmCacheType is a map from (central-phone, sequence of pdf-ids) to FST, used as cache in GetHmmAsFst, as an optimization.  <a href="#gaf603f501ad03cb3632179ef5aa36b73e">More...</a><br/></td></tr>
<tr class="separator:gaf603f501ad03cb3632179ef5aa36b73e"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gafadba59dd704d43aa0a3c69e0f3a473d"><td class="memItemLeft" align="right" valign="top">fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hmm__group__graph.html#gafadba59dd704d43aa0a3c69e0f3a473d">GetHmmAsFst</a> (std::vector&lt; int32 &gt; context_window, const ContextDependencyInterface &amp;ctx_dep, const TransitionModel &amp;trans_model, const HTransducerConfig &amp;config, HmmCacheType *cache=NULL)</td></tr>
<tr class="memdesc:gafadba59dd704d43aa0a3c69e0f3a473d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Called by <a class="el" href="group__hmm__group__graph.html#gade0dda4e298562cc32dee6962e0ff0c9" title="Returns the H tranducer; result owned by caller. ">GetHTransducer()</a> and probably will not need to be called directly; it creates the FST corresponding to the phone.  <a href="#gafadba59dd704d43aa0a3c69e0f3a473d">More...</a><br/></td></tr>
<tr class="separator:gafadba59dd704d43aa0a3c69e0f3a473d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac4ea836399551f07c71147098f8c6b47"><td class="memItemLeft" align="right" valign="top">fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hmm__group__graph.html#gac4ea836399551f07c71147098f8c6b47">GetHmmAsFstSimple</a> (std::vector&lt; int32 &gt; context_window, const ContextDependencyInterface &amp;ctx_dep, const TransitionModel &amp;trans_model, BaseFloat prob_scale)</td></tr>
<tr class="memdesc:gac4ea836399551f07c71147098f8c6b47"><td class="mdescLeft">&#160;</td><td class="mdescRight">Included mainly as a form of documentation, not used in any other code currently.  <a href="#gac4ea836399551f07c71147098f8c6b47">More...</a><br/></td></tr>
<tr class="separator:gac4ea836399551f07c71147098f8c6b47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gade0dda4e298562cc32dee6962e0ff0c9"><td class="memItemLeft" align="right" valign="top">fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hmm__group__graph.html#gade0dda4e298562cc32dee6962e0ff0c9">GetHTransducer</a> (const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;ilabel_info, const ContextDependencyInterface &amp;ctx_dep, const TransitionModel &amp;trans_model, const HTransducerConfig &amp;config, std::vector&lt; int32 &gt; *disambig_syms_left)</td></tr>
<tr class="memdesc:gade0dda4e298562cc32dee6962e0ff0c9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the H tranducer; result owned by caller.  <a href="#gade0dda4e298562cc32dee6962e0ff0c9">More...</a><br/></td></tr>
<tr class="separator:gade0dda4e298562cc32dee6962e0ff0c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga204bf084239aa1ea304b5b7b987aa098"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hmm__group__graph.html#ga204bf084239aa1ea304b5b7b987aa098">GetIlabelMapping</a> (const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;ilabel_info_old, const ContextDependencyInterface &amp;ctx_dep, const TransitionModel &amp;trans_model, std::vector&lt; int32 &gt; *old2new_map)</td></tr>
<tr class="memdesc:ga204bf084239aa1ea304b5b7b987aa098"><td class="mdescLeft">&#160;</td><td class="mdescRight">GetIlabelMapping produces a mapping that's similar to HTK's logical-to-physical model mapping (i.e.  <a href="#ga204bf084239aa1ea304b5b7b987aa098">More...</a><br/></td></tr>
<tr class="separator:ga204bf084239aa1ea304b5b7b987aa098"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga938df29bca5ca1f3954733b5c3c53dc6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hmm__group__graph.html#ga938df29bca5ca1f3954733b5c3c53dc6">AddSelfLoops</a> (const TransitionModel &amp;trans_model, const std::vector&lt; int32 &gt; &amp;disambig_syms,BaseFloat self_loop_scale, bool reorder,fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; *fst)</td></tr>
<tr class="memdesc:ga938df29bca5ca1f3954733b5c3c53dc6"><td class="mdescLeft">&#160;</td><td class="mdescRight">For context, see <a class="el" href="hmm.html#hmm_graph_add_self_loops">AddSelfLoops()</a>.  <a href="#ga938df29bca5ca1f3954733b5c3c53dc6">More...</a><br/></td></tr>
<tr class="separator:ga938df29bca5ca1f3954733b5c3c53dc6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga67218f63ca04115462e0af7143e12ddb"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hmm__group__graph.html#ga67218f63ca04115462e0af7143e12ddb">AddTransitionProbs</a> (const TransitionModel &amp;trans_model, const std::vector&lt; int32 &gt; &amp;disambig_syms, BaseFloat transition_scale, BaseFloat self_loop_scale, fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; *fst)</td></tr>
<tr class="memdesc:ga67218f63ca04115462e0af7143e12ddb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Adds transition-probs, with the supplied scales (see <a class="el" href="hmm.html#hmm_scale">Scaling of transition and acoustic probabilities</a>), to the graph.  <a href="#ga67218f63ca04115462e0af7143e12ddb">More...</a><br/></td></tr>
<tr class="separator:ga67218f63ca04115462e0af7143e12ddb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga23ca8403b997d73fdd0f72c51b1b9a87"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hmm__group__graph.html#ga23ca8403b997d73fdd0f72c51b1b9a87">AddTransitionProbs</a> (const TransitionModel &amp;trans_model, BaseFloat transition_scale, BaseFloat self_loop_scale, Lattice *lat)</td></tr>
<tr class="memdesc:ga23ca8403b997d73fdd0f72c51b1b9a87"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is as <a class="el" href="group__hmm__group__graph.html#ga938df29bca5ca1f3954733b5c3c53dc6" title="For context, see AddSelfLoops(). ">AddSelfLoops()</a>, but operates on a Lattice, where it affects the graph part of the weight (the first element of the pair).  <a href="#ga23ca8403b997d73fdd0f72c51b1b9a87">More...</a><br/></td></tr>
<tr class="separator:ga23ca8403b997d73fdd0f72c51b1b9a87"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gae04ff751dd230f18c7091b28bac598a1"><td class="memItemLeft" align="right" valign="top">fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hmm__group__graph.html#gae04ff751dd230f18c7091b28bac598a1">GetPdfToTransitionIdTransducer</a> (const TransitionModel &amp;trans_model)</td></tr>
<tr class="memdesc:gae04ff751dd230f18c7091b28bac598a1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns a transducer from pdfs plus one (input) to transition-ids (output).  <a href="#gae04ff751dd230f18c7091b28bac598a1">More...</a><br/></td></tr>
<tr class="separator:gae04ff751dd230f18c7091b28bac598a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa89b6ecebeea9ee1c62dd63382b40950"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__hmm__group__graph.html#gaa89b6ecebeea9ee1c62dd63382b40950">ConvertTransitionIdsToPdfs</a> (const TransitionModel &amp;trans_model, const std::vector&lt; int32 &gt; &amp;disambig_syms, fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; *fst)</td></tr>
<tr class="memdesc:gaa89b6ecebeea9ee1c62dd63382b40950"><td class="mdescLeft">&#160;</td><td class="mdescRight">Converts all transition-ids in the FST to pdfs plus one.  <a href="#gaa89b6ecebeea9ee1c62dd63382b40950">More...</a><br/></td></tr>
<tr class="separator:gaa89b6ecebeea9ee1c62dd63382b40950"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<h2 class="groupheader">Typedef Documentation</h2>
<a class="anchor" id="gaf603f501ad03cb3632179ef5aa36b73e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef unordered_map&lt;std::pair&lt;int32, std::vector&lt;int32&gt; &gt;, fst::VectorFst&lt;<a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a>&gt;*, HmmCacheHash&gt; HmmCacheType</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>HmmCacheType is a map from (central-phone, sequence of pdf-ids) to FST, used as cache in GetHmmAsFst, as an optimization. </p>

<p>Definition at line <a class="el" href="hmm-utils_8h_source.html#l00092">92</a> of file <a class="el" href="hmm-utils_8h_source.html">hmm-utils.h</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga938df29bca5ca1f3954733b5c3c53dc6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AddSelfLoops </td>
          <td>(</td>
          <td class="paramtype">const TransitionModel &amp;&#160;</td>
          <td class="paramname"><em>trans_model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>disambig_syms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BaseFloat&#160;</td>
          <td class="paramname"><em>self_loop_scale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>reorder</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; *&#160;</td>
          <td class="paramname"><em>fst</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>For context, see <a class="el" href="hmm.html#hmm_graph_add_self_loops">AddSelfLoops()</a>. </p>
<p>Expands an FST that has been built without self-loops, and adds the self-loops (it also needs to modify the probability of the non-self-loop ones, as the graph without self-loops was created in such a way that it was stochastic). Note that the disambig_syms will be empty in some recipes (e.g. if you already removed the disambiguation symbols). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">trans_model</td><td>[in] Transition model </td></tr>
    <tr><td class="paramname">disambig_syms</td><td>[in] Sorted, uniq list of disambiguation symbols, required if the graph contains disambiguation symbols but only needed for sanity checks. </td></tr>
    <tr><td class="paramname">self_loop_scale</td><td>[in] Transition-probability scale for self-loops; c.f. <a class="el" href="hmm.html#hmm_scale">Scaling of transition and acoustic probabilities</a> </td></tr>
    <tr><td class="paramname">reorder</td><td>[in] If true, reorders the transitions (see <a class="el" href="hmm.html#hmm_reorder">Reordering transitions</a>). </td></tr>
    <tr><td class="paramname">fst</td><td>[in, out] The FST to be modified. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="hmm-utils_8cc_source.html#l00570">570</a> of file <a class="el" href="hmm-utils_8cc_source.html">hmm-utils.cc</a>.</p>

<p>References <a class="el" href="hmm-utils_8cc_source.html#l00525">kaldi::AddSelfLoopsAfter()</a>, <a class="el" href="hmm-utils_8cc_source.html#l00445">kaldi::AddSelfLoopsBefore()</a>, and <a class="el" href="kaldi-error_8h_source.html#l00143">KALDI_ASSERT</a>.</p>

<p>Referenced by <a class="el" href="training-graph-compiler_8cc_source.html#l00071">TrainingGraphCompiler::CompileGraph()</a>, <a class="el" href="training-graph-compiler_8cc_source.html#l00164">TrainingGraphCompiler::CompileGraphs()</a>, and <a class="el" href="add-self-loops_8cc_source.html#l00032">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                                                {</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(fst-&gt;Start() != fst::kNoStateId);</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;  <span class="keywordflow">if</span> (reorder)</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;    <a class="code" href="namespacekaldi.html#a5c1f571c6aec6eccbe0e62629a24caf5">AddSelfLoopsBefore</a>(trans_model, disambig_syms, self_loop_scale, fst);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;  <span class="keywordflow">else</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <a class="code" href="namespacekaldi.html#a6e9e2a9a546006137d7f41d93ed7ad9e">AddSelfLoopsAfter</a>(trans_model, disambig_syms, self_loop_scale, fst);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;}</div>
<div class="ttc" id="namespacekaldi_html_a5c1f571c6aec6eccbe0e62629a24caf5"><div class="ttname"><a href="namespacekaldi.html#a5c1f571c6aec6eccbe0e62629a24caf5">kaldi::AddSelfLoopsBefore</a></div><div class="ttdeci">static void AddSelfLoopsBefore(const TransitionModel &amp;trans_model, const std::vector&lt; int32 &gt; &amp;disambig_syms, BaseFloat self_loop_scale, fst::VectorFst&lt; fst::StdArc &gt; *fst)</div><div class="ttdef"><b>Definition:</b> <a href="hmm-utils_8cc_source.html#l00445">hmm-utils.cc:445</a></div></div>
<div class="ttc" id="namespacekaldi_html_a6e9e2a9a546006137d7f41d93ed7ad9e"><div class="ttname"><a href="namespacekaldi.html#a6e9e2a9a546006137d7f41d93ed7ad9e">kaldi::AddSelfLoopsAfter</a></div><div class="ttdeci">static void AddSelfLoopsAfter(const TransitionModel &amp;trans_model, const std::vector&lt; int32 &gt; &amp;disambig_syms, BaseFloat self_loop_scale, fst::VectorFst&lt; fst::StdArc &gt; *fst)</div><div class="ttdef"><b>Definition:</b> <a href="hmm-utils_8cc_source.html#l00525">hmm-utils.cc:525</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga67218f63ca04115462e0af7143e12ddb"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AddTransitionProbs </td>
          <td>(</td>
          <td class="paramtype">const TransitionModel &amp;&#160;</td>
          <td class="paramname"><em>trans_model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>disambig_syms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BaseFloat&#160;</td>
          <td class="paramname"><em>transition_scale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BaseFloat&#160;</td>
          <td class="paramname"><em>self_loop_scale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; *&#160;</td>
          <td class="paramname"><em>fst</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Adds transition-probs, with the supplied scales (see <a class="el" href="hmm.html#hmm_scale">Scaling of transition and acoustic probabilities</a>), to the graph. </p>
<p>Useful if you want to create a graph without transition probs, then possibly train the model (including the transition probs) but keep the graph fixed, and add back in the transition probs. It assumes the fst has transition-ids on it. It is not an error if the FST has no states (nothing will be done). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">trans_model</td><td>[in] The transition model </td></tr>
    <tr><td class="paramname">disambig_syms</td><td>[in] A list of disambiguation symbols, required if the graph has disambiguation symbols on its input but only used for checks. </td></tr>
    <tr><td class="paramname">transition_scale</td><td>[in] A scale on transition-probabilities apart from those involving self-loops; see <a class="el" href="hmm.html#hmm_scale">Scaling of transition and acoustic probabilities</a>. </td></tr>
    <tr><td class="paramname">self_loop_scale</td><td>[in] A scale on self-loop transition probabilities; see <a class="el" href="hmm.html#hmm_scale">Scaling of transition and acoustic probabilities</a>. </td></tr>
    <tr><td class="paramname">fst</td><td>[in, out] The FST to be modified. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="hmm-utils_8cc_source.html#l00968">968</a> of file <a class="el" href="hmm-utils_8cc_source.html">hmm-utils.cc</a>.</p>

<p>References <a class="el" href="hmm-utils_8cc_source.html#l00945">kaldi::GetScaledTransitionLogProb()</a>, <a class="el" href="stl-utils_8h_source.html#l00075">kaldi::IsSortedAndUniq()</a>, <a class="el" href="kaldi-error_8h_source.html#l00143">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00160">KALDI_ERR</a>, <a class="el" href="transition-model_8h_source.html#l00166">TransitionModel::NumTransitionIds()</a>, and <a class="el" href="lattice-weight_8h_source.html#l00332">fst::Times()</a>.</p>

<p>Referenced by <a class="el" href="align-compiled-mapped_8cc_source.html#l00031">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                                                      {</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <span class="keyword">using namespace </span>fst;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="namespacekaldi.html#a81dfa76eeac63eba502e32ee58e37d57">IsSortedAndUniq</a>(disambig_syms));</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  <span class="keywordtype">int</span> num_tids = trans_model.NumTransitionIds();</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  <span class="keywordflow">for</span> (StateIterator&lt;VectorFst&lt;StdArc&gt; &gt; siter(*fst);</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;      !siter.Done();</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;      siter.Next()) {</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;    <span class="keywordflow">for</span> (MutableArcIterator&lt;VectorFst&lt;StdArc&gt; &gt; aiter(fst, siter.Value());</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;         !aiter.Done();</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;         aiter.Next()) {</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;      <a class="code" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">StdArc</a> arc = aiter.Value();</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;      <a class="code" href="lattice-arcgraph_8cc.html#a006b00477e4d9250474e76e1ec61bb3f">StdArc::Label</a> l = arc.ilabel;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;      <span class="keywordflow">if</span> (l &gt;= 1 &amp;&amp; l &lt;= num_tids) {  <span class="comment">// a transition-id.</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        <a class="code" href="namespacefst.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> scaled_log_prob = <a class="code" href="namespacekaldi.html#aa9e82a3b0e8f208e37fd97ddc69efbc6">GetScaledTransitionLogProb</a>(trans_model,</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;                                                               l,</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;                                                               transition_scale,</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                                                               self_loop_scale);</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        arc.weight = <a class="code" href="namespacefst.html#a0807071c6ceb397bc35281fce74ff8a7">Times</a>(arc.weight, TropicalWeight(-scaled_log_prob));</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (l != 0) {</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;        <span class="keywordflow">if</span> (!std::binary_search(disambig_syms.begin(), disambig_syms.end(),</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                               arc.ilabel))</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;          <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;AddTransitionProbs: invalid symbol &quot;</span> &lt;&lt; arc.ilabel</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                    &lt;&lt; <span class="stringliteral">&quot; on graph input side.&quot;</span>;</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;      }</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;      aiter.SetValue(arc);</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;    }</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;  }</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;}</div>
<div class="ttc" id="namespacefst_html_a70478eb2428a9406e4692d19a7a3a97f"><div class="ttname"><a href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a></div><div class="ttdeci">fst::StdArc StdArc</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00053">deterministic-fst-test.cc:53</a></div></div>
<div class="ttc" id="namespacefst_html_a0807071c6ceb397bc35281fce74ff8a7"><div class="ttname"><a href="namespacefst.html#a0807071c6ceb397bc35281fce74ff8a7">fst::Times</a></div><div class="ttdeci">LatticeWeightTpl&lt; FloatType &gt; Times(const LatticeWeightTpl&lt; FloatType &gt; &amp;w1, const LatticeWeightTpl&lt; FloatType &gt; &amp;w2)</div><div class="ttdef"><b>Definition:</b> <a href="lattice-weight_8h_source.html#l00332">lattice-weight.h:332</a></div></div>
<div class="ttc" id="lattice-arcgraph_8cc_html_a006b00477e4d9250474e76e1ec61bb3f"><div class="ttname"><a href="lattice-arcgraph_8cc.html#a006b00477e4d9250474e76e1ec61bb3f">Label</a></div><div class="ttdeci">fst::StdArc::Label Label</div><div class="ttdef"><b>Definition:</b> <a href="lattice-arcgraph_8cc_source.html#l00029">lattice-arcgraph.cc:29</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00160">kaldi-error.h:160</a></div></div>
<div class="ttc" id="namespacefst_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacefst.html#aa66ff8367094543664b3b6a13d77c139">fst::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="lattice-weight-test_8cc_source.html#l00026">lattice-weight-test.cc:26</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa9e82a3b0e8f208e37fd97ddc69efbc6"><div class="ttname"><a href="namespacekaldi.html#aa9e82a3b0e8f208e37fd97ddc69efbc6">kaldi::GetScaledTransitionLogProb</a></div><div class="ttdeci">static BaseFloat GetScaledTransitionLogProb(const TransitionModel &amp;trans_model, int32 trans_id, BaseFloat transition_scale, BaseFloat self_loop_scale)</div><div class="ttdef"><b>Definition:</b> <a href="hmm-utils_8cc_source.html#l00945">hmm-utils.cc:945</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
<div class="ttc" id="namespacekaldi_html_a81dfa76eeac63eba502e32ee58e37d57"><div class="ttname"><a href="namespacekaldi.html#a81dfa76eeac63eba502e32ee58e37d57">kaldi::IsSortedAndUniq</a></div><div class="ttdeci">bool IsSortedAndUniq(const std::vector&lt; T &gt; &amp;vec)</div><div class="ttdoc">Returns true if the vector is sorted and contains each element only once. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00075">stl-utils.h:75</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga23ca8403b997d73fdd0f72c51b1b9a87"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AddTransitionProbs </td>
          <td>(</td>
          <td class="paramtype">const TransitionModel &amp;&#160;</td>
          <td class="paramname"><em>trans_model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BaseFloat&#160;</td>
          <td class="paramname"><em>transition_scale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BaseFloat&#160;</td>
          <td class="paramname"><em>self_loop_scale</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Lattice *&#160;</td>
          <td class="paramname"><em>lat</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This is as <a class="el" href="group__hmm__group__graph.html#ga938df29bca5ca1f3954733b5c3c53dc6" title="For context, see AddSelfLoops(). ">AddSelfLoops()</a>, but operates on a Lattice, where it affects the graph part of the weight (the first element of the pair). </p>

<p>Definition at line <a class="el" href="hmm-utils_8cc_source.html#l01001">1001</a> of file <a class="el" href="hmm-utils_8cc_source.html">hmm-utils.cc</a>.</p>

<p>References <a class="el" href="hmm-utils_8cc_source.html#l00945">kaldi::GetScaledTransitionLogProb()</a>, <a class="el" href="kaldi-error_8h_source.html#l00160">KALDI_ERR</a>, and <a class="el" href="transition-model_8h_source.html#l00166">TransitionModel::NumTransitionIds()</a>.</p>
<div class="fragment"><div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                                      {</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;  <span class="keyword">using namespace </span>fst;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;  <span class="keywordtype">int</span> num_tids = trans_model.NumTransitionIds();</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;  <span class="keywordflow">for</span> (fst::StateIterator&lt;Lattice&gt; siter(*lat);</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;       !siter.Done();</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;       siter.Next()) {</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;    <span class="keywordflow">for</span> (MutableArcIterator&lt;Lattice&gt; aiter(lat, siter.Value());</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;         !aiter.Done();</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;         aiter.Next()) {</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;      <a class="code" href="namespacekaldi.html#a417e37822095c5adb9680fa07dffea8d">LatticeArc</a> arc = aiter.Value();</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;      <a class="code" href="lattice-arcgraph_8cc.html#a006b00477e4d9250474e76e1ec61bb3f">LatticeArc::Label</a> l = arc.ilabel;</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;      <span class="keywordflow">if</span> (l &gt;= 1 &amp;&amp; l &lt;= num_tids) {  <span class="comment">// a transition-id.</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;        <a class="code" href="namespacefst.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> scaled_log_prob = <a class="code" href="namespacekaldi.html#aa9e82a3b0e8f208e37fd97ddc69efbc6">GetScaledTransitionLogProb</a>(trans_model,</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;                                                               l,</div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;                                                               transition_scale,</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                                                               self_loop_scale);</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;        <span class="comment">// cost is negated log prob.</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;        arc.weight.SetValue1(arc.weight.Value1() - scaled_log_prob);</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (l != 0) {</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;AddTransitionProbs: invalid symbol &quot;</span> &lt;&lt; arc.ilabel</div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot; on lattice input side.&quot;</span>;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;      }</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;      aiter.SetValue(arc);</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;    }</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;  }</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;}</div>
<div class="ttc" id="namespacekaldi_html_a417e37822095c5adb9680fa07dffea8d"><div class="ttname"><a href="namespacekaldi.html#a417e37822095c5adb9680fa07dffea8d">kaldi::LatticeArc</a></div><div class="ttdeci">fst::ArcTpl&lt; LatticeWeight &gt; LatticeArc</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-lattice_8h_source.html#l00040">kaldi-lattice.h:40</a></div></div>
<div class="ttc" id="lattice-arcgraph_8cc_html_a006b00477e4d9250474e76e1ec61bb3f"><div class="ttname"><a href="lattice-arcgraph_8cc.html#a006b00477e4d9250474e76e1ec61bb3f">Label</a></div><div class="ttdeci">fst::StdArc::Label Label</div><div class="ttdef"><b>Definition:</b> <a href="lattice-arcgraph_8cc_source.html#l00029">lattice-arcgraph.cc:29</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00160">kaldi-error.h:160</a></div></div>
<div class="ttc" id="namespacefst_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacefst.html#aa66ff8367094543664b3b6a13d77c139">fst::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="lattice-weight-test_8cc_source.html#l00026">lattice-weight-test.cc:26</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa9e82a3b0e8f208e37fd97ddc69efbc6"><div class="ttname"><a href="namespacekaldi.html#aa9e82a3b0e8f208e37fd97ddc69efbc6">kaldi::GetScaledTransitionLogProb</a></div><div class="ttdeci">static BaseFloat GetScaledTransitionLogProb(const TransitionModel &amp;trans_model, int32 trans_id, BaseFloat transition_scale, BaseFloat self_loop_scale)</div><div class="ttdef"><b>Definition:</b> <a href="hmm-utils_8cc_source.html#l00945">hmm-utils.cc:945</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gaa89b6ecebeea9ee1c62dd63382b40950"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kaldi::ConvertTransitionIdsToPdfs </td>
          <td>(</td>
          <td class="paramtype">const TransitionModel &amp;&#160;</td>
          <td class="paramname"><em>trans_model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>disambig_syms</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; *&#160;</td>
          <td class="paramname"><em>fst</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Converts all transition-ids in the FST to pdfs plus one. </p>
<p>Placeholder: not implemented yet! </p>

</div>
</div>
<a class="anchor" id="gafadba59dd704d43aa0a3c69e0f3a473d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; * GetHmmAsFst </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; int32 &gt;&#160;</td>
          <td class="paramname"><em>context_window</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ContextDependencyInterface &amp;&#160;</td>
          <td class="paramname"><em>ctx_dep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const TransitionModel &amp;&#160;</td>
          <td class="paramname"><em>trans_model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const HTransducerConfig &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">HmmCacheType *&#160;</td>
          <td class="paramname"><em>cache</em> = <code>NULL</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Called by <a class="el" href="group__hmm__group__graph.html#gade0dda4e298562cc32dee6962e0ff0c9" title="Returns the H tranducer; result owned by caller. ">GetHTransducer()</a> and probably will not need to be called directly; it creates the FST corresponding to the phone. </p>
<p>Does not include self-loops; you have to call <a class="el" href="group__hmm__group__graph.html#ga938df29bca5ca1f3954733b5c3c53dc6" title="For context, see AddSelfLoops(). ">AddSelfLoops()</a> for that. Result owned by caller. Returns an acceptor (i.e. ilabels, olabels identical) with transition-ids as the symbols. For documentation in context, see <a class="el" href="hmm.html#hmm_graph_get_hmm_as_fst">The function GetHmmAsFst()</a> </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">context_window</td><td>A vector representing the phonetic context; see <a class="el" href="tree_externals.html#tree_window">here</a> for explanation. </td></tr>
    <tr><td class="paramname">ctx_dep</td><td>The object that contains the phonetic decision-tree </td></tr>
    <tr><td class="paramname">trans_model</td><td>The transition-model object, which provides the mappings to transition-ids and also the transition probabilities. </td></tr>
    <tr><td class="paramname">config</td><td>Configuration object, see <a class="el" href="structkaldi_1_1HTransducerConfig.html">HTransducerConfig</a>. </td></tr>
    <tr><td class="paramname">cache</td><td>Object used as a lookaside buffer to save computation; if it finds that the object it needs is already there, it will just return a pointer value from "cache"&ndash; not that this means you have to be careful not to delete things twice. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="hmm-utils_8cc_source.html#l00030">30</a> of file <a class="el" href="hmm-utils_8cc_source.html">hmm-utils.cc</a>.</p>

<p>References <a class="el" href="fstext-utils-inl_8h_source.html#l00841">fst::ApplyProbabilityScale()</a>, <a class="el" href="classkaldi_1_1ContextDependencyInterface.html#a63785b3c15a9e59679d01e91ec5deb32">ContextDependencyInterface::CentralPosition()</a>, <a class="el" href="classkaldi_1_1ContextDependencyInterface.html#add482cf5802e38844b4147007e7b3b2c">ContextDependencyInterface::Compute()</a>, <a class="el" href="classkaldi_1_1ContextDependencyInterface.html#a5ab5836712a8f5537f9b88d05f429c42">ContextDependencyInterface::ContextWidth()</a>, <a class="el" href="transition-model_8h_source.html#l00139">TransitionModel::GetTopo()</a>, <a class="el" href="transition-model_8cc_source.html#l00333">TransitionModel::GetTransitionLogProbIgnoringSelfLoops()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00143">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00160">KALDI_ERR</a>, <a class="el" href="hmm-topology_8h_source.html#l00087">kaldi::kNoPdf</a>, <a class="el" href="kaldi-math_8h_source.html#l00100">kaldi::Log()</a>, <a class="el" href="transition-model_8cc_source.html#l00194">TransitionModel::PairToTransitionId()</a>, <a class="el" href="hmm-utils_8h_source.html#l00054">HTransducerConfig::push_delta</a>, <a class="el" href="hmm-utils_8h_source.html#l00050">HTransducerConfig::push_weights</a>, <a class="el" href="remove-eps-local-inl_8h_source.html#l00309">fst::RemoveEpsLocal()</a>, <a class="el" href="hmm-utils_8h_source.html#l00045">HTransducerConfig::reverse</a>, <a class="el" href="stl-utils_8h_source.html#l00278">kaldi::ReverseVector()</a>, <a class="el" href="hmm-topology_8cc_source.html#l00278">HmmTopology::TopologyForPhone()</a>, <a class="el" href="hmm-utils_8h_source.html#l00040">HTransducerConfig::transition_scale</a>, and <a class="el" href="transition-model_8cc_source.html#l00148">TransitionModel::TripleToTransitionState()</a>.</p>

<p>Referenced by <a class="el" href="hmm-utils_8cc_source.html#l00249">kaldi::GetHTransducer()</a>.</p>
<div class="fragment"><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;                         {</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <span class="keyword">using namespace </span>fst;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  <span class="keywordflow">if</span> (config.reverse) <a class="code" href="namespacekaldi.html#afedad339ea1407f7151164f2982ea621">ReverseVector</a>(&amp;phone_window);  <span class="comment">// phone_window represents backwards</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <span class="comment">// phone sequence.  Make it &quot;forwards&quot; so the ctx_dep object can interpret it</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="comment">// right.  will also have to reverse the FST we produce.</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="keywordflow">if</span> (static_cast&lt;int32&gt;(phone_window.size()) != ctx_dep.ContextWidth())</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Context size mismatch, ilabel-info [from context FST is &quot;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;              &lt;&lt; phone_window.size() &lt;&lt; <span class="stringliteral">&quot;, context-dependency object &quot;</span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="stringliteral">&quot;expects &quot;</span> &lt;&lt; ctx_dep.ContextWidth();</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;  <span class="keywordtype">int</span> P = ctx_dep.CentralPosition();</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> phone = phone_window[P];</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;  <span class="keywordflow">if</span> (phone == 0) {  <span class="comment">// error.  Error message depends on whether reversed.</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    <span class="keywordflow">if</span> (config.reverse)</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;phone == 0.  Possibly you are trying to get a reversed &quot;</span></div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;          <span class="stringliteral">&quot;FST with a non-central \&quot;central position\&quot; P (i.e. asymmetric &quot;</span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;          <span class="stringliteral">&quot;context), but forgot to initialize the ContextFst object with P &quot;</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;          <span class="stringliteral">&quot;as N-1-P (or it could be a simpler problem)&quot;</span>;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;phone == 0.  Some mismatch happened, or there is &quot;</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;          <span class="stringliteral">&quot;a code error.&quot;</span>;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  }</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  <span class="keyword">const</span> HmmTopology &amp;topo = trans_model.GetTopo();</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;  <span class="keyword">const</span> HmmTopology::TopologyEntry &amp;entry  = topo.TopologyForPhone(phone);</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;  <span class="comment">// vector of the pdfs, indexed by pdf-class (pdf-classes must start from zero</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;  <span class="comment">// and be contiguous).</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  std::vector&lt;int32&gt; pdfs(topo.NumPdfClasses(phone));</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> pdf_class = 0;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;       pdf_class &lt; static_cast&lt;int32&gt;(pdfs.size());</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;       pdf_class++) {</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;    <span class="keywordflow">if</span> (! ctx_dep.Compute(phone_window, pdf_class, &amp;(pdfs[pdf_class])) ) {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      std::ostringstream ctx_ss;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;      <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; phone_window.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        ctx_ss &lt;&lt; phone_window[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] &lt;&lt; <span class="charliteral">&#39; &#39;</span>;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;GetHmmAsFst: context-dependency object could not produce &quot;</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                &lt;&lt; <span class="stringliteral">&quot;an answer: pdf-class = &quot;</span> &lt;&lt; pdf_class &lt;&lt; <span class="stringliteral">&quot; ctx-window = &quot;</span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                &lt;&lt; ctx_ss.str() &lt;&lt; <span class="stringliteral">&quot;.  This probably points &quot;</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;          <span class="stringliteral">&quot;to either a coding error in some graph-building process, &quot;</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;          <span class="stringliteral">&quot;a mismatch of topology with context-dependency object, the &quot;</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;          <span class="stringliteral">&quot;wrong FST being passed on a command-line, or something of &quot;</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;          <span class="stringliteral">&quot; that general nature.&quot;</span>;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;    }</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  }</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  std::pair&lt;int32, std::vector&lt;int32&gt; &gt; cache_index(phone, pdfs);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <span class="keywordflow">if</span> (cache != NULL) {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    HmmCacheType::iterator iter = cache-&gt;find(cache_index);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;    <span class="keywordflow">if</span> (iter != cache-&gt;end())</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;      <span class="keywordflow">return</span> iter-&gt;second;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  }</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;  VectorFst&lt;StdArc&gt; *ans = <span class="keyword">new</span> VectorFst&lt;StdArc&gt;;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">StdArc</a> <a class="code" href="namespacekaldi.html#a4ce48a4aa890590d2bbbeaa26cdac97b">Arc</a>;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="lattice-arcgraph_8cc.html#a2fdd196e46607f0d35b13369d9f9970d">Arc::Weight</a> <a class="code" href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">Weight</a>;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="lattice-arcgraph_8cc.html#ae38f9e2cc96a39ff2953a2846c2538db">Arc::StateId</a> <a class="code" href="namespacefst.html#ae38f9e2cc96a39ff2953a2846c2538db">StateId</a>;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="lattice-arcgraph_8cc.html#a006b00477e4d9250474e76e1ec61bb3f">Arc::Label</a> <a class="code" href="namespacefst.html#a006b00477e4d9250474e76e1ec61bb3f">Label</a>;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  std::vector&lt;StateId&gt; state_ids;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; entry.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    state_ids.push_back(ans-&gt;AddState());</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(state_ids.size() != 0);  <span class="comment">// Or empty topology entry.</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  ans-&gt;SetStart(state_ids[0]);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <a class="code" href="namespacefst.html#ae38f9e2cc96a39ff2953a2846c2538db">StateId</a> <span class="keyword">final</span> = state_ids.back();</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;  ans-&gt;SetFinal(<span class="keyword">final</span>, Weight::One());</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> hmm_state = 0;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;       hmm_state &lt; static_cast&lt;int32&gt;(entry.size());</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;       hmm_state++) {</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> pdf_class = entry[hmm_state].pdf_class, pdf;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;    <span class="keywordflow">if</span> (pdf_class == <a class="code" href="group__hmm__group.html#gad94539d80f1ba0b8731c6692b624b7a3">kNoPdf</a>) pdf = <a class="code" href="group__hmm__group.html#gad94539d80f1ba0b8731c6692b624b7a3">kNoPdf</a>;  <span class="comment">// nonemitting state.</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(pdf_class &lt; static_cast&lt;int32&gt;(pdfs.size()));</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;      pdf = pdfs[pdf_class];</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    }</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> trans_idx;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordflow">for</span> (trans_idx = 0;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;        trans_idx &lt; static_cast&lt;int32&gt;(entry[hmm_state].transitions.size());</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        trans_idx++) {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      <a class="code" href="namespacefst.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> log_prob;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      <a class="code" href="namespacefst.html#a006b00477e4d9250474e76e1ec61bb3f">Label</a> label;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;      <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> dest_state = entry[hmm_state].transitions[trans_idx].first;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <span class="keywordtype">bool</span> is_self_loop = (dest_state == hmm_state);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      <span class="keywordflow">if</span> (is_self_loop)</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <span class="keywordflow">continue</span>; <span class="comment">// We will add self-loops in at a later stage of processing,</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      <span class="comment">// not in this function.</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;      <span class="keywordflow">if</span> (pdf_class == <a class="code" href="group__hmm__group.html#gad94539d80f1ba0b8731c6692b624b7a3">kNoPdf</a>) {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        <span class="comment">// no pdf, hence non-estimated probability.</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <span class="comment">// [would not happen with normal topology] .  There is no transition-state</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;        <span class="comment">// involved in this case.</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        log_prob = <a class="code" href="namespacekaldi.html#af75c4606b108091c348102660de63180">Log</a>(entry[hmm_state].transitions[trans_idx].second);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;        label = 0;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;      } <span class="keywordflow">else</span> {  <span class="comment">// normal probability.</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> trans_state =</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            trans_model.TripleToTransitionState(phone, hmm_state, pdf);</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> trans_id =</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            trans_model.PairToTransitionId(trans_state, trans_idx);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        log_prob = trans_model.GetTransitionLogProbIgnoringSelfLoops(trans_id);</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;        <span class="comment">// log_prob is a negative number (or zero)...</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        label = trans_id;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;      }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      <span class="comment">// Will add probability-scale later (we may want to push first).</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      ans-&gt;AddArc(state_ids[hmm_state],</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                  <a class="code" href="namespacekaldi.html#a4ce48a4aa890590d2bbbeaa26cdac97b">Arc</a>(label, label, <a class="code" href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">Weight</a>(-log_prob), state_ids[dest_state]));</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    }</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordflow">if</span> (config.reverse) {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;    VectorFst&lt;StdArc&gt; *tmp = <span class="keyword">new</span> VectorFst&lt;StdArc&gt;;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;    fst::Reverse(*ans, tmp);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;    <a class="code" href="namespacefst.html#aa21bb5fdd25868b9fd813a15f37aef8e">fst::RemoveEpsLocal</a>(tmp);  <span class="comment">// this is safe and will not blow up.</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    <span class="keywordflow">if</span> (config.push_weights)  <span class="comment">// Push to make it stochastic again.</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;      PushInLog&lt;REWEIGHT_TO_INITIAL&gt;(tmp, kPushWeights, config.push_delta);</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keyword">delete</span> ans;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    ans = tmp;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <a class="code" href="namespacefst.html#aa21bb5fdd25868b9fd813a15f37aef8e">fst::RemoveEpsLocal</a>(ans);  <span class="comment">// this is safe and will not blow up.</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;  }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;  <span class="comment">// Now apply probability scale.</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  <span class="comment">// We waited till after the possible weight-pushing steps,</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="comment">// because weight-pushing needs &quot;real&quot; weights in order to work.</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;  <a class="code" href="namespacefst.html#acde6e041e51a069f9dc20999c332473d">ApplyProbabilityScale</a>(config.transition_scale, ans);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="keywordflow">if</span> (cache != NULL)</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    (*cache)[cache_index] = ans;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordflow">return</span> ans;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;}</div>
<div class="ttc" id="namespacefst_html_ae38f9e2cc96a39ff2953a2846c2538db"><div class="ttname"><a href="namespacefst.html#ae38f9e2cc96a39ff2953a2846c2538db">fst::StateId</a></div><div class="ttdeci">fst::StdArc::StateId StateId</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00055">deterministic-fst-test.cc:55</a></div></div>
<div class="ttc" id="lattice-arcgraph_8cc_html_ae38f9e2cc96a39ff2953a2846c2538db"><div class="ttname"><a href="lattice-arcgraph_8cc.html#ae38f9e2cc96a39ff2953a2846c2538db">StateId</a></div><div class="ttdeci">fst::StdArc::StateId StateId</div><div class="ttdef"><b>Definition:</b> <a href="lattice-arcgraph_8cc_source.html#l00027">lattice-arcgraph.cc:27</a></div></div>
<div class="ttc" id="namespacefst_html_aa21bb5fdd25868b9fd813a15f37aef8e"><div class="ttname"><a href="namespacefst.html#aa21bb5fdd25868b9fd813a15f37aef8e">fst::RemoveEpsLocal</a></div><div class="ttdeci">void RemoveEpsLocal(MutableFst&lt; Arc &gt; *fst)</div><div class="ttdoc">RemoveEpsLocal remove some (but not necessarily all) epsilons in an FST, using an algorithm that is g...</div><div class="ttdef"><b>Definition:</b> <a href="remove-eps-local-inl_8h_source.html#l00309">remove-eps-local-inl.h:309</a></div></div>
<div class="ttc" id="namespacefst_html_a70478eb2428a9406e4692d19a7a3a97f"><div class="ttname"><a href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a></div><div class="ttdeci">fst::StdArc StdArc</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00053">deterministic-fst-test.cc:53</a></div></div>
<div class="ttc" id="group__hmm__group_html_gad94539d80f1ba0b8731c6692b624b7a3"><div class="ttname"><a href="group__hmm__group.html#gad94539d80f1ba0b8731c6692b624b7a3">kaldi::kNoPdf</a></div><div class="ttdeci">static const int32 kNoPdf</div><div class="ttdoc">A constant used in the HmmTopology class as the pdf-class kNoPdf, which is used when a HMM-state is n...</div><div class="ttdef"><b>Definition:</b> <a href="hmm-topology_8h_source.html#l00087">hmm-topology.h:87</a></div></div>
<div class="ttc" id="namespacekaldi_html_af75c4606b108091c348102660de63180"><div class="ttname"><a href="namespacekaldi.html#af75c4606b108091c348102660de63180">kaldi::Log</a></div><div class="ttdeci">double Log(double x)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00100">kaldi-math.h:100</a></div></div>
<div class="ttc" id="lattice-arcgraph_8cc_html_a006b00477e4d9250474e76e1ec61bb3f"><div class="ttname"><a href="lattice-arcgraph_8cc.html#a006b00477e4d9250474e76e1ec61bb3f">Label</a></div><div class="ttdeci">fst::StdArc::Label Label</div><div class="ttdef"><b>Definition:</b> <a href="lattice-arcgraph_8cc_source.html#l00029">lattice-arcgraph.cc:29</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00160">kaldi-error.h:160</a></div></div>
<div class="ttc" id="namespacekaldi_html_afedad339ea1407f7151164f2982ea621"><div class="ttname"><a href="namespacekaldi.html#afedad339ea1407f7151164f2982ea621">kaldi::ReverseVector</a></div><div class="ttdeci">void ReverseVector(std::vector&lt; T &gt; *vec)</div><div class="ttdoc">Reverses the contents of a vector. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00278">stl-utils.h:278</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab7903878916593daecbeb95b98115ab0"><div class="ttname"><a href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">kaldi::int32</a></div><div class="ttdeci">int32_t int32</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00047">kaldi-types.h:47</a></div></div>
<div class="ttc" id="namespacefst_html_a006b00477e4d9250474e76e1ec61bb3f"><div class="ttname"><a href="namespacefst.html#a006b00477e4d9250474e76e1ec61bb3f">fst::Label</a></div><div class="ttdeci">fst::StdArc::Label Label</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00054">deterministic-fst-test.cc:54</a></div></div>
<div class="ttc" id="namespacefst_html_acde6e041e51a069f9dc20999c332473d"><div class="ttname"><a href="namespacefst.html#acde6e041e51a069f9dc20999c332473d">fst::ApplyProbabilityScale</a></div><div class="ttdeci">void ApplyProbabilityScale(float scale, MutableFst&lt; Arc &gt; *fst)</div><div class="ttdoc">ApplyProbabilityScale is applicable to FSTs in the log or tropical semiring. </div><div class="ttdef"><b>Definition:</b> <a href="fstext-utils-inl_8h_source.html#l00841">fstext-utils-inl.h:841</a></div></div>
<div class="ttc" id="namespacefst_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacefst.html#aa66ff8367094543664b3b6a13d77c139">fst::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="lattice-weight-test_8cc_source.html#l00026">lattice-weight-test.cc:26</a></div></div>
<div class="ttc" id="namespacekaldi_html_a4ce48a4aa890590d2bbbeaa26cdac97b"><div class="ttname"><a href="namespacekaldi.html#a4ce48a4aa890590d2bbbeaa26cdac97b">kaldi::Arc</a></div><div class="ttdeci">KwsLexicographicArc Arc</div><div class="ttdef"><b>Definition:</b> <a href="kws-search_8cc_source.html#l00028">kws-search.cc:28</a></div></div>
<div class="ttc" id="namespacefst_html_a2fdd196e46607f0d35b13369d9f9970d"><div class="ttname"><a href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">fst::Weight</a></div><div class="ttdeci">fst::StdArc::Weight Weight</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00057">deterministic-fst-test.cc:57</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
<div class="ttc" id="lattice-arcgraph_8cc_html_a2fdd196e46607f0d35b13369d9f9970d"><div class="ttname"><a href="lattice-arcgraph_8cc.html#a2fdd196e46607f0d35b13369d9f9970d">Weight</a></div><div class="ttdeci">fst::StdArc::Weight Weight</div><div class="ttdef"><b>Definition:</b> <a href="lattice-arcgraph_8cc_source.html#l00028">lattice-arcgraph.cc:28</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gac4ea836399551f07c71147098f8c6b47"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; * GetHmmAsFstSimple </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; int32 &gt;&#160;</td>
          <td class="paramname"><em>context_window</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ContextDependencyInterface &amp;&#160;</td>
          <td class="paramname"><em>ctx_dep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const TransitionModel &amp;&#160;</td>
          <td class="paramname"><em>trans_model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BaseFloat&#160;</td>
          <td class="paramname"><em>prob_scale</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Included mainly as a form of documentation, not used in any other code currently. </p>
<p>Creates the acceptor FST with self-loops, and with fewer options. </p>

<p>Definition at line <a class="el" href="hmm-utils_8cc_source.html#l00169">169</a> of file <a class="el" href="hmm-utils_8cc_source.html">hmm-utils.cc</a>.</p>

<p>References <a class="el" href="classkaldi_1_1ContextDependencyInterface.html#a63785b3c15a9e59679d01e91ec5deb32">ContextDependencyInterface::CentralPosition()</a>, <a class="el" href="classkaldi_1_1ContextDependencyInterface.html#add482cf5802e38844b4147007e7b3b2c">ContextDependencyInterface::Compute()</a>, <a class="el" href="classkaldi_1_1ContextDependencyInterface.html#a5ab5836712a8f5537f9b88d05f429c42">ContextDependencyInterface::ContextWidth()</a>, <a class="el" href="transition-model_8h_source.html#l00139">TransitionModel::GetTopo()</a>, <a class="el" href="transition-model_8cc_source.html#l00324">TransitionModel::GetTransitionLogProb()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00143">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00160">KALDI_ERR</a>, <a class="el" href="hmm-topology_8h_source.html#l00087">kaldi::kNoPdf</a>, <a class="el" href="kaldi-math_8h_source.html#l00100">kaldi::Log()</a>, <a class="el" href="transition-model_8cc_source.html#l00194">TransitionModel::PairToTransitionId()</a>, <a class="el" href="hmm-topology_8cc_source.html#l00278">HmmTopology::TopologyForPhone()</a>, and <a class="el" href="transition-model_8cc_source.html#l00148">TransitionModel::TripleToTransitionState()</a>.</p>

<p>Referenced by <a class="el" href="hmm-utils_8cc_source.html#l01087">kaldi::GetRandomAlignmentForPhone()</a>.</p>
<div class="fragment"><div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;                                        {</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;  <span class="keyword">using namespace </span>fst;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;  <span class="keywordflow">if</span> (static_cast&lt;int32&gt;(phone_window.size()) != ctx_dep.ContextWidth())</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt;<span class="stringliteral">&quot;Context size mismatch, ilabel-info [from context FST is &quot;</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;              &lt;&lt;(phone_window.size())&lt;&lt;<span class="stringliteral">&quot;, context-dependency object &quot;</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="stringliteral">&quot;expects &quot;</span>&lt;&lt;(ctx_dep.ContextWidth());</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;  <span class="keywordtype">int</span> P = ctx_dep.CentralPosition();</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> phone = phone_window[P];</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(phone != 0);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;  <span class="keyword">const</span> HmmTopology &amp;topo = trans_model.GetTopo();</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;  <span class="keyword">const</span> HmmTopology::TopologyEntry &amp;entry  = topo.TopologyForPhone(phone);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  VectorFst&lt;StdArc&gt; *ans = <span class="keyword">new</span> VectorFst&lt;StdArc&gt;;</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="comment">// Create a mini-FST with a superfinal state [in case we have emitting</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="comment">// final-states, which we usually will.]</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">StdArc</a> <a class="code" href="namespacekaldi.html#a4ce48a4aa890590d2bbbeaa26cdac97b">Arc</a>;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="lattice-arcgraph_8cc.html#a2fdd196e46607f0d35b13369d9f9970d">Arc::Weight</a> <a class="code" href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">Weight</a>;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="lattice-arcgraph_8cc.html#ae38f9e2cc96a39ff2953a2846c2538db">Arc::StateId</a> <a class="code" href="namespacefst.html#ae38f9e2cc96a39ff2953a2846c2538db">StateId</a>;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="lattice-arcgraph_8cc.html#a006b00477e4d9250474e76e1ec61bb3f">Arc::Label</a> <a class="code" href="namespacefst.html#a006b00477e4d9250474e76e1ec61bb3f">Label</a>;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  std::vector&lt;StateId&gt; state_ids;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; entry.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;    state_ids.push_back(ans-&gt;AddState());</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(state_ids.size() &gt; 1);  <span class="comment">// Or invalid topology entry.</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;  ans-&gt;SetStart(state_ids[0]);</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  <a class="code" href="namespacefst.html#ae38f9e2cc96a39ff2953a2846c2538db">StateId</a> <span class="keyword">final</span> = state_ids.back();</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  ans-&gt;SetFinal(<span class="keyword">final</span>, Weight::One());</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> hmm_state = 0;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;       hmm_state &lt; static_cast&lt;int32&gt;(entry.size());</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;       hmm_state++) {</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> pdf_class = entry[hmm_state].pdf_class, pdf;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    <span class="keywordflow">if</span> (pdf_class == <a class="code" href="group__hmm__group.html#gad94539d80f1ba0b8731c6692b624b7a3">kNoPdf</a>) pdf = <a class="code" href="group__hmm__group.html#gad94539d80f1ba0b8731c6692b624b7a3">kNoPdf</a>;  <span class="comment">// nonemitting state; not generally used.</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;    <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      <span class="keywordtype">bool</span> ans = ctx_dep.Compute(phone_window, pdf_class, &amp;pdf);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ans &amp;&amp; <span class="stringliteral">&quot;Context-dependency computation failed.&quot;</span>);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;    }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> trans_idx;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    <span class="keywordflow">for</span> (trans_idx = 0;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        trans_idx &lt; static_cast&lt;int32&gt;(entry[hmm_state].transitions.size());</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        trans_idx++) {</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;      <a class="code" href="namespacefst.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> log_prob;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;      <a class="code" href="namespacefst.html#a006b00477e4d9250474e76e1ec61bb3f">Label</a> label;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;      <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> dest_state = entry[hmm_state].transitions[trans_idx].first;</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;      <span class="keywordflow">if</span> (pdf_class == <a class="code" href="group__hmm__group.html#gad94539d80f1ba0b8731c6692b624b7a3">kNoPdf</a>) {</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        <span class="comment">// no pdf, hence non-estimated probability.  very unusual case.  [would</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <span class="comment">// not happen with normal topology] .  There is no transition-state</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        <span class="comment">// involved in this case.</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(hmm_state != dest_state);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        log_prob = <a class="code" href="namespacekaldi.html#af75c4606b108091c348102660de63180">Log</a>(entry[hmm_state].transitions[trans_idx].second);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        label = 0;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;      } <span class="keywordflow">else</span> {  <span class="comment">// normal probability.</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> trans_state =</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            trans_model.TripleToTransitionState(phone, hmm_state, pdf);</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> trans_id =</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            trans_model.PairToTransitionId(trans_state, trans_idx);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;        log_prob = prob_scale * trans_model.GetTransitionLogProb(trans_id);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;        <span class="comment">// log_prob is a negative number (or zero)...</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;        label = trans_id;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;      }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;      ans-&gt;AddArc(state_ids[hmm_state],</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                  <a class="code" href="namespacekaldi.html#a4ce48a4aa890590d2bbbeaa26cdac97b">Arc</a>(label, label, <a class="code" href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">Weight</a>(-log_prob), state_ids[dest_state]));</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;  }</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;  <span class="keywordflow">return</span> ans;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;}</div>
<div class="ttc" id="namespacefst_html_ae38f9e2cc96a39ff2953a2846c2538db"><div class="ttname"><a href="namespacefst.html#ae38f9e2cc96a39ff2953a2846c2538db">fst::StateId</a></div><div class="ttdeci">fst::StdArc::StateId StateId</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00055">deterministic-fst-test.cc:55</a></div></div>
<div class="ttc" id="lattice-arcgraph_8cc_html_ae38f9e2cc96a39ff2953a2846c2538db"><div class="ttname"><a href="lattice-arcgraph_8cc.html#ae38f9e2cc96a39ff2953a2846c2538db">StateId</a></div><div class="ttdeci">fst::StdArc::StateId StateId</div><div class="ttdef"><b>Definition:</b> <a href="lattice-arcgraph_8cc_source.html#l00027">lattice-arcgraph.cc:27</a></div></div>
<div class="ttc" id="namespacefst_html_a70478eb2428a9406e4692d19a7a3a97f"><div class="ttname"><a href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a></div><div class="ttdeci">fst::StdArc StdArc</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00053">deterministic-fst-test.cc:53</a></div></div>
<div class="ttc" id="group__hmm__group_html_gad94539d80f1ba0b8731c6692b624b7a3"><div class="ttname"><a href="group__hmm__group.html#gad94539d80f1ba0b8731c6692b624b7a3">kaldi::kNoPdf</a></div><div class="ttdeci">static const int32 kNoPdf</div><div class="ttdoc">A constant used in the HmmTopology class as the pdf-class kNoPdf, which is used when a HMM-state is n...</div><div class="ttdef"><b>Definition:</b> <a href="hmm-topology_8h_source.html#l00087">hmm-topology.h:87</a></div></div>
<div class="ttc" id="namespacekaldi_html_af75c4606b108091c348102660de63180"><div class="ttname"><a href="namespacekaldi.html#af75c4606b108091c348102660de63180">kaldi::Log</a></div><div class="ttdeci">double Log(double x)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00100">kaldi-math.h:100</a></div></div>
<div class="ttc" id="lattice-arcgraph_8cc_html_a006b00477e4d9250474e76e1ec61bb3f"><div class="ttname"><a href="lattice-arcgraph_8cc.html#a006b00477e4d9250474e76e1ec61bb3f">Label</a></div><div class="ttdeci">fst::StdArc::Label Label</div><div class="ttdef"><b>Definition:</b> <a href="lattice-arcgraph_8cc_source.html#l00029">lattice-arcgraph.cc:29</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00160">kaldi-error.h:160</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab7903878916593daecbeb95b98115ab0"><div class="ttname"><a href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">kaldi::int32</a></div><div class="ttdeci">int32_t int32</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00047">kaldi-types.h:47</a></div></div>
<div class="ttc" id="namespacefst_html_a006b00477e4d9250474e76e1ec61bb3f"><div class="ttname"><a href="namespacefst.html#a006b00477e4d9250474e76e1ec61bb3f">fst::Label</a></div><div class="ttdeci">fst::StdArc::Label Label</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00054">deterministic-fst-test.cc:54</a></div></div>
<div class="ttc" id="namespacefst_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacefst.html#aa66ff8367094543664b3b6a13d77c139">fst::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="lattice-weight-test_8cc_source.html#l00026">lattice-weight-test.cc:26</a></div></div>
<div class="ttc" id="namespacekaldi_html_a4ce48a4aa890590d2bbbeaa26cdac97b"><div class="ttname"><a href="namespacekaldi.html#a4ce48a4aa890590d2bbbeaa26cdac97b">kaldi::Arc</a></div><div class="ttdeci">KwsLexicographicArc Arc</div><div class="ttdef"><b>Definition:</b> <a href="kws-search_8cc_source.html#l00028">kws-search.cc:28</a></div></div>
<div class="ttc" id="namespacefst_html_a2fdd196e46607f0d35b13369d9f9970d"><div class="ttname"><a href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">fst::Weight</a></div><div class="ttdeci">fst::StdArc::Weight Weight</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00057">deterministic-fst-test.cc:57</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
<div class="ttc" id="lattice-arcgraph_8cc_html_a2fdd196e46607f0d35b13369d9f9970d"><div class="ttname"><a href="lattice-arcgraph_8cc.html#a2fdd196e46607f0d35b13369d9f9970d">Weight</a></div><div class="ttdeci">fst::StdArc::Weight Weight</div><div class="ttdef"><b>Definition:</b> <a href="lattice-arcgraph_8cc_source.html#l00028">lattice-arcgraph.cc:28</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gade0dda4e298562cc32dee6962e0ff0c9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; * GetHTransducer </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>ilabel_info</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ContextDependencyInterface &amp;&#160;</td>
          <td class="paramname"><em>ctx_dep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const TransitionModel &amp;&#160;</td>
          <td class="paramname"><em>trans_model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const HTransducerConfig &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>disambig_syms_left</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the H tranducer; result owned by caller. </p>
<p>Caution: our version of the H transducer does not include self-loops; you have to add those later. See <a class="el" href="hmm.html#hmm_graph_get_h_transducer">GetHTransducer()</a>. The H transducer has on the input transition-ids, and also possibly some disambiguation symbols, which will be put in disambig_syms. The output side contains the identifiers that are indexes into "ilabel_info" (these represent phones-in-context or disambiguation symbols). The ilabel_info vector allows GetHTransducer to map from symbols to phones-in-context (i.e. phonetic context windows). Any singleton symbols in the ilabel_info vector which are not phones, will be treated as disambiguation symbols. [Not all recipes use these]. The output "disambig_syms_left" will be set to a list of the disambiguation symbols on the input of the transducer (i.e. same symbol type as whatever is on the input of the transducer </p>

<p>Definition at line <a class="el" href="hmm-utils_8cc_source.html#l00249">249</a> of file <a class="el" href="hmm-utils_8cc_source.html">hmm-utils.cc</a>.</p>

<p>References <a class="el" href="stl-utils_8h_source.html#l00198">kaldi::DeletePointers()</a>, <a class="el" href="hmm-utils_8cc_source.html#l00030">kaldi::GetHmmAsFst()</a>, <a class="el" href="transition-model_8h_source.html#l00190">TransitionModel::GetPhones()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::j</a>, <a class="el" href="kaldi-error_8h_source.html#l00143">KALDI_ASSERT</a>, <a class="el" href="fstext-utils-inl_8h_source.html#l00739">fst::MakeLoopFst()</a>, <a class="el" href="transition-model_8h_source.html#l00166">TransitionModel::NumTransitionIds()</a>, and <a class="el" href="stl-utils_8h_source.html#l00051">kaldi::SortAndUniq()</a>.</p>

<p>Referenced by <a class="el" href="training-graph-compiler_8cc_source.html#l00071">TrainingGraphCompiler::CompileGraph()</a>, <a class="el" href="training-graph-compiler_8cc_source.html#l00164">TrainingGraphCompiler::CompileGraphs()</a>, and <a class="el" href="make-h-transducer_8cc_source.html#l00029">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                                                                                   {</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ilabel_info.size() &gt;= 1 &amp;&amp; ilabel_info[0].size() == 0);  <span class="comment">// make sure that eps == eps.</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <a class="code" href="group__hmm__group__graph.html#gaf603f501ad03cb3632179ef5aa36b73e">HmmCacheType</a> cache;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="comment">// &quot;cache&quot; is an optimization that prevents GetHmmAsFst repeating work</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;  <span class="comment">// unnecessarily.</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;  <span class="keyword">using namespace </span>fst;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">StdArc</a> <a class="code" href="namespacekaldi.html#a4ce48a4aa890590d2bbbeaa26cdac97b">Arc</a>;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="lattice-arcgraph_8cc.html#a2fdd196e46607f0d35b13369d9f9970d">Arc::Weight</a> <a class="code" href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">Weight</a>;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="lattice-arcgraph_8cc.html#ae38f9e2cc96a39ff2953a2846c2538db">Arc::StateId</a> <a class="code" href="namespacefst.html#ae38f9e2cc96a39ff2953a2846c2538db">StateId</a>;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="lattice-arcgraph_8cc.html#a006b00477e4d9250474e76e1ec61bb3f">Arc::Label</a> <a class="code" href="namespacefst.html#a006b00477e4d9250474e76e1ec61bb3f">Label</a>;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;  std::vector&lt;const ExpandedFst&lt;Arc&gt;* &gt; fsts(ilabel_info.size(), NULL);</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;  std::vector&lt;int32&gt; phones = trans_model.GetPhones();</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(disambig_syms_left != 0);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;  disambig_syms_left-&gt;clear();</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> first_disambig_sym = trans_model.NumTransitionIds() + 1;  <span class="comment">// First disambig symbol we can have on the input side.</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> next_disambig_sym = first_disambig_sym;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;  <span class="keywordflow">if</span> (ilabel_info.size() &gt; 0)</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(ilabel_info[0].size() == 0);  <span class="comment">// make sure epsilon is epsilon...</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a> = 1; j &lt; static_cast&lt;int32&gt;(ilabel_info.size()); <a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>++) {  <span class="comment">// zero is eps.</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!ilabel_info[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].empty());</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;    <span class="keywordflow">if</span> (ilabel_info[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>].size() == 1 &amp;&amp;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;       ilabel_info[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>][0] &lt;= 0) {  <span class="comment">// disambig symbol</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;      <span class="comment">// disambiguation symbol.</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;      <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> disambig_sym_left = next_disambig_sym++;</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;      disambig_syms_left-&gt;push_back(disambig_sym_left);</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;      <span class="comment">// get acceptor with one path with &quot;disambig_sym&quot; on it.</span></div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      VectorFst&lt;Arc&gt; *fst = <span class="keyword">new</span> VectorFst&lt;Arc&gt;;</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;      fst-&gt;AddState();</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;      fst-&gt;AddState();</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      fst-&gt;SetStart(0);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      fst-&gt;SetFinal(1, Weight::One());</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;      fst-&gt;AddArc(0, <a class="code" href="namespacekaldi.html#a4ce48a4aa890590d2bbbeaa26cdac97b">Arc</a>(disambig_sym_left, disambig_sym_left, Weight::One(), 1));</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;      fsts[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>] = fst;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;    } <span class="keywordflow">else</span> {  <span class="comment">// Real phone-in-context.</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;      std::vector&lt;int32&gt; phone_window = ilabel_info[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>];</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;      VectorFst&lt;Arc&gt; *fst = <a class="code" href="group__hmm__group__graph.html#gafadba59dd704d43aa0a3c69e0f3a473d">GetHmmAsFst</a>(phone_window,</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                                        ctx_dep,</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                                        trans_model,</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                                        config,</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                                        &amp;cache);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;      fsts[<a class="code" href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">j</a>] = fst;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;    }</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;  }</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;  VectorFst&lt;Arc&gt; *ans = <a class="code" href="namespacefst.html#a3b99f77992383006bda67038a91191de">MakeLoopFst</a>(fsts);</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;  <a class="code" href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">SortAndUniq</a>(&amp;fsts); <span class="comment">// remove duplicate pointers, which we will have</span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;  <span class="comment">// in general, since we used the cache.</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;  <a class="code" href="namespacekaldi.html#a93a4038983f8cd71e343b85f1d117cac">DeletePointers</a>(&amp;fsts);</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;  <span class="keywordflow">return</span> ans;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;}</div>
<div class="ttc" id="namespacefst_html_ae38f9e2cc96a39ff2953a2846c2538db"><div class="ttname"><a href="namespacefst.html#ae38f9e2cc96a39ff2953a2846c2538db">fst::StateId</a></div><div class="ttdeci">fst::StdArc::StateId StateId</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00055">deterministic-fst-test.cc:55</a></div></div>
<div class="ttc" id="lattice-arcgraph_8cc_html_ae38f9e2cc96a39ff2953a2846c2538db"><div class="ttname"><a href="lattice-arcgraph_8cc.html#ae38f9e2cc96a39ff2953a2846c2538db">StateId</a></div><div class="ttdeci">fst::StdArc::StateId StateId</div><div class="ttdef"><b>Definition:</b> <a href="lattice-arcgraph_8cc_source.html#l00027">lattice-arcgraph.cc:27</a></div></div>
<div class="ttc" id="namespacernnlm_html_a37d972ae0b47b9099e30983131d31916"><div class="ttname"><a href="namespacernnlm.html#a37d972ae0b47b9099e30983131d31916">rnnlm::j</a></div><div class="ttdeci">int j</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacefst_html_a70478eb2428a9406e4692d19a7a3a97f"><div class="ttname"><a href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a></div><div class="ttdeci">fst::StdArc StdArc</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00053">deterministic-fst-test.cc:53</a></div></div>
<div class="ttc" id="group__hmm__group__graph_html_gaf603f501ad03cb3632179ef5aa36b73e"><div class="ttname"><a href="group__hmm__group__graph.html#gaf603f501ad03cb3632179ef5aa36b73e">kaldi::HmmCacheType</a></div><div class="ttdeci">unordered_map&lt; std::pair&lt; int32, std::vector&lt; int32 &gt; &gt;, fst::VectorFst&lt; fst::StdArc &gt; *, HmmCacheHash &gt; HmmCacheType</div><div class="ttdoc">HmmCacheType is a map from (central-phone, sequence of pdf-ids) to FST, used as cache in GetHmmAsFst...</div><div class="ttdef"><b>Definition:</b> <a href="hmm-utils_8h_source.html#l00092">hmm-utils.h:92</a></div></div>
<div class="ttc" id="namespacekaldi_html_a3dd7a9cc33032bfb870b4b6c053822db"><div class="ttname"><a href="namespacekaldi.html#a3dd7a9cc33032bfb870b4b6c053822db">kaldi::SortAndUniq</a></div><div class="ttdeci">void SortAndUniq(std::vector&lt; T &gt; *vec)</div><div class="ttdoc">Sorts and uniq&#39;s (removes duplicates) from a vector. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00051">stl-utils.h:51</a></div></div>
<div class="ttc" id="lattice-arcgraph_8cc_html_a006b00477e4d9250474e76e1ec61bb3f"><div class="ttname"><a href="lattice-arcgraph_8cc.html#a006b00477e4d9250474e76e1ec61bb3f">Label</a></div><div class="ttdeci">fst::StdArc::Label Label</div><div class="ttdef"><b>Definition:</b> <a href="lattice-arcgraph_8cc_source.html#l00029">lattice-arcgraph.cc:29</a></div></div>
<div class="ttc" id="namespacefst_html_a3b99f77992383006bda67038a91191de"><div class="ttname"><a href="namespacefst.html#a3b99f77992383006bda67038a91191de">fst::MakeLoopFst</a></div><div class="ttdeci">VectorFst&lt; Arc &gt; * MakeLoopFst(const vector&lt; const ExpandedFst&lt; Arc &gt; * &gt; &amp;fsts)</div><div class="ttdoc">MakeLoopFst creates an FST that has a state that is both initial and final (weight == Weight::One())...</div><div class="ttdef"><b>Definition:</b> <a href="fstext-utils-inl_8h_source.html#l00739">fstext-utils-inl.h:739</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab7903878916593daecbeb95b98115ab0"><div class="ttname"><a href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">kaldi::int32</a></div><div class="ttdeci">int32_t int32</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00047">kaldi-types.h:47</a></div></div>
<div class="ttc" id="namespacefst_html_a006b00477e4d9250474e76e1ec61bb3f"><div class="ttname"><a href="namespacefst.html#a006b00477e4d9250474e76e1ec61bb3f">fst::Label</a></div><div class="ttdeci">fst::StdArc::Label Label</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00054">deterministic-fst-test.cc:54</a></div></div>
<div class="ttc" id="namespacekaldi_html_a4ce48a4aa890590d2bbbeaa26cdac97b"><div class="ttname"><a href="namespacekaldi.html#a4ce48a4aa890590d2bbbeaa26cdac97b">kaldi::Arc</a></div><div class="ttdeci">KwsLexicographicArc Arc</div><div class="ttdef"><b>Definition:</b> <a href="kws-search_8cc_source.html#l00028">kws-search.cc:28</a></div></div>
<div class="ttc" id="namespacefst_html_a2fdd196e46607f0d35b13369d9f9970d"><div class="ttname"><a href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">fst::Weight</a></div><div class="ttdeci">fst::StdArc::Weight Weight</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00057">deterministic-fst-test.cc:57</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
<div class="ttc" id="group__hmm__group__graph_html_gafadba59dd704d43aa0a3c69e0f3a473d"><div class="ttname"><a href="group__hmm__group__graph.html#gafadba59dd704d43aa0a3c69e0f3a473d">kaldi::GetHmmAsFst</a></div><div class="ttdeci">fst::VectorFst&lt; fst::StdArc &gt; * GetHmmAsFst(std::vector&lt; int32 &gt; phone_window, const ContextDependencyInterface &amp;ctx_dep, const TransitionModel &amp;trans_model, const HTransducerConfig &amp;config, HmmCacheType *cache)</div><div class="ttdoc">Called by GetHTransducer() and probably will not need to be called directly; it creates the FST corre...</div><div class="ttdef"><b>Definition:</b> <a href="hmm-utils_8cc_source.html#l00030">hmm-utils.cc:30</a></div></div>
<div class="ttc" id="namespacekaldi_html_a93a4038983f8cd71e343b85f1d117cac"><div class="ttname"><a href="namespacekaldi.html#a93a4038983f8cd71e343b85f1d117cac">kaldi::DeletePointers</a></div><div class="ttdeci">void DeletePointers(std::vector&lt; A * &gt; *v)</div><div class="ttdoc">Deletes any non-NULL pointers in the vector v, and sets the corresponding entries of v to NULL...</div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00198">stl-utils.h:198</a></div></div>
<div class="ttc" id="lattice-arcgraph_8cc_html_a2fdd196e46607f0d35b13369d9f9970d"><div class="ttname"><a href="lattice-arcgraph_8cc.html#a2fdd196e46607f0d35b13369d9f9970d">Weight</a></div><div class="ttdeci">fst::StdArc::Weight Weight</div><div class="ttdef"><b>Definition:</b> <a href="lattice-arcgraph_8cc_source.html#l00028">lattice-arcgraph.cc:28</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga204bf084239aa1ea304b5b7b987aa098"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GetIlabelMapping </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; std::vector&lt; int32 &gt; &gt; &amp;&#160;</td>
          <td class="paramname"><em>ilabel_info_old</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const ContextDependencyInterface &amp;&#160;</td>
          <td class="paramname"><em>ctx_dep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const TransitionModel &amp;&#160;</td>
          <td class="paramname"><em>trans_model</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; int32 &gt; *&#160;</td>
          <td class="paramname"><em>old2new_map</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>GetIlabelMapping produces a mapping that's similar to HTK's logical-to-physical model mapping (i.e. </p>
<p>the xwrd.clustered.mlist files). It groups together "logical HMMs" (i.e. in our world, phonetic context windows) that share the same sequence of transition-ids. This can be used in an optional graph-creation step that produces a remapped form of CLG that can be more productively determinized and minimized. This is used in the command-line program <a class="el" href="make-ilabel-transducer_8cc.html">make-ilabel-transducer.cc</a>. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ilabel_info_old</td><td>[in] The original <a class="el" href="tree_externals.html#tree_ilabel">ilabel_info</a> vector </td></tr>
    <tr><td class="paramname">ctx_dep</td><td>[in] The tree </td></tr>
    <tr><td class="paramname">trans_model</td><td>[in] The transition-model object </td></tr>
    <tr><td class="paramname">old2new_map</td><td>[out] The output; this vector, which is of size equal to the number of new labels, is a mapping to the old labels such that we could create a vector ilabel_info_new such that ilabel_info_new[i] == ilabel_info_old[old2new_map[i]] </td></tr>
  </table>
  </dd>
</dl>
<p>The next variable maps from the (central-phone, pdf-sequence) to the index in ilabel_info_old corresponding to the first phone-in-context that we saw for it. We use this to work out the logical-to-physical mapping. Each time we handle a phone in context, we see if its (central-phone, pdf-sequence) has already been seen; if yes, we map to the original phone-sequence, if no, we create a new "phyiscal-HMM" and there is no mapping.</p>
<p>old2old_map is a map from the old ilabels to themselves (but duplicates are mapped to one unique one. </p>

<p>Definition at line <a class="el" href="hmm-utils_8cc_source.html#l00312">312</a> of file <a class="el" href="hmm-utils_8cc_source.html">hmm-utils.cc</a>.</p>

<p>References <a class="el" href="classkaldi_1_1ContextDependencyInterface.html#a63785b3c15a9e59679d01e91ec5deb32">ContextDependencyInterface::CentralPosition()</a>, <a class="el" href="classkaldi_1_1ContextDependencyInterface.html#add482cf5802e38844b4147007e7b3b2c">ContextDependencyInterface::Compute()</a>, <a class="el" href="classkaldi_1_1ContextDependencyInterface.html#a5ab5836712a8f5537f9b88d05f429c42">ContextDependencyInterface::ContextWidth()</a>, <a class="el" href="transition-model_8h_source.html#l00139">TransitionModel::GetTopo()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00143">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00160">KALDI_ERR</a>, <a class="el" href="hmm-topology_8cc_source.html#l00285">HmmTopology::NumPdfClasses()</a>, and <a class="el" href="io-funcs-inl_8h_source.html#l00091">kaldi::WriteIntegerVector()</a>.</p>

<p>Referenced by <a class="el" href="make-ilabel-transducer_8cc_source.html#l00029">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;                                                      {</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(old2new_map != NULL);</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;  std::map&lt;std::pair&lt;int32, std::vector&lt;int32&gt; &gt;, <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> &gt;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;      pair_to_physical;</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> N = ctx_dep.ContextWidth(),</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;      P = ctx_dep.CentralPosition();</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> num_syms_old = ilabel_info_old.size();</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;  std::vector&lt;int32&gt; old2old_map(num_syms_old);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;  old2old_map[0] = 0;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 1; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_syms_old; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    <span class="keyword">const</span> std::vector&lt;int32&gt; &amp;vec = ilabel_info_old[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordflow">if</span> (vec.size() == 1 &amp;&amp; vec[0] &lt;= 0) {  <span class="comment">// disambig.</span></div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;      old2old_map[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(vec.size() == <span class="keyword">static_cast&lt;</span><span class="keywordtype">size_t</span><span class="keyword">&gt;</span>(N));</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;      <span class="comment">// work out the vector of context-dependent phone</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;      <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> central_phone = vec[P];</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;      <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> num_pdf_classes = trans_model.GetTopo().NumPdfClasses(central_phone);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;      std::vector&lt;int32&gt; state_seq(num_pdf_classes);  <span class="comment">// Indexed by pdf-class</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;      <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> pdf_class = 0; pdf_class &lt; num_pdf_classes; pdf_class++) {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <span class="keywordflow">if</span> (!ctx_dep.Compute(vec, pdf_class, &amp;(state_seq[pdf_class]))) {</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;          std::ostringstream ss;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;          <a class="code" href="group__io__funcs__basic.html#ga99e4557f845a9c1e3202ab136226a980">WriteIntegerVector</a>(ss, <span class="keyword">false</span>, vec);</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;          <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;tree did not succeed in converting phone window &quot;</span>&lt;&lt;ss.str();</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        }</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;      }</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;      std::pair&lt;int32, std::vector&lt;int32&gt; &gt; pr(central_phone, state_seq);</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;      std::map&lt;std::pair&lt;int32, std::vector&lt;int32&gt; &gt;, <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> &gt;::iterator iter</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;          = pair_to_physical.find(pr);</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;      <span class="keywordflow">if</span> (iter == pair_to_physical.end()) {  <span class="comment">// first time we saw something like this.</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;        pair_to_physical[pr] = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;        old2old_map[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>;</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;      } <span class="keywordflow">else</span> {  <span class="comment">// seen it before.  look up in the map, the index we point to.</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;        old2old_map[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = iter-&gt;second;</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;      }</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;    }</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  }</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;  std::vector&lt;bool&gt; seen(num_syms_old, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_syms_old; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    seen[old2old_map[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <span class="comment">// Now work out the elements of old2new_map corresponding to</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;  <span class="comment">// things that are first in their equivalence class.  We&#39;re just</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;  <span class="comment">// compacting the labels to those for which seen[i] == true.</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> cur_id = 0;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;  old2new_map-&gt;resize(num_syms_old);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; num_syms_old; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++)</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;    <span class="keywordflow">if</span> (seen[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>])</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;      (*old2new_map)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = cur_id++;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;  <span class="comment">// fill in the other elements of old2new_map.</span></div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> i = 0; i &lt; num_syms_old; i++)</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    (*old2new_map)[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] = (*old2new_map)[old2old_map[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]];</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;}</div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00160">kaldi-error.h:160</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab7903878916593daecbeb95b98115ab0"><div class="ttname"><a href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">kaldi::int32</a></div><div class="ttdeci">int32_t int32</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00047">kaldi-types.h:47</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
<div class="ttc" id="group__io__funcs__basic_html_ga99e4557f845a9c1e3202ab136226a980"><div class="ttname"><a href="group__io__funcs__basic.html#ga99e4557f845a9c1e3202ab136226a980">kaldi::WriteIntegerVector</a></div><div class="ttdeci">void WriteIntegerVector(std::ostream &amp;os, bool binary, const std::vector&lt; T &gt; &amp;v)</div><div class="ttdoc">Function for writing STL vectors of integer types. </div><div class="ttdef"><b>Definition:</b> <a href="io-funcs-inl_8h_source.html#l00091">io-funcs-inl.h:91</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gae04ff751dd230f18c7091b28bac598a1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">fst::VectorFst&lt; <a class="el" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a> &gt; * GetPdfToTransitionIdTransducer </td>
          <td>(</td>
          <td class="paramtype">const TransitionModel &amp;&#160;</td>
          <td class="paramname"><em>trans_model</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns a transducer from pdfs plus one (input) to transition-ids (output). </p>
<p>Currenly of use only for testing. </p>

<p>Definition at line <a class="el" href="hmm-utils_8cc_source.html#l00384">384</a> of file <a class="el" href="hmm-utils_8cc_source.html">hmm-utils.cc</a>.</p>

<p>References <a class="el" href="transition-model_8h_source.html#l00166">TransitionModel::NumTransitionIds()</a>, and <a class="el" href="transition-model_8h_source.html#l00312">TransitionModel::TransitionIdToPdf()</a>.</p>

<p>Referenced by <a class="el" href="make-pdf-to-tid-transducer_8cc_source.html#l00025">main()</a>.</p>
<div class="fragment"><div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                                                                                            {</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="keyword">using namespace </span>fst;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  VectorFst&lt;StdArc&gt; *ans = <span class="keyword">new</span> VectorFst&lt;StdArc&gt;;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="lattice-arcgraph_8cc.html#a2fdd196e46607f0d35b13369d9f9970d">VectorFst&lt;StdArc&gt;::Weight</a> <a class="code" href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">Weight</a>;</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="keyword">typedef</span> <a class="code" href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">StdArc</a> <a class="code" href="namespacekaldi.html#a4ce48a4aa890590d2bbbeaa26cdac97b">Arc</a>;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;  ans-&gt;AddState();</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  ans-&gt;SetStart(0);</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  ans-&gt;SetFinal(0, Weight::One());</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> tid = 1; tid &lt;= trans_model.NumTransitionIds(); tid++) {</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;    <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> pdf = trans_model.TransitionIdToPdf(tid);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    ans-&gt;AddArc(0, <a class="code" href="namespacekaldi.html#a4ce48a4aa890590d2bbbeaa26cdac97b">Arc</a>(pdf+1, tid, Weight::One(), 0));  <span class="comment">// note the offset of 1 on the pdfs.</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="comment">// it&#39;s because 0 is a valid pdf.</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  }</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <span class="keywordflow">return</span> ans;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;}</div>
<div class="ttc" id="namespacefst_html_a70478eb2428a9406e4692d19a7a3a97f"><div class="ttname"><a href="namespacefst.html#a70478eb2428a9406e4692d19a7a3a97f">fst::StdArc</a></div><div class="ttdeci">fst::StdArc StdArc</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00053">deterministic-fst-test.cc:53</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab7903878916593daecbeb95b98115ab0"><div class="ttname"><a href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">kaldi::int32</a></div><div class="ttdeci">int32_t int32</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00047">kaldi-types.h:47</a></div></div>
<div class="ttc" id="namespacekaldi_html_a4ce48a4aa890590d2bbbeaa26cdac97b"><div class="ttname"><a href="namespacekaldi.html#a4ce48a4aa890590d2bbbeaa26cdac97b">kaldi::Arc</a></div><div class="ttdeci">KwsLexicographicArc Arc</div><div class="ttdef"><b>Definition:</b> <a href="kws-search_8cc_source.html#l00028">kws-search.cc:28</a></div></div>
<div class="ttc" id="namespacefst_html_a2fdd196e46607f0d35b13369d9f9970d"><div class="ttname"><a href="namespacefst.html#a2fdd196e46607f0d35b13369d9f9970d">fst::Weight</a></div><div class="ttdeci">fst::StdArc::Weight Weight</div><div class="ttdef"><b>Definition:</b> <a href="deterministic-fst-test_8cc_source.html#l00057">deterministic-fst-test.cc:57</a></div></div>
<div class="ttc" id="lattice-arcgraph_8cc_html_a2fdd196e46607f0d35b13369d9f9970d"><div class="ttname"><a href="lattice-arcgraph_8cc.html#a2fdd196e46607f0d35b13369d9f9970d">Weight</a></div><div class="ttdeci">fst::StdArc::Weight Weight</div><div class="ttdef"><b>Definition:</b> <a href="lattice-arcgraph_8cc_source.html#l00028">lattice-arcgraph.cc:28</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Apr 26 2016 14:54:46 for Kaldi by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
