<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kaldi: Some simple functions used in clustering algorithms</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <td id="projectlogo"><a href="http://kaldi-asr.org/"><img alt="Logo" src="KaldiTextAndLogoSmall.png"/ style="padding: 3px 5px 1px 5px"></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">Kaldi
   </div>
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief" style="display:none"></div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__clustering__group__simple.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Some simple functions used in clustering algorithms<div class="ingroups"><a class="el" href="group__clustering__group.html">Classes and functions related to clustering</a></div></div>  </div>
</div><!--header-->
<div class="contents">

<p>See <a class="el" href="clustering.html">Clustering mechanisms in Kaldi</a> for context.  
<a href="#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for Some simple functions used in clustering algorithms:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__clustering__group__simple.png" border="0" alt="" usemap="#group____clustering____group____simple"/>
<map name="group____clustering____group____simple" id="group____clustering____group____simple">
<area shape="rect" id="node2" href="group__clustering__group.html" title="See Clustering mechanisms in Kaldi for context. " alt="" coords="6,5,167,46"/></map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga5b94b852abd3cba4d27c0a93d9fb6636"><td class="memItemLeft" align="right" valign="top">BaseFloat&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__clustering__group__simple.html#ga5b94b852abd3cba4d27c0a93d9fb6636">SumClusterableObjf</a> (const std::vector&lt; Clusterable * &gt; &amp;vec)</td></tr>
<tr class="memdesc:ga5b94b852abd3cba4d27c0a93d9fb6636"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the total objective function after adding up all the statistics in the vector (pointers may be NULL).  <a href="#ga5b94b852abd3cba4d27c0a93d9fb6636">More...</a><br/></td></tr>
<tr class="separator:ga5b94b852abd3cba4d27c0a93d9fb6636"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab13a71ba2459d0dab7158bed4cc0c446"><td class="memItemLeft" align="right" valign="top">BaseFloat&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__clustering__group__simple.html#gab13a71ba2459d0dab7158bed4cc0c446">SumClusterableNormalizer</a> (const std::vector&lt; Clusterable * &gt; &amp;vec)</td></tr>
<tr class="memdesc:gab13a71ba2459d0dab7158bed4cc0c446"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the total normalizer (usually count) of the cluster (pointers may be NULL).  <a href="#gab13a71ba2459d0dab7158bed4cc0c446">More...</a><br/></td></tr>
<tr class="separator:gab13a71ba2459d0dab7158bed4cc0c446"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaff174b51fa1fc6713cd81ee377bb8da1"><td class="memItemLeft" align="right" valign="top">Clusterable *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__clustering__group__simple.html#gaff174b51fa1fc6713cd81ee377bb8da1">SumClusterable</a> (const std::vector&lt; Clusterable * &gt; &amp;vec)</td></tr>
<tr class="memdesc:gaff174b51fa1fc6713cd81ee377bb8da1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Sums stats (ptrs may be NULL). Returns NULL if no non-NULL stats present.  <a href="#gaff174b51fa1fc6713cd81ee377bb8da1">More...</a><br/></td></tr>
<tr class="separator:gaff174b51fa1fc6713cd81ee377bb8da1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaf94c6539a2a7130fc9ab220318dcbdd9"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__clustering__group__simple.html#gaf94c6539a2a7130fc9ab220318dcbdd9">EnsureClusterableVectorNotNull</a> (std::vector&lt; Clusterable * &gt; *stats)</td></tr>
<tr class="memdesc:gaf94c6539a2a7130fc9ab220318dcbdd9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fills in any (NULL) holes in "stats" vector, with empty stats, because certain algorithms require non-NULL stats.  <a href="#gaf94c6539a2a7130fc9ab220318dcbdd9">More...</a><br/></td></tr>
<tr class="separator:gaf94c6539a2a7130fc9ab220318dcbdd9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga136f93226cb2868e7b39bdb2a676e82e"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__clustering__group__simple.html#ga136f93226cb2868e7b39bdb2a676e82e">AddToClusters</a> (const std::vector&lt; Clusterable * &gt; &amp;stats, const std::vector&lt; int32 &gt; &amp;assignments, std::vector&lt; Clusterable * &gt; *clusters)</td></tr>
<tr class="memdesc:ga136f93226cb2868e7b39bdb2a676e82e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Given stats and a vector "assignments" of the same size (that maps to cluster indices), sums the stats up into "clusters." It will add to any stats already present in "clusters" (although typically "clusters" will be empty when called), and it will extend with NULL pointers for any unseen indices.  <a href="#ga136f93226cb2868e7b39bdb2a676e82e">More...</a><br/></td></tr>
<tr class="separator:ga136f93226cb2868e7b39bdb2a676e82e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2cd3048bcf7d9e9f4c311064e4ed47b0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__clustering__group__simple.html#ga2cd3048bcf7d9e9f4c311064e4ed47b0">AddToClustersOptimized</a> (const std::vector&lt; Clusterable * &gt; &amp;stats, const std::vector&lt; int32 &gt; &amp;assignments, const Clusterable &amp;total, std::vector&lt; Clusterable * &gt; *clusters)</td></tr>
<tr class="memdesc:ga2cd3048bcf7d9e9f4c311064e4ed47b0"><td class="mdescLeft">&#160;</td><td class="mdescRight">AddToClustersOptimized does the same as AddToClusters (it sums up the stats within each cluster, except it uses the sum of all the stats ("total") to optimize the computation for speed, if possible.  <a href="#ga2cd3048bcf7d9e9f4c311064e4ed47b0">More...</a><br/></td></tr>
<tr class="separator:ga2cd3048bcf7d9e9f4c311064e4ed47b0"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>See <a class="el" href="clustering.html">Clustering mechanisms in Kaldi</a> for context. </p>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga136f93226cb2868e7b39bdb2a676e82e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AddToClusters </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; Clusterable * &gt; &amp;&#160;</td>
          <td class="paramname"><em>stats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>assignments</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; Clusterable * &gt; *&#160;</td>
          <td class="paramname"><em>clusters</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Given stats and a vector "assignments" of the same size (that maps to cluster indices), sums the stats up into "clusters." It will add to any stats already present in "clusters" (although typically "clusters" will be empty when called), and it will extend with NULL pointers for any unseen indices. </p>
<p>Call EnsureClusterableStatsNotNull afterwards if you want to ensure all non-NULL clusters. Pointer in "clusters" are owned by caller. Pointers in "stats" do not have to be non-NULL. </p>

<p>Definition at line <a class="el" href="cluster-utils_8cc_source.html#l00108">108</a> of file <a class="el" href="cluster-utils_8cc_source.html">cluster-utils.cc</a>.</p>

<p>References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, and <a class="el" href="kaldi-error_8h_source.html#l00143">KALDI_ASSERT</a>.</p>

<p>Referenced by <a class="el" href="build-tree-utils_8cc_source.html#l00348">kaldi::FindBestSplitForKey()</a>, <a class="el" href="cluster-utils-test_8cc_source.html#l00155">kaldi::TestAddToClusters()</a>, and <a class="el" href="cluster-utils-test_8cc_source.html#l00182">kaldi::TestAddToClustersOptimized()</a>.</p>
<div class="fragment"><div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                                                      {</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(assignments.size() == stats.size());</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> size = stats.size();</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;  <span class="keywordflow">if</span> (size == 0) <span class="keywordflow">return</span>;  <span class="comment">// Nothing to do.</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(clusters != NULL);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> max_assignment = *std::max_element(assignments.begin(),</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                                           assignments.end());</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;  <span class="keywordflow">if</span> (static_cast&lt;int32&gt; (clusters-&gt;size()) &lt;= max_assignment)</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    clusters-&gt;resize(max_assignment + 1, NULL);  <span class="comment">// extend with NULLs.</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;    <span class="keywordflow">if</span> (stats[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] != NULL) {</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;      <span class="keywordflow">if</span> ((*clusters)[assignments[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]] == NULL)</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        (*clusters)[assignments[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]] = stats[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;Copy();</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        (*clusters)[assignments[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]]-&gt;Add(*(stats[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]));</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    }</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;  }</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;}</div>
<div class="ttc" id="namespacekaldi_html_ab7903878916593daecbeb95b98115ab0"><div class="ttname"><a href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">kaldi::int32</a></div><div class="ttdeci">int32_t int32</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00047">kaldi-types.h:47</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga2cd3048bcf7d9e9f4c311064e4ed47b0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void AddToClustersOptimized </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; Clusterable * &gt; &amp;&#160;</td>
          <td class="paramname"><em>stats</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const std::vector&lt; int32 &gt; &amp;&#160;</td>
          <td class="paramname"><em>assignments</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const Clusterable &amp;&#160;</td>
          <td class="paramname"><em>total</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">std::vector&lt; Clusterable * &gt; *&#160;</td>
          <td class="paramname"><em>clusters</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>AddToClustersOptimized does the same as AddToClusters (it sums up the stats within each cluster, except it uses the sum of all the stats ("total") to optimize the computation for speed, if possible. </p>
<p>This will generally only be a significant speedup in the case where there are just two clusters, which can happen in algorithms that are doing binary splits; the idea is that we sum up all the stats in one cluster (the one with the fewest points in it), and then subtract from the total. </p>

<p>Definition at line <a class="el" href="cluster-utils_8cc_source.html#l00130">130</a> of file <a class="el" href="cluster-utils_8cc_source.html">cluster-utils.cc</a>.</p>

<p>References <a class="el" href="classkaldi_1_1Clusterable.html#a41426cead312448b077daa7364d6bc2c">Clusterable::Add()</a>, <a class="el" href="kaldi-math_8h_source.html#l00273">kaldi::AssertEqual()</a>, <a class="el" href="classkaldi_1_1Clusterable.html#a8d12da01efa84708312b960e15109f14">Clusterable::Copy()</a>, <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-error_8h_source.html#l00143">KALDI_ASSERT</a>, <a class="el" href="classkaldi_1_1Clusterable.html#a5154f568aaaa47b82b942be87c514e47">Clusterable::Normalizer()</a>, and <a class="el" href="cluster-utils_8cc_source.html#l00054">kaldi::SumClusterableNormalizer()</a>.</p>

<p>Referenced by <a class="el" href="build-tree-utils_8cc_source.html#l00297">kaldi::ComputeInitialSplit()</a>, and <a class="el" href="cluster-utils-test_8cc_source.html#l00182">kaldi::TestAddToClustersOptimized()</a>.</p>
<div class="fragment"><div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                                                               {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="preprocessor">#ifdef KALDI_PARANOID</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="preprocessor"></span>  <span class="comment">// Make sure &quot;total&quot; is actually the sum of stats in &quot;stats&quot;.</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;  {</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> stats_norm = <a class="code" href="group__clustering__group__simple.html#gab13a71ba2459d0dab7158bed4cc0c446">SumClusterableNormalizer</a>(stats),</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    tot_norm = total.Normalizer();</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    <a class="code" href="namespacekaldi.html#aeb6ba6085493e3f15358e49751342177">AssertEqual</a>(stats_norm, tot_norm, 0.01);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;  }</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(assignments.size() == stats.size());</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> size = stats.size();</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;  <span class="keywordflow">if</span> (size == 0) <span class="keywordflow">return</span>;  <span class="comment">// Nothing to do.</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(clusters != NULL);</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> num_clust = 1 + *std::max_element(assignments.begin(),</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                                          assignments.end());</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;  <span class="keywordflow">if</span> (static_cast&lt;int32&gt; (clusters-&gt;size()) &lt; num_clust)</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    clusters-&gt;resize(num_clust, NULL);  <span class="comment">// extend with NULLs.</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;  std::vector&lt;int32&gt; num_stats_for_cluster(num_clust, 0);</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> num_total_stats = 0;</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="keywordflow">if</span> (stats[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] != NULL) {</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;      num_total_stats++;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;      num_stats_for_cluster[assignments[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]]++;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    }</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  }</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;  <span class="keywordflow">if</span> (num_total_stats == 0) <span class="keywordflow">return</span>;  <span class="comment">// Nothing to do.</span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  <span class="comment">//  it will only ever be efficient to subtract for at most one index.</span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> subtract_index = -1;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> c = 0; c &lt; num_clust; c++) {</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;    <span class="keywordflow">if</span> (num_stats_for_cluster[c] &gt; num_total_stats - num_stats_for_cluster[c]) {</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;      subtract_index = c;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;      <span class="keywordflow">if</span> ((*clusters)[c] == NULL)</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;        (*clusters)[c] = total.Copy();</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        (*clusters)[c]-&gt;Add(total);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    }</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;  }</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; size; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordflow">if</span> (stats[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] != NULL) {</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> assignment = assignments[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;      <span class="keywordflow">if</span> (assignment != (<a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a>) subtract_index) {</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;        <span class="keywordflow">if</span> ((*clusters)[assignment] == NULL)</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;          (*clusters)[assignment] = stats[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;Copy();</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;          (*clusters)[assignment]-&gt;Add(*(stats[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]));</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;      }</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;      <span class="keywordflow">if</span> (subtract_index != -1 &amp;&amp; assignment != subtract_index)</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;        (*clusters)[subtract_index]-&gt;Sub(*(stats[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]));</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;    }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;  }</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;}</div>
<div class="ttc" id="group__clustering__group__simple_html_gab13a71ba2459d0dab7158bed4cc0c446"><div class="ttname"><a href="group__clustering__group__simple.html#gab13a71ba2459d0dab7158bed4cc0c446">kaldi::SumClusterableNormalizer</a></div><div class="ttdeci">BaseFloat SumClusterableNormalizer(const std::vector&lt; Clusterable * &gt; &amp;vec)</div><div class="ttdoc">Returns the total normalizer (usually count) of the cluster (pointers may be NULL). </div><div class="ttdef"><b>Definition:</b> <a href="cluster-utils_8cc_source.html#l00054">cluster-utils.cc:54</a></div></div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab7903878916593daecbeb95b98115ab0"><div class="ttname"><a href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">kaldi::int32</a></div><div class="ttdeci">int32_t int32</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00047">kaldi-types.h:47</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
<div class="ttc" id="namespacekaldi_html_aeb6ba6085493e3f15358e49751342177"><div class="ttname"><a href="namespacekaldi.html#aeb6ba6085493e3f15358e49751342177">kaldi::AssertEqual</a></div><div class="ttdeci">static void AssertEqual(float a, float b, float relative_tolerance=0.001)</div><div class="ttdoc">assert abs(a - b) &lt;= relative_tolerance * (abs(a)+abs(b)) </div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00273">kaldi-math.h:273</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gaf94c6539a2a7130fc9ab220318dcbdd9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void EnsureClusterableVectorNotNull </td>
          <td>(</td>
          <td class="paramtype">std::vector&lt; Clusterable * &gt; *&#160;</td>
          <td class="paramname"><em>stats</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fills in any (NULL) holes in "stats" vector, with empty stats, because certain algorithms require non-NULL stats. </p>
<p>If "stats" nonempty, requires it to contain at least one non-NULL pointer that we can call <a class="el" href="namespacekaldi_1_1cu.html#a42584465c09901a98e3c5094d881215e" title="Copies elements from src into tgt as given by copy_from_indices. ">Copy()</a> on. </p>

<p>Definition at line <a class="el" href="cluster-utils_8cc_source.html#l00082">82</a> of file <a class="el" href="cluster-utils_8cc_source.html">cluster-utils.cc</a>.</p>

<p>References <a class="el" href="classkaldi_1_1Clusterable.html#a8d12da01efa84708312b960e15109f14">Clusterable::Copy()</a>, <a class="el" href="kaldi-error_8h_source.html#l00143">KALDI_ASSERT</a>, <a class="el" href="kaldi-error_8h_source.html#l00160">KALDI_ERR</a>, and <a class="el" href="classkaldi_1_1Clusterable.html#a5f774334305ebbf23c471784cf851357">Clusterable::SetZero()</a>.</p>

<p>Referenced by <a class="el" href="tree_2build-tree_8cc_source.html#l00541">kaldi::AutomaticallyObtainQuestions()</a>, <a class="el" href="build-tree-utils_8cc_source.html#l00348">kaldi::FindBestSplitForKey()</a>, <a class="el" href="tree_2build-tree_8cc_source.html#l00674">kaldi::KMeansClusterPhones()</a>, and <a class="el" href="cluster-utils-test_8cc_source.html#l00146">kaldi::TestEnsureClusterableVectorNotNull()</a>.</p>
<div class="fragment"><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                                                                    {</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(stats != NULL);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  std::vector&lt;Clusterable*&gt;::iterator itr = stats-&gt;begin(), end = stats-&gt;end();</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;  <span class="keywordflow">if</span> (itr == end) <span class="keywordflow">return</span>;  <span class="comment">// Nothing to do.</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;  Clusterable *nonNullExample = NULL;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;  <span class="keywordflow">for</span> (; itr != end; ++itr) {</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="keywordflow">if</span> (*itr != NULL) {</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;      nonNullExample = *itr;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;      <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    }</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  }</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  <span class="keywordflow">if</span> (nonNullExample == NULL) {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;    <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;All stats are NULL.&quot;</span>;  <span class="comment">// crash. logic error.</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  }</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  itr = stats-&gt;begin();</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  Clusterable *nonNullExampleCopy = nonNullExample-&gt;Copy();</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="comment">// sets stats to zero. do this just once (on copy) for efficiency.</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;  nonNullExampleCopy-&gt;SetZero();</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <span class="keywordflow">for</span> (; itr != end; ++itr) {</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    <span class="keywordflow">if</span> (*itr == NULL) {</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;      *itr = nonNullExampleCopy-&gt;Copy();</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    }</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;  }</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;  <span class="keyword">delete</span> nonNullExampleCopy;</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;}</div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00160">kaldi-error.h:160</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gaff174b51fa1fc6713cd81ee377bb8da1"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Clusterable * SumClusterable </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; Clusterable * &gt; &amp;&#160;</td>
          <td class="paramname"><em>vec</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Sums stats (ptrs may be NULL). Returns NULL if no non-NULL stats present. </p>

<p>Definition at line <a class="el" href="cluster-utils_8cc_source.html#l00069">69</a> of file <a class="el" href="cluster-utils_8cc_source.html">cluster-utils.cc</a>.</p>

<p>References <a class="el" href="classkaldi_1_1Clusterable.html#a41426cead312448b077daa7364d6bc2c">Clusterable::Add()</a>, <a class="el" href="classkaldi_1_1Clusterable.html#a8d12da01efa84708312b960e15109f14">Clusterable::Copy()</a>, and <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>.</p>

<p>Referenced by <a class="el" href="cluster-utils_8cc_source.html#l00917">kaldi::ClusterKMeansOnce()</a>, <a class="el" href="build-tree-utils_8cc_source.html#l00297">kaldi::ComputeInitialSplit()</a>, <a class="el" href="cluster-utils_8cc_source.html#l01213">TreeClusterer::Init()</a>, <a class="el" href="gmm-init-model_8cc_source.html#l00035">kaldi::InitAmGmm()</a>, <a class="el" href="cluster-utils-test_8cc_source.html#l00182">kaldi::TestAddToClustersOptimized()</a>, and <a class="el" href="cluster-utils-test_8cc_source.html#l00136">kaldi::TestSum()</a>.</p>
<div class="fragment"><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                                                                {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;  Clusterable *ans = NULL;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; vec.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">if</span> (vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] != NULL) {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      <span class="keywordflow">if</span> (ans == NULL)</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        ans = vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;Copy();</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        ans-&gt;Add(*(vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]));</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;    }</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;  }</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  <span class="keywordflow">return</span> ans;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;}</div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="gab13a71ba2459d0dab7158bed4cc0c446"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BaseFloat SumClusterableNormalizer </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; Clusterable * &gt; &amp;&#160;</td>
          <td class="paramname"><em>vec</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the total normalizer (usually count) of the cluster (pointers may be NULL). </p>

<p>Definition at line <a class="el" href="cluster-utils_8cc_source.html#l00054">54</a> of file <a class="el" href="cluster-utils_8cc_source.html">cluster-utils.cc</a>.</p>

<p>References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-math_8h_source.html#l00072">KALDI_ISNAN</a>, and <a class="el" href="kaldi-error_8h_source.html#l00162">KALDI_WARN</a>.</p>

<p>Referenced by <a class="el" href="cluster-utils_8cc_source.html#l00130">kaldi::AddToClustersOptimized()</a>, <a class="el" href="build-tree-utils_8cc_source.html#l00599">kaldi::ClusterEventMapGetMapping()</a>, <a class="el" href="cluster-utils_8cc_source.html#l00917">kaldi::ClusterKMeansOnce()</a>, <a class="el" href="tree_2build-tree_8cc_source.html#l00674">kaldi::KMeansClusterPhones()</a>, <a class="el" href="cluster-utils-test_8cc_source.html#l00182">kaldi::TestAddToClustersOptimized()</a>, and <a class="el" href="cluster-utils-test_8cc_source.html#l00124">kaldi::TestSumObjfAndSumNormalizer()</a>.</p>
<div class="fragment"><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                                                                       {</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> ans = 0.0;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; vec.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;    <span class="keywordflow">if</span> (vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] != NULL) {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> objf = vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;Normalizer();</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="kaldi-math_8h.html#a784e8ae012c86a36a1f764b8ed829746">KALDI_ISNAN</a>(objf)) {</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;SumClusterableObjf, NaN objf&quot;</span>;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        ans += objf;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;      }</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;    }</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;  }</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;  <span class="keywordflow">return</span> ans;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;}</div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00162">kaldi-error.h:162</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="kaldi-math_8h_html_a784e8ae012c86a36a1f764b8ed829746"><div class="ttname"><a href="kaldi-math_8h.html#a784e8ae012c86a36a1f764b8ed829746">KALDI_ISNAN</a></div><div class="ttdeci">#define KALDI_ISNAN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00072">kaldi-math.h:72</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ga5b94b852abd3cba4d27c0a93d9fb6636"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">BaseFloat SumClusterableObjf </td>
          <td>(</td>
          <td class="paramtype">const std::vector&lt; Clusterable * &gt; &amp;&#160;</td>
          <td class="paramname"><em>vec</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the total objective function after adding up all the statistics in the vector (pointers may be NULL). </p>

<p>Definition at line <a class="el" href="cluster-utils_8cc_source.html#l00039">39</a> of file <a class="el" href="cluster-utils_8cc_source.html">cluster-utils.cc</a>.</p>

<p>References <a class="el" href="mikolov-rnnlm-lib_8cc_source.html#l00066">rnnlm::i</a>, <a class="el" href="kaldi-math_8h_source.html#l00072">KALDI_ISNAN</a>, and <a class="el" href="kaldi-error_8h_source.html#l00162">KALDI_WARN</a>.</p>

<p>Referenced by <a class="el" href="cluster-utils_8cc_source.html#l00917">kaldi::ClusterKMeansOnce()</a>, <a class="el" href="build-tree-utils_8cc_source.html#l00297">kaldi::ComputeInitialSplit()</a>, <a class="el" href="build-tree-utils_8cc_source.html#l00285">kaldi::ObjfGivenMap()</a>, <a class="el" href="cluster-utils-test_8cc_source.html#l00328">kaldi::TestClusterKMeans()</a>, <a class="el" href="cluster-utils-test_8cc_source.html#l00387">kaldi::TestClusterKMeansVector()</a>, <a class="el" href="cluster-utils-test_8cc_source.html#l00508">kaldi::TestClusterTopDown()</a>, <a class="el" href="cluster-utils-test_8cc_source.html#l00285">kaldi::TestRefineClusters()</a>, <a class="el" href="cluster-utils-test_8cc_source.html#l00124">kaldi::TestSumObjfAndSumNormalizer()</a>, and <a class="el" href="cluster-utils-test_8cc_source.html#l00460">kaldi::TestTreeCluster()</a>.</p>
<div class="fragment"><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;                                                                 {</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> ans = 0.0;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; vec.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;    <span class="keywordflow">if</span> (vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>] != NULL) {</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;      <a class="code" href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">BaseFloat</a> objf = vec[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>]-&gt;Objf();</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;      <span class="keywordflow">if</span> (<a class="code" href="kaldi-math_8h.html#a784e8ae012c86a36a1f764b8ed829746">KALDI_ISNAN</a>(objf)) {</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <a class="code" href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a> &lt;&lt; <span class="stringliteral">&quot;SumClusterableObjf, NaN objf&quot;</span>;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;      } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        ans += objf;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;      }</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    }</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;  }</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  <span class="keywordflow">return</span> ans;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;}</div>
<div class="ttc" id="namespacekaldi_html_aa66ff8367094543664b3b6a13d77c139"><div class="ttname"><a href="namespacekaldi.html#aa66ff8367094543664b3b6a13d77c139">kaldi::BaseFloat</a></div><div class="ttdeci">float BaseFloat</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00029">kaldi-types.h:29</a></div></div>
<div class="ttc" id="group__error__group_html_ga994be213ddf127b5d6f20a43a02b513a"><div class="ttname"><a href="group__error__group.html#ga994be213ddf127b5d6f20a43a02b513a">KALDI_WARN</a></div><div class="ttdeci">#define KALDI_WARN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00162">kaldi-error.h:162</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="kaldi-math_8h_html_a784e8ae012c86a36a1f764b8ed829746"><div class="ttname"><a href="kaldi-math_8h.html#a784e8ae012c86a36a1f764b8ed829746">KALDI_ISNAN</a></div><div class="ttdeci">#define KALDI_ISNAN</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-math_8h_source.html#l00072">kaldi-math.h:72</a></div></div>
</div><!-- fragment -->
</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Apr 26 2016 14:54:46 for Kaldi by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
