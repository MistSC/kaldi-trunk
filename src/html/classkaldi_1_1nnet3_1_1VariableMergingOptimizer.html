<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kaldi: VariableMergingOptimizer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <td id="projectlogo"><a href="http://kaldi-asr.org/"><img alt="Logo" src="KaldiTextAndLogoSmall.png"/ style="padding: 3px 5px 1px 5px"></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">Kaldi
   </div>
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief" style="display:none"></div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">VariableMergingOptimizer Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>This class is responsible for merging matrices, although you probably want to access it via the the function <a class="el" href="namespacekaldi_1_1nnet3.html#a7464172a2f27484596c2d374bb1adcd6" title="This wraps class VariableMergingOptimizer in a simplified interface. ">VariableMergingOptimization()</a>.  
 <a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="nnet-optimize-utils_8h_source.html">nnet-optimize-utils.h</a>&gt;</code></p>
<div class="dynheader">
Collaboration diagram for VariableMergingOptimizer:</div>
<div class="dyncontent">
<div class="center"><img src="classkaldi_1_1nnet3_1_1VariableMergingOptimizer__coll__graph.png" border="0" usemap="#VariableMergingOptimizer_coll__map" alt="Collaboration graph"/></div>
<map name="VariableMergingOptimizer_coll__map" id="VariableMergingOptimizer_coll__map">
<area shape="rect" id="node2" href="structkaldi_1_1nnet3_1_1ComputationRequest.html" title="ComputationRequest" alt="" coords="847,93,1003,120"/><area shape="rect" id="node3" href="structkaldi_1_1nnet3_1_1MiscComputationInfo.html" title="MiscComputationInfo" alt="" coords="413,5,569,32"/><area shape="rect" id="node6" href="structkaldi_1_1nnet3_1_1NnetComputation.html" title="NnetComputation" alt="" coords="857,681,993,708"/><area shape="rect" id="node25" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html" title="NnetOptimizeOptions" alt="" coords="846,732,1005,759"/><area shape="rect" id="node21" href="classkaldi_1_1nnet3_1_1ComputationVariables.html" title="This class relates the matrices and sub&#45;matrices in the computation to imaginary &quot;variables&quot;, such that we can think of the operations as operating on sets of individual variables, and we can then do analysis that lets us do optimization. " alt="" coords="409,1223,572,1249"/><area shape="rect" id="node17" href="structkaldi_1_1nnet3_1_1Analyzer.html" title="This struct exists to set up various pieces of analysis; it helps avoid the repetition of code where ..." alt="" coords="887,1223,964,1249"/><area shape="rect" id="node26" href="classkaldi_1_1nnet3_1_1Nnet.html" title="Nnet" alt="" coords="899,1533,952,1560"/></map>
<center><span class="legend">[<a target="top" href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ae52c106fb3f904728cb5c55c6c4184e0"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ae52c106fb3f904728cb5c55c6c4184e0">VariableMergingOptimizer</a> (const <a class="el" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> &amp;config, const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;request, <a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation)</td></tr>
<tr class="separator:ae52c106fb3f904728cb5c55c6c4184e0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a08a57d03b1828eeb8548ee5e8a942264"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a08a57d03b1828eeb8548ee5e8a942264">MergeVariables</a> ()</td></tr>
<tr class="separator:a08a57d03b1828eeb8548ee5e8a942264"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:a18aa0d59c61851a3e1138a100488ea5b"><td class="memItemLeft" align="right" valign="top">std::pair&lt; bool, bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a18aa0d59c61851a3e1138a100488ea5b">MayBeMerged</a> (<a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> command, <a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> s1, <a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> s2) const </td></tr>
<tr class="memdesc:a18aa0d59c61851a3e1138a100488ea5b"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function returns a pair of bools saying whether we can do a (left and/or right) merge respectively, based on the conditions defined in the header.  <a href="#a18aa0d59c61851a3e1138a100488ea5b">More...</a><br/></td></tr>
<tr class="separator:a18aa0d59c61851a3e1138a100488ea5b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af3b2fad1be81ad4faf61e71f07486ef0"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#af3b2fad1be81ad4faf61e71f07486ef0">DoLeftMerge</a> (<a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> command_index, <a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> s1, <a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> s2)</td></tr>
<tr class="separator:af3b2fad1be81ad4faf61e71f07486ef0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab9dc158a3fd3e688df0e1df6912cd7b1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ab9dc158a3fd3e688df0e1df6912cd7b1">DoRightMerge</a> (<a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> command_index, <a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> s1, <a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> s2)</td></tr>
<tr class="separator:ab9dc158a3fd3e688df0e1df6912cd7b1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a333f8ed19d13a9725fc630b765490020"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a333f8ed19d13a9725fc630b765490020">DoMergeCommon</a> (<a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> command_index, <a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> m_to_keep, <a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> m_to_discard)</td></tr>
<tr class="separator:a333f8ed19d13a9725fc630b765490020"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60ce57f518b5fa77d140cb414354cd95"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a60ce57f518b5fa77d140cb414354cd95">MarkAsDirty</a> (<a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> s)</td></tr>
<tr class="memdesc:a60ce57f518b5fa77d140cb414354cd95"><td class="mdescLeft">&#160;</td><td class="mdescRight">Marks the variables underlying submatrix 's' as dirty.  <a href="#a60ce57f518b5fa77d140cb414354cd95">More...</a><br/></td></tr>
<tr class="separator:a60ce57f518b5fa77d140cb414354cd95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a98b1050f09da390896f964fb7a892391"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a98b1050f09da390896f964fb7a892391">Initialize</a> ()</td></tr>
<tr class="separator:a98b1050f09da390896f964fb7a892391"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a4dcce2ef4364ac3b222debac11646a39"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a4dcce2ef4364ac3b222debac11646a39">config_</a></td></tr>
<tr class="separator:a4dcce2ef4364ac3b222debac11646a39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adbabf05a7702103113a02a113015205f"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#adbabf05a7702103113a02a113015205f">nnet_</a></td></tr>
<tr class="separator:adbabf05a7702103113a02a113015205f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a12563ff580f9e7179c096ed44f1e2ca7"><td class="memItemLeft" align="right" valign="top">const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a12563ff580f9e7179c096ed44f1e2ca7">request_</a></td></tr>
<tr class="separator:a12563ff580f9e7179c096ed44f1e2ca7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a36d13565d1302a2bf74127b141ba3537"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a></td></tr>
<tr class="separator:a36d13565d1302a2bf74127b141ba3537"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac8ca96df1ecdb635738c59a88cff8835"><td class="memItemLeft" align="right" valign="top"><a class="el" href="structkaldi_1_1nnet3_1_1Analyzer.html">Analyzer</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">analyzer_</a></td></tr>
<tr class="separator:ac8ca96df1ecdb635738c59a88cff8835"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0655730456d3a04cafe943687894a84d"><td class="memItemLeft" align="right" valign="top">std::vector&lt; std::vector&lt; <a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> &gt; &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a0655730456d3a04cafe943687894a84d">matrix_to_submatrix_</a></td></tr>
<tr class="separator:a0655730456d3a04cafe943687894a84d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63de82c33f6a7330727c0f2fc670ae0d"><td class="memItemLeft" align="right" valign="top">std::vector&lt; bool &gt;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a63de82c33f6a7330727c0f2fc670ae0d">variable_dirty_</a></td></tr>
<tr class="separator:a63de82c33f6a7330727c0f2fc670ae0d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a400e33db7a90834eec20a7eee34f162d"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a400e33db7a90834eec20a7eee34f162d">already_called_merge_variables_</a></td></tr>
<tr class="separator:a400e33db7a90834eec20a7eee34f162d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>This class is responsible for merging matrices, although you probably want to access it via the the function <a class="el" href="namespacekaldi_1_1nnet3.html#a7464172a2f27484596c2d374bb1adcd6" title="This wraps class VariableMergingOptimizer in a simplified interface. ">VariableMergingOptimization()</a>. </p>
<p>We identify pairs of submatrices which can potentially be merged into a single submatrix.</p>
<p>Suppose there are two different submatrices s1 != s2 that are submatrices of different respective matrices m1 != m2, and somewhere in the computation we have a command C, which is one of: (a) the assignment command "s2 = s1", or (b) a propagate command with s1 as input and s2 as output, with a component that supports propagate in place, or (c) a backprop command with s1 as output-deriv and s2 as input-deriv, with a component that supports backprop in place.</p>
<p>Then the triple (C, s1, s2) is a candidate for merging. We support two types of merging: 'right merging', in which we delete s1 and use s2 instead; and 'left merging' in which we delete s2 and use s1 instead. The two types of merging may seem to be the same thing, but remember that in general s1 and s2 may be sub-matrices of larger matrices.</p>
<p>Note: the following</p>
<ul>
<li>Define last-access(submatrix) as: If matrix-of(submatrix) is an output, then num-commands, otherwise the last command that accesses that submatrix for either read or write. [note: deallocation does not count as a read or write operation].</li>
<li>Define first-access(submatrix) as: If matrix-of(submatrix) is an input, then -1, otherwise the first command that is *not* an allocation command that accessed that submatrix for either read or write.</li>
<li>Define last-write-access(submatrix) as the last command-index that accessed the submatrix in a write operation, or -1 if there is no such command (this could happen for inputs).</li>
<li>Define data-invalidated-command(c, submatrix) as the first command-index after 'c' that 'submatrix' is written to; or if there is no such command, then the command index of the deallocation command for 'submatrix'; or if this does not exist, then num-commands.</li>
</ul>
<p>The conditions that must be satisfied for both left and right merges:</p>
<ul>
<li>It cannot be the case that m1 and m2 are both inputs, or that they are both outputs. [condition c1]</li>
<li>If either m1 or m2 is an input or an output, then s1 must be the entirety of m1 and s2 must be the entirety of m2 (this is because inputs and outputs must be whole matrices). [condition c2]</li>
<li>If we are left-merging (deleting s2,m2), then s2 must be the entirety of m2. [condition c3]</li>
<li>If we are right-merging (deleting s1,m1), then s1 must be the entirety of m1. [condition c4]</li>
<li>None of the the variables underlying s1 and s2 may be marked as 'dirty' (implying that they were the subjects of a previous merge during the lifetime of this class) [condition c5]</li>
</ul>
<p>If the command C is case (a), i.e. an assignment operation, then the following conditions must apply:</p>
<ul>
<li>first-access(s2) == C</li>
<li>last-write-access(s1) &lt; C</li>
<li>last-access(s1) &lt; data-invalidated-command(C, s2) Otherwise (cases (b) and (c), in-place propagate or backprop), we insist that:</li>
<li>first-access(s2) == C</li>
<li>last-access(s1) == C Note: in either case, these conditions imply that s2 is not an input and s1 is not an output.</li>
</ul>
<p>The sequence of things we have to do for a right-merge (in which we delete s1,m1) is as follows:</p>
<ul>
<li>All submatrices that reference m1, make them reference m2 instead. [later we'll renumber so that there are no duplicates.]</li>
<li>If m1 was an input, replace it as an input with m2 and remove the command that allocated m2.</li>
<li>If it was an assignment [case (a)], replace the assignment command with a no-op.</li>
<li>If both m1 and m2 have commands that allocate them, keep only the allocation command for m2, and make sure that it zeroes the data (we can later change to undefined if allowed) and that it's before the first non-allocation access of m1. Otherwise remove any allocation commands (the merged variable is an input).</li>
<li>If both m1 and m2 have commands that deallocate them, keep only the deallocation command for m2, and make sure that it's after the last access of m1 (otherwise delete any deallocation command, because m2 must be an output). [note: previously we kept the later of the 2 commands, but this had the effect of making inaccurate the <a class="el" href="structkaldi_1_1nnet3_1_1Analyzer.html" title="This struct exists to set up various pieces of analysis; it helps avoid the repetition of code where ...">Analyzer</a> info for a matrix (m2) that might later be used.</li>
</ul>
<p>The sequence of things we have to do for a right-merge (in which we delete s1,m1) is as follows:</p>
<ul>
<li>All submatrices that reference m2, make them reference m1 instead. [later we'll renumber so that there are no duplicates.]</li>
<li>If m2 was an output, replace it as an output with m1 and remove the command that deallocated m1. ... the last three bullet-points, regarding removing the assignment command, and allocation and deallocation, are the same as for a left-merge, except swap m1 and m2.</li>
</ul>
<p>At the end when we call RemoveOrphanMatrices(), the renumbering code will automatically detect that there are duplicate submatrices, and will merge them, as well as removing the now-unused matrix indexes. After merging, we will mark the variables (i.e. row-ranges) underlying s1 and s2 as being "dirty" so they can no longer be merged during the lifetime of this class. </p>

<p>Definition at line <a class="el" href="nnet-optimize-utils_8h_source.html#l00133">133</a> of file <a class="el" href="nnet-optimize-utils_8h_source.html">nnet-optimize-utils.h</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ae52c106fb3f904728cb5c55c6c4184e0"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html">VariableMergingOptimizer</a> </td>
          <td>(</td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> &amp;&#160;</td>
          <td class="paramname"><em>config</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;&#160;</td>
          <td class="paramname"><em>nnet</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;&#160;</td>
          <td class="paramname"><em>request</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *&#160;</td>
          <td class="paramname"><em>computation</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l00693">693</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p>References <a class="el" href="nnet-optimize-utils_8h_source.html#l00187">VariableMergingOptimizer::analyzer_</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00185">VariableMergingOptimizer::computation_</a>, <a class="el" href="nnet-analyze_8cc_source.html#l00985">kaldi::nnet3::ComputeMatrixToSubmatrix()</a>, <a class="el" href="nnet-analyze_8cc_source.html#l01233">Analyzer::Init()</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00190">VariableMergingOptimizer::matrix_to_submatrix_</a>, <a class="el" href="nnet-analyze_8h_source.html#l00155">ComputationVariables::NumVariables()</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00194">VariableMergingOptimizer::variable_dirty_</a>, and <a class="el" href="nnet-analyze_8h_source.html#l00292">Analyzer::variables</a>.</p>
<div class="fragment"><div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                                 :</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a4dcce2ef4364ac3b222debac11646a39">config_</a>(config), <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#adbabf05a7702103113a02a113015205f">nnet_</a>(nnet), <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a12563ff580f9e7179c096ed44f1e2ca7">request_</a>(request),</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>(computation),</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a400e33db7a90834eec20a7eee34f162d">already_called_merge_variables_</a>(<span class="keyword">false</span>) {</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">analyzer_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html#aab8a145e53802c80302dc498e388a2ad">Init</a>(nnet, *computation);</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a7468a5d6108f9a2f81b9b79b82866354">ComputeMatrixToSubmatrix</a>(*<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>, &amp;<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a0655730456d3a04cafe943687894a84d">matrix_to_submatrix_</a>);</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a63de82c33f6a7330727c0f2fc670ae0d">variable_dirty_</a>.resize(<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">analyzer_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html#afe662460f3e8b135d96fcd057638bd28">variables</a>.<a class="code" href="classkaldi_1_1nnet3_1_1ComputationVariables.html#afdd548073268527778f407307ca1bda3">NumVariables</a>(), <span class="keyword">false</span>);</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;}</div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a12563ff580f9e7179c096ed44f1e2ca7"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a12563ff580f9e7179c096ed44f1e2ca7">kaldi::nnet3::VariableMergingOptimizer::request_</a></div><div class="ttdeci">const ComputationRequest &amp; request_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00184">nnet-optimize-utils.h:184</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a63de82c33f6a7330727c0f2fc670ae0d"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a63de82c33f6a7330727c0f2fc670ae0d">kaldi::nnet3::VariableMergingOptimizer::variable_dirty_</a></div><div class="ttdeci">std::vector&lt; bool &gt; variable_dirty_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00194">nnet-optimize-utils.h:194</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationVariables_html_afdd548073268527778f407307ca1bda3"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationVariables.html#afdd548073268527778f407307ca1bda3">kaldi::nnet3::ComputationVariables::NumVariables</a></div><div class="ttdeci">int32 NumVariables() const </div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00155">nnet-analyze.h:155</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Analyzer_html_aab8a145e53802c80302dc498e388a2ad"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Analyzer.html#aab8a145e53802c80302dc498e388a2ad">kaldi::nnet3::Analyzer::Init</a></div><div class="ttdeci">void Init(const Nnet &amp;nnet, const NnetComputation &amp;computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l01233">nnet-analyze.cc:1233</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a4dcce2ef4364ac3b222debac11646a39"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a4dcce2ef4364ac3b222debac11646a39">kaldi::nnet3::VariableMergingOptimizer::config_</a></div><div class="ttdeci">const NnetOptimizeOptions &amp; config_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00182">nnet-optimize-utils.h:182</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a0655730456d3a04cafe943687894a84d"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a0655730456d3a04cafe943687894a84d">kaldi::nnet3::VariableMergingOptimizer::matrix_to_submatrix_</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; int32 &gt; &gt; matrix_to_submatrix_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00190">nnet-optimize-utils.h:190</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a36d13565d1302a2bf74127b141ba3537"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">kaldi::nnet3::VariableMergingOptimizer::computation_</a></div><div class="ttdeci">NnetComputation * computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00185">nnet-optimize-utils.h:185</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_ac8ca96df1ecdb635738c59a88cff8835"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">kaldi::nnet3::VariableMergingOptimizer::analyzer_</a></div><div class="ttdeci">Analyzer analyzer_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00187">nnet-optimize-utils.h:187</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::VariableMergingOptimizer::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00183">nnet-optimize-utils.h:183</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a7468a5d6108f9a2f81b9b79b82866354"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a7468a5d6108f9a2f81b9b79b82866354">kaldi::nnet3::ComputeMatrixToSubmatrix</a></div><div class="ttdeci">void ComputeMatrixToSubmatrix(const NnetComputation &amp;computation, std::vector&lt; std::vector&lt; int32 &gt; &gt; *mat_to_submat)</div><div class="ttdoc">This function computes a vector &#39;mat_to_submat&#39;, indexed by matrix index, such that (*mat_to_submat)[...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l00985">nnet-analyze.cc:985</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Analyzer_html_afe662460f3e8b135d96fcd057638bd28"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Analyzer.html#afe662460f3e8b135d96fcd057638bd28">kaldi::nnet3::Analyzer::variables</a></div><div class="ttdeci">ComputationVariables variables</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00292">nnet-analyze.h:292</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a400e33db7a90834eec20a7eee34f162d"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a400e33db7a90834eec20a7eee34f162d">kaldi::nnet3::VariableMergingOptimizer::already_called_merge_variables_</a></div><div class="ttdeci">bool already_called_merge_variables_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00196">nnet-optimize-utils.h:196</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="af3b2fad1be81ad4faf61e71f07486ef0"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void DoLeftMerge </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a>&#160;</td>
          <td class="paramname"><em>command_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a>&#160;</td>
          <td class="paramname"><em>s1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a>&#160;</td>
          <td class="paramname"><em>s2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l00900">900</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p>References <a class="el" href="nnet-optimize-utils_8h_source.html#l00187">VariableMergingOptimizer::analyzer_</a>, <a class="el" href="nnet-computation_8h_source.html#l00303">NnetComputation::commands</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00185">VariableMergingOptimizer::computation_</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00839">VariableMergingOptimizer::DoMergeCommon()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00773">kaldi::nnet3::GetSubMatrixOfSubMatrix()</a>, <a class="el" href="kaldi-error_8h_source.html#l00143">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00207">kaldi::nnet3::kNoOperation</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00791">VariableMergingOptimizer::MarkAsDirty()</a>, <a class="el" href="nnet-analyze_8h_source.html#l00295">Analyzer::matrix_accesses</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00190">VariableMergingOptimizer::matrix_to_submatrix_</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00183">VariableMergingOptimizer::nnet_</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00657">kaldi::nnet3::ReplaceInOutput()</a>, and <a class="el" href="nnet-computation_8h_source.html#l00273">NnetComputation::submatrices</a>.</p>

<p>Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l00706">VariableMergingOptimizer::MergeVariables()</a>.</p>
<div class="fragment"><div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                                                               {</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;  <span class="comment">// Prevent further optimizations touching s1 or s2 (we can</span></div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;  <span class="comment">// try again in a later round of optimization, with a new</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;  <span class="comment">// instance of this class).</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a60ce57f518b5fa77d140cb414354cd95">MarkAsDirty</a>(s1);</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a60ce57f518b5fa77d140cb414354cd95">MarkAsDirty</a>(s2);</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> m1 = <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[s1].matrix_index,</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;      m2 = <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[s2].matrix_index;</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(m1 != m2 &amp;&amp; m1 &gt; 0 &amp;&amp; m2 &gt; 0);</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;  { <span class="comment">// modify submatrices for submatrices of m2 to effectively be sub-matrices of</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;    <span class="comment">// s1 instead (they will refer to m1 as the matrix_index).</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;    std::vector&lt;int32&gt;::const_iterator iter = <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a0655730456d3a04cafe943687894a84d">matrix_to_submatrix_</a>[m2].begin(),</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        end = <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a0655730456d3a04cafe943687894a84d">matrix_to_submatrix_</a>[m2].end();</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;    <span class="keywordflow">for</span> (; iter != end; ++iter) {</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;      <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> submatrix_index = *iter;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[submatrix_index].matrix_index==m2);</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[submatrix_index] =</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;          <a class="code" href="namespacekaldi_1_1nnet3.html#a86704308a1467b6000867cc9ed198482">GetSubMatrixOfSubMatrix</a>(*<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>, submatrix_index, s1);</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;    }</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;  }</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;  <span class="keyword">const</span> std::vector&lt;MatrixAccesses&gt; &amp;matrix_accesses = <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">analyzer_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html#a1451c041c35be895025d122f136b9959">matrix_accesses</a>;</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;  <span class="comment">// - If m2 was an output, replace it as an input with m1.</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;  <span class="keywordtype">bool</span> replaced = <a class="code" href="namespacekaldi_1_1nnet3.html#a2efea0af361ac9b6981f605d7e616028">ReplaceInOutput</a>(<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#adbabf05a7702103113a02a113015205f">nnet_</a>, m2, m1, <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>);</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(replaced == matrix_accesses[m2].is_output);</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;  <span class="keywordflow">if</span> (replaced) {  <span class="comment">// Remove the command that deallocates m1.</span></div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;    <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> dealloc_command = matrix_accesses[m1].deallocate_command;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(dealloc_command != -1);</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[dealloc_command].command_type =</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;        <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a>;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;  }</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;  <span class="comment">// we keep matrix m1 (so m1 is m_to_keep, m2 is m_to_discard).</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a333f8ed19d13a9725fc630b765490020">DoMergeCommon</a>(command_index, m1, m2);</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;}</div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a333f8ed19d13a9725fc630b765490020"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a333f8ed19d13a9725fc630b765490020">kaldi::nnet3::VariableMergingOptimizer::DoMergeCommon</a></div><div class="ttdeci">void DoMergeCommon(int32 command_index, int32 m_to_keep, int32 m_to_discard)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00839">nnet-optimize-utils.cc:839</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kaldi::nnet3::kNoOperation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00207">nnet-computation.h:207</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_afeb2e3e7413a0649c8a60e3bcd66981b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">kaldi::nnet3::NnetComputation::commands</a></div><div class="ttdeci">std::vector&lt; Command &gt; commands</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00303">nnet-computation.h:303</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a86704308a1467b6000867cc9ed198482"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a86704308a1467b6000867cc9ed198482">kaldi::nnet3::GetSubMatrixOfSubMatrix</a></div><div class="ttdeci">static NnetComputation::SubMatrixInfo GetSubMatrixOfSubMatrix(const NnetComputation &amp;computation, int32 submat_a, int32 submat_b)</div><div class="ttdoc">This static function returns a SubMatrixInfo corresponding to replacing the matrix-index in a&#39;s &quot;matr...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00773">nnet-optimize-utils.cc:773</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a0655730456d3a04cafe943687894a84d"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a0655730456d3a04cafe943687894a84d">kaldi::nnet3::VariableMergingOptimizer::matrix_to_submatrix_</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; int32 &gt; &gt; matrix_to_submatrix_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00190">nnet-optimize-utils.h:190</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_acb31bf5441a137f7cbed4aeb74cb8421"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">kaldi::nnet3::NnetComputation::submatrices</a></div><div class="ttdeci">std::vector&lt; SubMatrixInfo &gt; submatrices</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00273">nnet-computation.h:273</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a36d13565d1302a2bf74127b141ba3537"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">kaldi::nnet3::VariableMergingOptimizer::computation_</a></div><div class="ttdeci">NnetComputation * computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00185">nnet-optimize-utils.h:185</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_ac8ca96df1ecdb635738c59a88cff8835"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">kaldi::nnet3::VariableMergingOptimizer::analyzer_</a></div><div class="ttdeci">Analyzer analyzer_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00187">nnet-optimize-utils.h:187</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::VariableMergingOptimizer::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00183">nnet-optimize-utils.h:183</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab7903878916593daecbeb95b98115ab0"><div class="ttname"><a href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">kaldi::int32</a></div><div class="ttdeci">int32_t int32</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00047">kaldi-types.h:47</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Analyzer_html_a1451c041c35be895025d122f136b9959"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Analyzer.html#a1451c041c35be895025d122f136b9959">kaldi::nnet3::Analyzer::matrix_accesses</a></div><div class="ttdeci">std::vector&lt; MatrixAccesses &gt; matrix_accesses</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00295">nnet-analyze.h:295</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a60ce57f518b5fa77d140cb414354cd95"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a60ce57f518b5fa77d140cb414354cd95">kaldi::nnet3::VariableMergingOptimizer::MarkAsDirty</a></div><div class="ttdeci">void MarkAsDirty(int32 s)</div><div class="ttdoc">Marks the variables underlying submatrix &#39;s&#39; as dirty. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00791">nnet-optimize-utils.cc:791</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a2efea0af361ac9b6981f605d7e616028"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2efea0af361ac9b6981f605d7e616028">kaldi::nnet3::ReplaceInOutput</a></div><div class="ttdeci">bool ReplaceInOutput(const Nnet &amp;nnet, int32 orig_matrix_index, int32 new_matrix_index, NnetComputation *computation)</div><div class="ttdoc">Wherever matrix orig_matrix_index appears in the output of the network (i.e. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00657">nnet-optimize-utils.cc:657</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a333f8ed19d13a9725fc630b765490020"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void DoMergeCommon </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a>&#160;</td>
          <td class="paramname"><em>command_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a>&#160;</td>
          <td class="paramname"><em>m_to_keep</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a>&#160;</td>
          <td class="paramname"><em>m_to_discard</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l00839">839</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p>References <a class="el" href="nnet-optimize-utils_8h_source.html#l00187">VariableMergingOptimizer::analyzer_</a>, <a class="el" href="nnet-computation_8h_source.html#l00242">NnetComputation::Command::arg1</a>, <a class="el" href="nnet-computation_8h_source.html#l00243">NnetComputation::Command::arg2</a>, <a class="el" href="nnet-computation_8h_source.html#l00241">NnetComputation::Command::command_type</a>, <a class="el" href="nnet-computation_8h_source.html#l00303">NnetComputation::commands</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00185">VariableMergingOptimizer::computation_</a>, <a class="el" href="nnet-analyze_8cc_source.html#l01035">ComputationAnalysis::FirstMatrixAccess()</a>, <a class="el" href="kaldi-error_8h_source.html#l00143">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00203">kaldi::nnet3::kAllocMatrixFromOther</a>, <a class="el" href="nnet-computation_8h_source.html#l00203">kaldi::nnet3::kAllocMatrixFromOtherZeroed</a>, <a class="el" href="nnet-computation_8h_source.html#l00202">kaldi::nnet3::kAllocMatrixUndefined</a>, <a class="el" href="nnet-computation_8h_source.html#l00202">kaldi::nnet3::kAllocMatrixZeroed</a>, <a class="el" href="nnet-computation_8h_source.html#l00205">kaldi::nnet3::kMatrixCopy</a>, <a class="el" href="nnet-computation_8h_source.html#l00207">kaldi::nnet3::kNoOperation</a>, <a class="el" href="nnet-analyze_8cc_source.html#l01055">ComputationAnalysis::LastMatrixAccess()</a>, and <a class="el" href="nnet-analyze_8h_source.html#l00295">Analyzer::matrix_accesses</a>.</p>

<p>Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l00900">VariableMergingOptimizer::DoLeftMerge()</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l00803">VariableMergingOptimizer::DoRightMerge()</a>.</p>
<div class="fragment"><div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;                                                                 {</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;  ComputationAnalysis analysis(*<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>, <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">analyzer_</a>);</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;  NnetComputation::Command &amp;c = <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[command_index];</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;  <span class="keyword">const</span> std::vector&lt;MatrixAccesses&gt; &amp;matrix_accesses =</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">analyzer_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html#a1451c041c35be895025d122f136b9959">matrix_accesses</a>;</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;  <span class="comment">//  - If it was case (a), replace the assignment command with a no-op.</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;  <span class="keywordflow">if</span> (c.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74">kMatrixCopy</a>) {</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="comment">// remove the command.</span></div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    c.command_type = <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a>;</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;    c.arg1 = -1;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    c.arg2 = -1;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;  }</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;  <span class="comment">//   - If both m_to_keep and m_to_discard have commands that deallocate them,</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;  <span class="comment">//    keep only the allocation command for m_to_keep, and make sure it&#39;s after</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;  <span class="comment">//    the last access of m_to_discard (otherwise delete any deallocation</span></div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;  <span class="comment">//    command).</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> dealloc_keep = matrix_accesses[m_to_keep].deallocate_command,</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;      dealloc_discard = matrix_accesses[m_to_discard].deallocate_command;</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;  <span class="keywordflow">if</span> (dealloc_keep != -1 &amp;&amp; dealloc_discard != -1) {</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(analysis.LastMatrixAccess(m_to_discard) &lt; dealloc_keep);</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[dealloc_discard].command_type = <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a>;</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    <span class="keywordflow">if</span> (dealloc_keep != -1)</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[dealloc_keep].command_type =</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;          <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a>;</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    <span class="keywordflow">if</span> (dealloc_discard != -1)</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[dealloc_discard].command_type =</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;          <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a>;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;  }</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;  <span class="comment">//   - If both m_to_keep and m_to_discard have commands that allocate them,</span></div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;  <span class="comment">//     keep only the allocation command for m_to_keep and make sure it&#39;s</span></div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;  <span class="comment">//     before the first access of m_to_discard.</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;  <span class="comment">//     (otherwise delete any allocation command).</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> alloc_keep = matrix_accesses[m_to_keep].allocate_command,</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;      alloc_discard = matrix_accesses[m_to_discard].allocate_command;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;  <span class="keywordflow">if</span> (alloc_keep != -1 &amp;&amp; alloc_discard != -1) {</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(analysis.FirstMatrixAccess(m_to_discard) &gt; alloc_keep);</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;    NnetComputation::Command</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;        &amp;keep_alloc_command = <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[alloc_keep],</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;        &amp;discard_alloc_command = <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[alloc_discard];</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;    discard_alloc_command.command_type = <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a>;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;    <span class="keywordflow">if</span> (keep_alloc_command.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a45d4b0c9ccaa83d0f2ab46e59f6e51be">kAllocMatrixUndefined</a>) {</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;      keep_alloc_command.command_type = <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8cf8e30f096831a33208ef1b9e22affc">kAllocMatrixZeroed</a>;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (keep_alloc_command.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ac68649c74ab0264e4db51c27d1394f6c">kAllocMatrixFromOther</a>) {</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;      keep_alloc_command.command_type = <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a2ffa126c95db5cb37f86de49ae4d66ca">kAllocMatrixFromOtherZeroed</a>;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;    }</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;    <span class="keywordflow">if</span> (alloc_keep != -1)</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[alloc_keep].command_type =</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;          <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a>;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;    <span class="keywordflow">if</span> (alloc_discard != -1)</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[alloc_discard].command_type =</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;          <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a>;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;  }</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;}</div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74">kaldi::nnet3::kMatrixCopy</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00205">nnet-computation.h:205</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kaldi::nnet3::kNoOperation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00207">nnet-computation.h:207</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a8cf8e30f096831a33208ef1b9e22affc"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8cf8e30f096831a33208ef1b9e22affc">kaldi::nnet3::kAllocMatrixZeroed</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00202">nnet-computation.h:202</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a45d4b0c9ccaa83d0f2ab46e59f6e51be"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a45d4b0c9ccaa83d0f2ab46e59f6e51be">kaldi::nnet3::kAllocMatrixUndefined</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00202">nnet-computation.h:202</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_afeb2e3e7413a0649c8a60e3bcd66981b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">kaldi::nnet3::NnetComputation::commands</a></div><div class="ttdeci">std::vector&lt; Command &gt; commands</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00303">nnet-computation.h:303</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a36d13565d1302a2bf74127b141ba3537"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">kaldi::nnet3::VariableMergingOptimizer::computation_</a></div><div class="ttdeci">NnetComputation * computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00185">nnet-optimize-utils.h:185</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_ac8ca96df1ecdb635738c59a88cff8835"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">kaldi::nnet3::VariableMergingOptimizer::analyzer_</a></div><div class="ttdeci">Analyzer analyzer_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00187">nnet-optimize-utils.h:187</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab7903878916593daecbeb95b98115ab0"><div class="ttname"><a href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">kaldi::int32</a></div><div class="ttdeci">int32_t int32</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00047">kaldi-types.h:47</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Analyzer_html_a1451c041c35be895025d122f136b9959"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Analyzer.html#a1451c041c35be895025d122f136b9959">kaldi::nnet3::Analyzer::matrix_accesses</a></div><div class="ttdeci">std::vector&lt; MatrixAccesses &gt; matrix_accesses</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00295">nnet-analyze.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a2ffa126c95db5cb37f86de49ae4d66ca"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a2ffa126c95db5cb37f86de49ae4d66ca">kaldi::nnet3::kAllocMatrixFromOtherZeroed</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00203">nnet-computation.h:203</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ac68649c74ab0264e4db51c27d1394f6c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ac68649c74ab0264e4db51c27d1394f6c">kaldi::nnet3::kAllocMatrixFromOther</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00203">nnet-computation.h:203</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab9dc158a3fd3e688df0e1df6912cd7b1"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void DoRightMerge </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a>&#160;</td>
          <td class="paramname"><em>command_index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a>&#160;</td>
          <td class="paramname"><em>s1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a>&#160;</td>
          <td class="paramname"><em>s2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l00803">803</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p>References <a class="el" href="nnet-optimize-utils_8h_source.html#l00187">VariableMergingOptimizer::analyzer_</a>, <a class="el" href="nnet-computation_8h_source.html#l00303">NnetComputation::commands</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00185">VariableMergingOptimizer::computation_</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00839">VariableMergingOptimizer::DoMergeCommon()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00773">kaldi::nnet3::GetSubMatrixOfSubMatrix()</a>, <a class="el" href="kaldi-error_8h_source.html#l00143">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00207">kaldi::nnet3::kNoOperation</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00791">VariableMergingOptimizer::MarkAsDirty()</a>, <a class="el" href="nnet-analyze_8h_source.html#l00295">Analyzer::matrix_accesses</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00190">VariableMergingOptimizer::matrix_to_submatrix_</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00183">VariableMergingOptimizer::nnet_</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00621">kaldi::nnet3::ReplaceInInput()</a>, and <a class="el" href="nnet-computation_8h_source.html#l00273">NnetComputation::submatrices</a>.</p>

<p>Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l00706">VariableMergingOptimizer::MergeVariables()</a>.</p>
<div class="fragment"><div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                                                                {</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;  <span class="comment">// Prevent further optimizations touching s1 or s2 (we can</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;  <span class="comment">// try again in a later round of optimization, with a new</span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;  <span class="comment">// instance of this class).</span></div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a60ce57f518b5fa77d140cb414354cd95">MarkAsDirty</a>(s1);</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a60ce57f518b5fa77d140cb414354cd95">MarkAsDirty</a>(s2);</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> m1 = <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[s1].matrix_index,</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;      m2 = <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[s2].matrix_index;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(m1 != m2 &amp;&amp; m1 &gt; 0 &amp;&amp; m2 &gt; 0);</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;  { <span class="comment">// modify submatrices for submatrices of m1 to effectively be sub-matrices of</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;    <span class="comment">// s2 instead (they will refer to m2 as the matrix_index).</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    std::vector&lt;int32&gt;::const_iterator iter = <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a0655730456d3a04cafe943687894a84d">matrix_to_submatrix_</a>[m1].begin(),</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        end = <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a0655730456d3a04cafe943687894a84d">matrix_to_submatrix_</a>[m1].end();</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="keywordflow">for</span> (; iter != end; ++iter) {</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;      <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> submatrix_index = *iter;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[submatrix_index].matrix_index==m1);</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[submatrix_index] =</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;          <a class="code" href="namespacekaldi_1_1nnet3.html#a86704308a1467b6000867cc9ed198482">GetSubMatrixOfSubMatrix</a>(*<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>, submatrix_index, s2);</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    }</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;  }</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;  <span class="keyword">const</span> std::vector&lt;MatrixAccesses&gt; &amp;matrix_accesses = <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">analyzer_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html#a1451c041c35be895025d122f136b9959">matrix_accesses</a>;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;  <span class="comment">// - If m1 was an input, replace it as an input with m2</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;  <span class="keywordtype">bool</span> replaced = <a class="code" href="namespacekaldi_1_1nnet3.html#a94e3ce52963d290fbf0595dea3b126c6">ReplaceInInput</a>(<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#adbabf05a7702103113a02a113015205f">nnet_</a>, m1, m2, <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>);</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(replaced == matrix_accesses[m1].is_input);</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;  <span class="keywordflow">if</span> (replaced) {  <span class="comment">// Remove the command that allocates m2.</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> alloc_command = matrix_accesses[m2].allocate_command;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(alloc_command != -1);</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[alloc_command].command_type =</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a>;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;  }</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;  <span class="comment">// we keep matrix m2 (so m2 is m_to_keep, m1 is m_to_discard).</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a333f8ed19d13a9725fc630b765490020">DoMergeCommon</a>(command_index, m2, m1);</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;}</div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a333f8ed19d13a9725fc630b765490020"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a333f8ed19d13a9725fc630b765490020">kaldi::nnet3::VariableMergingOptimizer::DoMergeCommon</a></div><div class="ttdeci">void DoMergeCommon(int32 command_index, int32 m_to_keep, int32 m_to_discard)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00839">nnet-optimize-utils.cc:839</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kaldi::nnet3::kNoOperation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00207">nnet-computation.h:207</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_afeb2e3e7413a0649c8a60e3bcd66981b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">kaldi::nnet3::NnetComputation::commands</a></div><div class="ttdeci">std::vector&lt; Command &gt; commands</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00303">nnet-computation.h:303</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a94e3ce52963d290fbf0595dea3b126c6"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a94e3ce52963d290fbf0595dea3b126c6">kaldi::nnet3::ReplaceInInput</a></div><div class="ttdeci">bool ReplaceInInput(const Nnet &amp;nnet, int32 orig_matrix_index, int32 new_matrix_index, NnetComputation *computation)</div><div class="ttdoc">Wherever matrix orig_matrix_index appears in the input of the network (i.e. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00621">nnet-optimize-utils.cc:621</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a86704308a1467b6000867cc9ed198482"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a86704308a1467b6000867cc9ed198482">kaldi::nnet3::GetSubMatrixOfSubMatrix</a></div><div class="ttdeci">static NnetComputation::SubMatrixInfo GetSubMatrixOfSubMatrix(const NnetComputation &amp;computation, int32 submat_a, int32 submat_b)</div><div class="ttdoc">This static function returns a SubMatrixInfo corresponding to replacing the matrix-index in a&#39;s &quot;matr...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00773">nnet-optimize-utils.cc:773</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a0655730456d3a04cafe943687894a84d"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a0655730456d3a04cafe943687894a84d">kaldi::nnet3::VariableMergingOptimizer::matrix_to_submatrix_</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; int32 &gt; &gt; matrix_to_submatrix_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00190">nnet-optimize-utils.h:190</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_acb31bf5441a137f7cbed4aeb74cb8421"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">kaldi::nnet3::NnetComputation::submatrices</a></div><div class="ttdeci">std::vector&lt; SubMatrixInfo &gt; submatrices</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00273">nnet-computation.h:273</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a36d13565d1302a2bf74127b141ba3537"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">kaldi::nnet3::VariableMergingOptimizer::computation_</a></div><div class="ttdeci">NnetComputation * computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00185">nnet-optimize-utils.h:185</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_ac8ca96df1ecdb635738c59a88cff8835"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">kaldi::nnet3::VariableMergingOptimizer::analyzer_</a></div><div class="ttdeci">Analyzer analyzer_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00187">nnet-optimize-utils.h:187</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::VariableMergingOptimizer::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00183">nnet-optimize-utils.h:183</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab7903878916593daecbeb95b98115ab0"><div class="ttname"><a href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">kaldi::int32</a></div><div class="ttdeci">int32_t int32</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00047">kaldi-types.h:47</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Analyzer_html_a1451c041c35be895025d122f136b9959"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Analyzer.html#a1451c041c35be895025d122f136b9959">kaldi::nnet3::Analyzer::matrix_accesses</a></div><div class="ttdeci">std::vector&lt; MatrixAccesses &gt; matrix_accesses</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00295">nnet-analyze.h:295</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a60ce57f518b5fa77d140cb414354cd95"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a60ce57f518b5fa77d140cb414354cd95">kaldi::nnet3::VariableMergingOptimizer::MarkAsDirty</a></div><div class="ttdeci">void MarkAsDirty(int32 s)</div><div class="ttdoc">Marks the variables underlying submatrix &#39;s&#39; as dirty. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00791">nnet-optimize-utils.cc:791</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a98b1050f09da390896f964fb7a892391"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Initialize </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a class="anchor" id="a60ce57f518b5fa77d140cb414354cd95"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void MarkAsDirty </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a>&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Marks the variables underlying submatrix 's' as dirty. </p>

<p>Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l00791">791</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p>References <a class="el" href="nnet-optimize-utils_8h_source.html#l00187">VariableMergingOptimizer::analyzer_</a>, <a class="el" href="nnet-analyze_8cc_source.html#l00146">ComputationVariables::AppendVariablesForSubmatrix()</a>, <a class="el" href="kaldi-error_8h_source.html#l00143">KALDI_ASSERT</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00194">VariableMergingOptimizer::variable_dirty_</a>, and <a class="el" href="nnet-analyze_8h_source.html#l00292">Analyzer::variables</a>.</p>

<p>Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l00900">VariableMergingOptimizer::DoLeftMerge()</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l00803">VariableMergingOptimizer::DoRightMerge()</a>.</p>
<div class="fragment"><div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                                                  {</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;  std::vector&lt;int32&gt; variable_indexes;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">analyzer_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html#afe662460f3e8b135d96fcd057638bd28">variables</a>.<a class="code" href="classkaldi_1_1nnet3_1_1ComputationVariables.html#a8b3beba37adf4ba0ef00c24093719537">AppendVariablesForSubmatrix</a>(s, &amp;variable_indexes);</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;  std::vector&lt;int32&gt;::const_iterator iter = variable_indexes.begin(),</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;      end = variable_indexes.end();</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;  <span class="keywordflow">for</span> (; iter != end; ++iter) {</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;    <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> v = *iter;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(static_cast&lt;size_t&gt;(v) &lt; <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a63de82c33f6a7330727c0f2fc670ae0d">variable_dirty_</a>.size());</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a63de82c33f6a7330727c0f2fc670ae0d">variable_dirty_</a>[v] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;  }</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;}</div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a63de82c33f6a7330727c0f2fc670ae0d"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a63de82c33f6a7330727c0f2fc670ae0d">kaldi::nnet3::VariableMergingOptimizer::variable_dirty_</a></div><div class="ttdeci">std::vector&lt; bool &gt; variable_dirty_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00194">nnet-optimize-utils.h:194</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationVariables_html_a8b3beba37adf4ba0ef00c24093719537"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationVariables.html#a8b3beba37adf4ba0ef00c24093719537">kaldi::nnet3::ComputationVariables::AppendVariablesForSubmatrix</a></div><div class="ttdeci">void AppendVariablesForSubmatrix(int32 submatrix_index, std::vector&lt; int32 &gt; *variable_indexes) const </div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l00146">nnet-analyze.cc:146</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_ac8ca96df1ecdb635738c59a88cff8835"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">kaldi::nnet3::VariableMergingOptimizer::analyzer_</a></div><div class="ttdeci">Analyzer analyzer_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00187">nnet-optimize-utils.h:187</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab7903878916593daecbeb95b98115ab0"><div class="ttname"><a href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">kaldi::int32</a></div><div class="ttdeci">int32_t int32</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00047">kaldi-types.h:47</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Analyzer_html_afe662460f3e8b135d96fcd057638bd28"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Analyzer.html#afe662460f3e8b135d96fcd057638bd28">kaldi::nnet3::Analyzer::variables</a></div><div class="ttdeci">ComputationVariables variables</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00292">nnet-analyze.h:292</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a18aa0d59c61851a3e1138a100488ea5b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::pair&lt; bool, bool &gt; MayBeMerged </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a>&#160;</td>
          <td class="paramname"><em>command</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a>&#160;</td>
          <td class="paramname"><em>s1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a>&#160;</td>
          <td class="paramname"><em>s2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>This function returns a pair of bools saying whether we can do a (left and/or right) merge respectively, based on the conditions defined in the header. </p>
<p>Note: if one of the variables underlying s1 or s2 is marked as 'dirty' due to a previous merge, this function will return (false,false). The terms left-merge and right-merge are defined in the extended comment above this class. Note: left_merge will always be false if config.allow_left_merge == false, and the same respectively for right_merge.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">command</td><td>[in] The command-index that assigns s2 := s1 or does a forward or backprop with s1 as the input and s2 as the output </td></tr>
    <tr><td class="paramname">s1</td><td>[in] A submatrix-index s1 &gt; 0. </td></tr>
    <tr><td class="paramname">s2</td><td>[in] A submatrix-index s2 &gt; 0 </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l00939">939</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p>References <a class="el" href="nnet-optimize_8h_source.html#l00041">NnetOptimizeOptions::allow_left_merge</a>, <a class="el" href="nnet-optimize_8h_source.html#l00042">NnetOptimizeOptions::allow_right_merge</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00187">VariableMergingOptimizer::analyzer_</a>, <a class="el" href="nnet-analyze_8cc_source.html#l00146">ComputationVariables::AppendVariablesForSubmatrix()</a>, <a class="el" href="nnet-computation_8h_source.html#l00303">NnetComputation::commands</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00185">VariableMergingOptimizer::computation_</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00182">VariableMergingOptimizer::config_</a>, <a class="el" href="nnet-analyze_8cc_source.html#l01135">ComputationAnalysis::DataInvalidatedCommand()</a>, <a class="el" href="nnet-analyze_8cc_source.html#l01001">ComputationAnalysis::FirstAccess()</a>, <a class="el" href="nnet-analyze_8h_source.html#l00264">MatrixAccesses::is_input</a>, <a class="el" href="nnet-analyze_8h_source.html#l00267">MatrixAccesses::is_output</a>, <a class="el" href="nnet-computation_8cc_source.html#l00447">NnetComputation::IsWholeMatrix()</a>, <a class="el" href="kaldi-error_8h_source.html#l00143">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00205">kaldi::nnet3::kMatrixCopy</a>, <a class="el" href="nnet-analyze_8cc_source.html#l01073">ComputationAnalysis::LastAccess()</a>, <a class="el" href="nnet-analyze_8cc_source.html#l01103">ComputationAnalysis::LastWriteAccess()</a>, <a class="el" href="nnet-analyze_8h_source.html#l00295">Analyzer::matrix_accesses</a>, <a class="el" href="nnet-computation_8h_source.html#l00273">NnetComputation::submatrices</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00194">VariableMergingOptimizer::variable_dirty_</a>, and <a class="el" href="nnet-analyze_8h_source.html#l00292">Analyzer::variables</a>.</p>

<p>Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l00706">VariableMergingOptimizer::MergeVariables()</a>.</p>
<div class="fragment"><div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;                                                   {</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(s1 &gt; 0 &amp;&amp; s2 &gt; 0 &amp;&amp; static_cast&lt;size_t&gt;(command_index) &lt;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;               <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>.size());</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a4dcce2ef4364ac3b222debac11646a39">config_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a9338247ac24f099364f25f6221981cf8">allow_left_merge</a> &amp;&amp; !<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a4dcce2ef4364ac3b222debac11646a39">config_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a2af78454a6c4008c23ec34cb8cefc376">allow_right_merge</a>)</div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;    <span class="keywordflow">return</span> std::pair&lt;bool,bool&gt;(<span class="keyword">false</span>,<span class="keyword">false</span>);</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> m1 = <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[s1].matrix_index,</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;      m2 = <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">submatrices</a>[s2].matrix_index;</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;  <span class="comment">// we can&#39;t merge two different submatrices of the same matrix.</span></div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;  <span class="keywordflow">if</span> (m1 == m2) <span class="keywordflow">return</span> std::pair&lt;bool,bool&gt;(<span class="keyword">false</span>,<span class="keyword">false</span>);</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;  std::vector&lt;int32&gt; variable_indexes;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">analyzer_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html#afe662460f3e8b135d96fcd057638bd28">variables</a>.<a class="code" href="classkaldi_1_1nnet3_1_1ComputationVariables.html#a8b3beba37adf4ba0ef00c24093719537">AppendVariablesForSubmatrix</a>(s1, &amp;variable_indexes);</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">analyzer_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html#afe662460f3e8b135d96fcd057638bd28">variables</a>.<a class="code" href="classkaldi_1_1nnet3_1_1ComputationVariables.html#a8b3beba37adf4ba0ef00c24093719537">AppendVariablesForSubmatrix</a>(s2, &amp;variable_indexes);</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;  std::vector&lt;int32&gt;::iterator iter = variable_indexes.begin(),</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;      end = variable_indexes.end();</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;  <span class="comment">// condition c5:</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;  <span class="keywordflow">for</span> (; iter != end; ++iter)</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a63de82c33f6a7330727c0f2fc670ae0d">variable_dirty_</a>[*iter])</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;      <span class="keywordflow">return</span> std::pair&lt;bool,bool&gt;(<span class="keyword">false</span>,<span class="keyword">false</span>);</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;  <span class="keyword">const</span> std::vector&lt;MatrixAccesses&gt; &amp;matrix_accesses = <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">analyzer_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html#a1451c041c35be895025d122f136b9959">matrix_accesses</a>;</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;  <span class="keyword">const</span> MatrixAccesses &amp;m1_access = matrix_accesses[m1],</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;      &amp;m2_access = matrix_accesses[m2];</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;  <span class="comment">// condition c1:</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;  <span class="keywordflow">if</span> ((m1_access.is_input &amp;&amp; m2_access.is_input) ||</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;      (m1_access.is_output &amp;&amp; m2_access.is_output))</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;    <span class="keywordflow">return</span> std::pair&lt;bool,bool&gt;(<span class="keyword">false</span>,<span class="keyword">false</span>);</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;  <span class="comment">// condition c2:</span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;  <span class="keywordflow">if</span> ((m1_access.is_input || m1_access.is_output ||</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;       m2_access.is_input || m2_access.is_output) &amp;&amp;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;      (!<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a5e1da849f06187ae85eff2466e606c7d">IsWholeMatrix</a>(s1) ||</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;       !<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a5e1da849f06187ae85eff2466e606c7d">IsWholeMatrix</a>(s2)))</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;    <span class="keywordflow">return</span> std::pair&lt;bool,bool&gt;(<span class="keyword">false</span>,<span class="keyword">false</span>);</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;  <span class="keywordtype">bool</span> left = <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a4dcce2ef4364ac3b222debac11646a39">config_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a9338247ac24f099364f25f6221981cf8">allow_left_merge</a>,</div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;      right = <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a4dcce2ef4364ac3b222debac11646a39">config_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a2af78454a6c4008c23ec34cb8cefc376">allow_right_merge</a>;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;  <span class="comment">// condition c3:</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a5e1da849f06187ae85eff2466e606c7d">IsWholeMatrix</a>(s2)) left = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a5e1da849f06187ae85eff2466e606c7d">IsWholeMatrix</a>(s1)) right = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;  <span class="keywordflow">if</span> (!left &amp;&amp; !right)  <span class="comment">// save some time.</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;    <span class="keywordflow">return</span> std::pair&lt;bool,bool&gt;(<span class="keyword">false</span>,<span class="keyword">false</span>);</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;  <span class="keywordtype">bool</span> is_assignment = (<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[command_index].command_type ==</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;                        <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74">kMatrixCopy</a>);</div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;  ComputationAnalysis analysis(*<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>, <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">analyzer_</a>);</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;  <span class="keywordflow">if</span> (is_assignment) {</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;    <span class="keywordflow">if</span> (analysis.FirstAccess(s2) == command_index &amp;&amp;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;        analysis.LastWriteAccess(s1) &lt; command_index &amp;&amp;</div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        analysis.LastAccess(s1) &lt;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;        analysis.DataInvalidatedCommand(command_index, s2)) {</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;      <span class="keywordflow">return</span> std::pair&lt;bool,bool&gt;(left, right);  <span class="comment">// possible success.</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;    }</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;    <span class="keywordflow">if</span> (analysis.FirstAccess(s2) == command_index &amp;&amp;</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;        analysis.LastAccess(s1) == command_index) {</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;      <span class="keywordflow">return</span> std::pair&lt;bool,bool&gt;(left, right);  <span class="comment">// possible success.</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;    }</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;  }</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;  <span class="comment">// failure.</span></div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;  <span class="keywordflow">return</span> std::pair&lt;bool,bool&gt;(<span class="keyword">false</span>,<span class="keyword">false</span>);</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;}</div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74">kaldi::nnet3::kMatrixCopy</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00205">nnet-computation.h:205</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_a2af78454a6c4008c23ec34cb8cefc376"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a2af78454a6c4008c23ec34cb8cefc376">kaldi::nnet3::NnetOptimizeOptions::allow_right_merge</a></div><div class="ttdeci">bool allow_right_merge</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00042">nnet-optimize.h:42</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a63de82c33f6a7330727c0f2fc670ae0d"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a63de82c33f6a7330727c0f2fc670ae0d">kaldi::nnet3::VariableMergingOptimizer::variable_dirty_</a></div><div class="ttdeci">std::vector&lt; bool &gt; variable_dirty_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00194">nnet-optimize-utils.h:194</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationVariables_html_a8b3beba37adf4ba0ef00c24093719537"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationVariables.html#a8b3beba37adf4ba0ef00c24093719537">kaldi::nnet3::ComputationVariables::AppendVariablesForSubmatrix</a></div><div class="ttdeci">void AppendVariablesForSubmatrix(int32 submatrix_index, std::vector&lt; int32 &gt; *variable_indexes) const </div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l00146">nnet-analyze.cc:146</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_afeb2e3e7413a0649c8a60e3bcd66981b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">kaldi::nnet3::NnetComputation::commands</a></div><div class="ttdeci">std::vector&lt; Command &gt; commands</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00303">nnet-computation.h:303</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_a5e1da849f06187ae85eff2466e606c7d"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#a5e1da849f06187ae85eff2466e606c7d">kaldi::nnet3::NnetComputation::IsWholeMatrix</a></div><div class="ttdeci">bool IsWholeMatrix(int32 submatrix_index) const </div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8cc_source.html#l00447">nnet-computation.cc:447</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a4dcce2ef4364ac3b222debac11646a39"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a4dcce2ef4364ac3b222debac11646a39">kaldi::nnet3::VariableMergingOptimizer::config_</a></div><div class="ttdeci">const NnetOptimizeOptions &amp; config_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00182">nnet-optimize-utils.h:182</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_acb31bf5441a137f7cbed4aeb74cb8421"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#acb31bf5441a137f7cbed4aeb74cb8421">kaldi::nnet3::NnetComputation::submatrices</a></div><div class="ttdeci">std::vector&lt; SubMatrixInfo &gt; submatrices</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00273">nnet-computation.h:273</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a36d13565d1302a2bf74127b141ba3537"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">kaldi::nnet3::VariableMergingOptimizer::computation_</a></div><div class="ttdeci">NnetComputation * computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00185">nnet-optimize-utils.h:185</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_ac8ca96df1ecdb635738c59a88cff8835"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ac8ca96df1ecdb635738c59a88cff8835">kaldi::nnet3::VariableMergingOptimizer::analyzer_</a></div><div class="ttdeci">Analyzer analyzer_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00187">nnet-optimize-utils.h:187</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab7903878916593daecbeb95b98115ab0"><div class="ttname"><a href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">kaldi::int32</a></div><div class="ttdeci">int32_t int32</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00047">kaldi-types.h:47</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Analyzer_html_a1451c041c35be895025d122f136b9959"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Analyzer.html#a1451c041c35be895025d122f136b9959">kaldi::nnet3::Analyzer::matrix_accesses</a></div><div class="ttdeci">std::vector&lt; MatrixAccesses &gt; matrix_accesses</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00295">nnet-analyze.h:295</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_a9338247ac24f099364f25f6221981cf8"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a9338247ac24f099364f25f6221981cf8">kaldi::nnet3::NnetOptimizeOptions::allow_left_merge</a></div><div class="ttdeci">bool allow_left_merge</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00041">nnet-optimize.h:41</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Analyzer_html_afe662460f3e8b135d96fcd057638bd28"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Analyzer.html#afe662460f3e8b135d96fcd057638bd28">kaldi::nnet3::Analyzer::variables</a></div><div class="ttdeci">ComputationVariables variables</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00292">nnet-analyze.h:292</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a08a57d03b1828eeb8548ee5e8a942264"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool MergeVariables </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="nnet-optimize-utils_8cc_source.html#l00706">706</a> of file <a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a>.</p>

<p>References <a class="el" href="nnet-optimize-utils_8h_source.html#l00196">VariableMergingOptimizer::already_called_merge_variables_</a>, <a class="el" href="nnet-computation_8h_source.html#l00242">NnetComputation::Command::arg1</a>, <a class="el" href="nnet-computation_8h_source.html#l00243">NnetComputation::Command::arg2</a>, <a class="el" href="nnet-computation_8h_source.html#l00244">NnetComputation::Command::arg3</a>, <a class="el" href="nnet-computation_8h_source.html#l00245">NnetComputation::Command::arg4</a>, <a class="el" href="nnet-computation_8h_source.html#l00246">NnetComputation::Command::arg5</a>, <a class="el" href="nnet-computation_8h_source.html#l00247">NnetComputation::Command::arg6</a>, <a class="el" href="nnet-optimize_8h_source.html#l00038">NnetOptimizeOptions::backprop_in_place</a>, <a class="el" href="nnet-computation_8h_source.html#l00241">NnetComputation::Command::command_type</a>, <a class="el" href="nnet-computation_8h_source.html#l00303">NnetComputation::commands</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00185">VariableMergingOptimizer::computation_</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00182">VariableMergingOptimizer::config_</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00900">VariableMergingOptimizer::DoLeftMerge()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00803">VariableMergingOptimizer::DoRightMerge()</a>, <a class="el" href="_2nnet-nnet_8cc_source.html#l00137">Nnet::GetComponent()</a>, <a class="el" href="kaldi-error_8h_source.html#l00143">KALDI_ASSERT</a>, <a class="el" href="nnet-computation_8h_source.html#l00204">kaldi::nnet3::kBackprop</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00075">kaldi::nnet3::kBackpropInPlace</a>, <a class="el" href="nnet-computation_8h_source.html#l00204">kaldi::nnet3::kBackpropNoModelUpdate</a>, <a class="el" href="nnet-computation_8h_source.html#l00205">kaldi::nnet3::kMatrixCopy</a>, <a class="el" href="nnet-computation_8h_source.html#l00204">kaldi::nnet3::kPropagate</a>, <a class="el" href="nnet-component-itf_8h_source.html#l00056">kaldi::nnet3::kPropagateInPlace</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00939">VariableMergingOptimizer::MayBeMerged()</a>, <a class="el" href="nnet-optimize-utils_8h_source.html#l00183">VariableMergingOptimizer::nnet_</a>, <a class="el" href="nnet-optimize_8h_source.html#l00035">NnetOptimizeOptions::optimize</a>, <a class="el" href="nnet-optimize_8h_source.html#l00037">NnetOptimizeOptions::propagate_in_place</a>, <a class="el" href="classkaldi_1_1nnet3_1_1Component.html#a3a4ff15fafe0c8c4885586fc2c36ca8a">Component::Properties()</a>, <a class="el" href="nnet-optimize_8h_source.html#l00040">NnetOptimizeOptions::remove_assignments</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00604">kaldi::nnet3::RemoveNoOps()</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l00599">kaldi::nnet3::RenumberComputation()</a>.</p>

<p>Referenced by <a class="el" href="nnet-optimize_8cc_source.html#l00251">kaldi::nnet3::VariableMergingOptimization()</a>.</p>
<div class="fragment"><div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                                              {</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a400e33db7a90834eec20a7eee34f162d">already_called_merge_variables_</a>);</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a400e33db7a90834eec20a7eee34f162d">already_called_merge_variables_</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;  <span class="keywordflow">if</span> (!<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a4dcce2ef4364ac3b222debac11646a39">config_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#ada3212723faff5ad5d718401c2b14abd">optimize</a>)</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;  <span class="keywordtype">bool</span> merged = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> num_commands = <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>.size();</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> command_index = 0; command_index &lt; num_commands;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;       command_index++) {</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    <span class="comment">// This loop looks for pairs of sub-matrix indexes s1,s2 that we could</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;    <span class="comment">// potentially merge into a single variable.</span></div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;    <span class="keyword">const</span> NnetComputation::Command &amp;c =</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;        <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[command_index];</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;    <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> s1 = -1, s2 = -1;</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <span class="keywordflow">if</span> (c.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74">kMatrixCopy</a> &amp;&amp;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a4dcce2ef4364ac3b222debac11646a39">config_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a5a9cf0a0e6fa879ef136d18e4b3a7493">remove_assignments</a>) {</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;      s2 = c.arg1;  <span class="comment">// s2 is the written-to matrix.</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;      s1 = c.arg2;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69">kPropagate</a> &amp;&amp;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;               <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a4dcce2ef4364ac3b222debac11646a39">config_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a8de177378a5c3ef537b9d5927012427d">propagate_in_place</a>) {</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;      <span class="keyword">const</span> Component *component = <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#aec8d6dfed3e4ab080d3ff4cf6a1126e3">GetComponent</a>(c.arg1);</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;      <span class="keywordflow">if</span> (component-&gt;Properties() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2f52823d0c7fdc03b0be47662c66146d">kPropagateInPlace</a>) {</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;        s1 = c.arg3;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        s2 = c.arg4;  <span class="comment">// s2 is the written-to matrix.</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;      }</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((c.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83">kBackprop</a> ||</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;                c.command_type == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352afab6637ac4a83d6775366b4e9c42e241">kBackpropNoModelUpdate</a>) &amp;&amp;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;               <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a4dcce2ef4364ac3b222debac11646a39">config_</a>.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a751610db82b663a3b2b415a839b0cad4">backprop_in_place</a>) {</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;      <span class="keyword">const</span> Component *component = <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#adbabf05a7702103113a02a113015205f">nnet_</a>.<a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html#aec8d6dfed3e4ab080d3ff4cf6a1126e3">GetComponent</a>(c.arg1);</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;      <span class="keywordflow">if</span> (component-&gt;Properties() &amp; <a class="code" href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3abaa0f1d8521d4753ffae9f2cc22a15df">kBackpropInPlace</a>) {</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        s1 = c.arg5;</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        s2 = c.arg6;  <span class="comment">// s2 is the written-to matrix.</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        <span class="keywordflow">if</span> (s1 == c.arg3 || s2 == c.arg3 || s1 == c.arg4 || s2 == c.arg4) {</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;          <span class="comment">// we don&#39;t think this should ever happen, but just out of an</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;          <span class="comment">// abundance of caution: if either of these submatrix indexes are the</span></div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;          <span class="comment">// input-value or output-value args to Backprop, don&#39;t do the optimization.</span></div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;          s1 = -1;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;          s2 = -1;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        }</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;      }</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    }</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    <span class="keywordflow">if</span> (s1 &gt; 0 &amp;&amp; s2 &gt; 0) {</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;      std::pair&lt;bool,bool&gt; p = <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a18aa0d59c61851a3e1138a100488ea5b">MayBeMerged</a>(command_index, s1, s2);</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;      <span class="keywordflow">if</span> (p.first) {</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#af3b2fad1be81ad4faf61e71f07486ef0">DoLeftMerge</a>(command_index, s1, s2);</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        merged = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;      } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (p.second) {</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;        <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ab9dc158a3fd3e688df0e1df6912cd7b1">DoRightMerge</a>(command_index, s1, s2);</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        merged = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;      }</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;    }</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;  }</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;  <span class="keywordflow">if</span> (merged) {</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a6828e427bd8883455705e0c9b99b5f2f">RenumberComputation</a>(<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>);</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a1146f4efa141a56210f9dbf1090b20f0">RemoveNoOps</a>(<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">computation_</a>);</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;  }</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;  <span class="keywordflow">return</span> merged;</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;}</div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74">kaldi::nnet3::kMatrixCopy</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00205">nnet-computation.h:205</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a6828e427bd8883455705e0c9b99b5f2f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a6828e427bd8883455705e0c9b99b5f2f">kaldi::nnet3::RenumberComputation</a></div><div class="ttdeci">void RenumberComputation(NnetComputation *computation)</div><div class="ttdoc">This function detects submatrices, matrices, and members of indexes_multi and indexes that are never ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00599">nnet-optimize-utils.cc:599</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_a5a9cf0a0e6fa879ef136d18e4b3a7493"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a5a9cf0a0e6fa879ef136d18e4b3a7493">kaldi::nnet3::NnetOptimizeOptions::remove_assignments</a></div><div class="ttdeci">bool remove_assignments</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00040">nnet-optimize.h:40</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_af3b2fad1be81ad4faf61e71f07486ef0"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#af3b2fad1be81ad4faf61e71f07486ef0">kaldi::nnet3::VariableMergingOptimizer::DoLeftMerge</a></div><div class="ttdeci">void DoLeftMerge(int32 command_index, int32 s1, int32 s2)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00900">nnet-optimize-utils.cc:900</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_afeb2e3e7413a0649c8a60e3bcd66981b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">kaldi::nnet3::NnetComputation::commands</a></div><div class="ttdeci">std::vector&lt; Command &gt; commands</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00303">nnet-computation.h:303</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_ab9dc158a3fd3e688df0e1df6912cd7b1"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#ab9dc158a3fd3e688df0e1df6912cd7b1">kaldi::nnet3::VariableMergingOptimizer::DoRightMerge</a></div><div class="ttdeci">void DoRightMerge(int32 command_index, int32 s1, int32 s2)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00803">nnet-optimize-utils.cc:803</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_ada3212723faff5ad5d718401c2b14abd"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#ada3212723faff5ad5d718401c2b14abd">kaldi::nnet3::NnetOptimizeOptions::optimize</a></div><div class="ttdeci">bool optimize</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00035">nnet-optimize.h:35</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3a2f52823d0c7fdc03b0be47662c66146d"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3a2f52823d0c7fdc03b0be47662c66146d">kaldi::nnet3::kPropagateInPlace</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00056">nnet-component-itf.h:56</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a4dcce2ef4364ac3b222debac11646a39"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a4dcce2ef4364ac3b222debac11646a39">kaldi::nnet3::VariableMergingOptimizer::config_</a></div><div class="ttdeci">const NnetOptimizeOptions &amp; config_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00182">nnet-optimize-utils.h:182</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_a8de177378a5c3ef537b9d5927012427d"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a8de177378a5c3ef537b9d5927012427d">kaldi::nnet3::NnetOptimizeOptions::propagate_in_place</a></div><div class="ttdeci">bool propagate_in_place</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00037">nnet-optimize.h:37</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a36d13565d1302a2bf74127b141ba3537"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a36d13565d1302a2bf74127b141ba3537">kaldi::nnet3::VariableMergingOptimizer::computation_</a></div><div class="ttdeci">NnetComputation * computation_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00185">nnet-optimize-utils.h:185</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::VariableMergingOptimizer::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00183">nnet-optimize-utils.h:183</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352afab6637ac4a83d6775366b4e9c42e241"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352afab6637ac4a83d6775366b4e9c42e241">kaldi::nnet3::kBackpropNoModelUpdate</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00204">nnet-computation.h:204</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab7903878916593daecbeb95b98115ab0"><div class="ttname"><a href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">kaldi::int32</a></div><div class="ttdeci">int32_t int32</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00047">kaldi-types.h:47</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a36da016976f88292c0d31653a20cbfe3abaa0f1d8521d4753ffae9f2cc22a15df"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a36da016976f88292c0d31653a20cbfe3abaa0f1d8521d4753ffae9f2cc22a15df">kaldi::nnet3::kBackpropInPlace</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-component-itf_8h_source.html#l00075">nnet-component-itf.h:75</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html_aec8d6dfed3e4ab080d3ff4cf6a1126e3"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html#aec8d6dfed3e4ab080d3ff4cf6a1126e3">kaldi::nnet3::Nnet::GetComponent</a></div><div class="ttdeci">Component * GetComponent(int32 c)</div><div class="ttdoc">return component indexed c. not a copy; not owned by caller. </div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8cc_source.html#l00137">nnet-nnet.cc:137</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a7832c022dde05525759677b75b362b83">kaldi::nnet3::kBackprop</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00204">nnet-computation.h:204</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a1146f4efa141a56210f9dbf1090b20f0"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a1146f4efa141a56210f9dbf1090b20f0">kaldi::nnet3::RemoveNoOps</a></div><div class="ttdeci">void RemoveNoOps(NnetComputation *computation)</div><div class="ttdoc">Removes commands of type kNoOperation in the computation. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00604">nnet-optimize-utils.cc:604</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_a751610db82b663a3b2b415a839b0cad4"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a751610db82b663a3b2b415a839b0cad4">kaldi::nnet3::NnetOptimizeOptions::backprop_in_place</a></div><div class="ttdeci">bool backprop_in_place</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00038">nnet-optimize.h:38</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26ebe2a579bf27a5453cb7b489ad6f69">kaldi::nnet3::kPropagate</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00204">nnet-computation.h:204</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a400e33db7a90834eec20a7eee34f162d"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a400e33db7a90834eec20a7eee34f162d">kaldi::nnet3::VariableMergingOptimizer::already_called_merge_variables_</a></div><div class="ttdeci">bool already_called_merge_variables_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00196">nnet-optimize-utils.h:196</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a18aa0d59c61851a3e1138a100488ea5b"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a18aa0d59c61851a3e1138a100488ea5b">kaldi::nnet3::VariableMergingOptimizer::MayBeMerged</a></div><div class="ttdeci">std::pair&lt; bool, bool &gt; MayBeMerged(int32 command, int32 s1, int32 s2) const </div><div class="ttdoc">This function returns a pair of bools saying whether we can do a (left and/or right) merge respective...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00939">nnet-optimize-utils.cc:939</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a400e33db7a90834eec20a7eee34f162d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool already_called_merge_variables_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="nnet-optimize-utils_8h_source.html#l00196">196</a> of file <a class="el" href="nnet-optimize-utils_8h_source.html">nnet-optimize-utils.h</a>.</p>

<p>Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l00706">VariableMergingOptimizer::MergeVariables()</a>.</p>

</div>
</div>
<a class="anchor" id="ac8ca96df1ecdb635738c59a88cff8835"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structkaldi_1_1nnet3_1_1Analyzer.html">Analyzer</a> analyzer_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="nnet-optimize-utils_8h_source.html#l00187">187</a> of file <a class="el" href="nnet-optimize-utils_8h_source.html">nnet-optimize-utils.h</a>.</p>

<p>Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l00900">VariableMergingOptimizer::DoLeftMerge()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00839">VariableMergingOptimizer::DoMergeCommon()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00803">VariableMergingOptimizer::DoRightMerge()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00791">VariableMergingOptimizer::MarkAsDirty()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00939">VariableMergingOptimizer::MayBeMerged()</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l00693">VariableMergingOptimizer::VariableMergingOptimizer()</a>.</p>

</div>
</div>
<a class="anchor" id="a36d13565d1302a2bf74127b141ba3537"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a>* computation_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="nnet-optimize-utils_8h_source.html#l00185">185</a> of file <a class="el" href="nnet-optimize-utils_8h_source.html">nnet-optimize-utils.h</a>.</p>

<p>Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l00900">VariableMergingOptimizer::DoLeftMerge()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00839">VariableMergingOptimizer::DoMergeCommon()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00803">VariableMergingOptimizer::DoRightMerge()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00939">VariableMergingOptimizer::MayBeMerged()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00706">VariableMergingOptimizer::MergeVariables()</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l00693">VariableMergingOptimizer::VariableMergingOptimizer()</a>.</p>

</div>
</div>
<a class="anchor" id="a4dcce2ef4364ac3b222debac11646a39"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a>&amp; config_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="nnet-optimize-utils_8h_source.html#l00182">182</a> of file <a class="el" href="nnet-optimize-utils_8h_source.html">nnet-optimize-utils.h</a>.</p>

<p>Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l00939">VariableMergingOptimizer::MayBeMerged()</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l00706">VariableMergingOptimizer::MergeVariables()</a>.</p>

</div>
</div>
<a class="anchor" id="a0655730456d3a04cafe943687894a84d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;std::vector&lt;<a class="el" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a>&gt; &gt; matrix_to_submatrix_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="nnet-optimize-utils_8h_source.html#l00190">190</a> of file <a class="el" href="nnet-optimize-utils_8h_source.html">nnet-optimize-utils.h</a>.</p>

<p>Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l00900">VariableMergingOptimizer::DoLeftMerge()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00803">VariableMergingOptimizer::DoRightMerge()</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l00693">VariableMergingOptimizer::VariableMergingOptimizer()</a>.</p>

</div>
</div>
<a class="anchor" id="adbabf05a7702103113a02a113015205f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a>&amp; nnet_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="nnet-optimize-utils_8h_source.html#l00183">183</a> of file <a class="el" href="nnet-optimize-utils_8h_source.html">nnet-optimize-utils.h</a>.</p>

<p>Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l00900">VariableMergingOptimizer::DoLeftMerge()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00803">VariableMergingOptimizer::DoRightMerge()</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l00706">VariableMergingOptimizer::MergeVariables()</a>.</p>

</div>
</div>
<a class="anchor" id="a12563ff580f9e7179c096ed44f1e2ca7"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const <a class="el" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a>&amp; request_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="nnet-optimize-utils_8h_source.html#l00184">184</a> of file <a class="el" href="nnet-optimize-utils_8h_source.html">nnet-optimize-utils.h</a>.</p>

</div>
</div>
<a class="anchor" id="a63de82c33f6a7330727c0f2fc670ae0d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">std::vector&lt;bool&gt; variable_dirty_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Definition at line <a class="el" href="nnet-optimize-utils_8h_source.html#l00194">194</a> of file <a class="el" href="nnet-optimize-utils_8h_source.html">nnet-optimize-utils.h</a>.</p>

<p>Referenced by <a class="el" href="nnet-optimize-utils_8cc_source.html#l00791">VariableMergingOptimizer::MarkAsDirty()</a>, <a class="el" href="nnet-optimize-utils_8cc_source.html#l00939">VariableMergingOptimizer::MayBeMerged()</a>, and <a class="el" href="nnet-optimize-utils_8cc_source.html#l00693">VariableMergingOptimizer::VariableMergingOptimizer()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li>nnet3/<a class="el" href="nnet-optimize-utils_8h_source.html">nnet-optimize-utils.h</a></li>
<li>nnet3/<a class="el" href="nnet-optimize-utils_8cc_source.html">nnet-optimize-utils.cc</a></li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="namespacekaldi.html">kaldi</a></li><li class="navelem"><a class="el" href="namespacekaldi_1_1nnet3.html">nnet3</a></li><li class="navelem"><a class="el" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html">VariableMergingOptimizer</a></li>
    <li class="footer">Generated on Thu Apr 28 2016 15:42:48 for Kaldi by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
