<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kaldi: nnet3/nnet-optimize.cc Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <td id="projectlogo"><a href="http://kaldi-asr.org/"><img alt="Logo" src="KaldiTextAndLogoSmall.png"/ style="padding: 3px 5px 1px 5px"></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">Kaldi
   </div>
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief" style="display:none"></div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('nnet-optimize_8cc_source.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">nnet-optimize.cc</div>  </div>
</div><!--header-->
<div class="contents">
<a href="nnet-optimize_8cc.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// nnet3/nnet-optimize.cc</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Copyright      2015  Johns Hopkins University (author: Daniel Povey)</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// See ../../COPYING for clarification regarding multiple authors</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// you may not use this file except in compliance with the License.</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// You may obtain a copy of the License at</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">//  http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// THIS CODE IS PROVIDED *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="comment">// KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="comment">// WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="comment">// MERCHANTABLITY OR NON-INFRINGEMENT.</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="comment">// See the Apache 2 License for the specific language governing permissions and</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="comment">// limitations under the License.</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="nnet-optimize_8h.html">nnet3/nnet-optimize.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="nnet-optimize-utils_8h.html">nnet3/nnet-optimize-utils.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keyword">namespace </span>kaldi {</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keyword">namespace </span>nnet3 {</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment">// move commands that resize matrices to as late/early as possible.</span></div>
<div class="line"><a name="l00028"></a><span class="lineno"><a class="line" href="namespacekaldi_1_1nnet3.html#a20e1e086f75487fe19752fd2b34ca627">   28</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a20e1e086f75487fe19752fd2b34ca627">MoveSizingCommands</a>(<span class="keyword">const</span> <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet, <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) {</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationVariables.html">ComputationVariables</a> variables;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;  variables.<a class="code" href="classkaldi_1_1nnet3_1_1ComputationVariables.html#ae7def2293754ae347d6b9fe0cec63df0">Init</a>(*computation);</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  std::vector&lt;CommandAttributes&gt; attributes;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#aa02a576b6e9aa0977f3eb52471742b85">ComputeCommandAttributes</a>(nnet, *computation, variables, &amp;attributes);</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  std::vector&lt;std::vector&lt;Access&gt; &gt; variable_accesses;</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a474b6a19fd42f428dd178f9af05150a8">ComputeVariableAccesses</a>(variables, attributes, &amp;variable_accesses);</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;  std::vector&lt;MatrixAccesses&gt; matrix_accesses;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a2f107eabc73f1b70436ed117375778c1">ComputeMatrixAccesses</a>(nnet, *computation, variables, attributes,</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;                        &amp;matrix_accesses);</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;  <span class="comment">// The way we will renumber the commands is, we will first set this vector up</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  <span class="comment">// with pairs (command-index * 3, pointer-to-command), and we will then modify</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  <span class="comment">// the command-indexes in this vector to the numbers that we want, and sort</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  <span class="comment">// it.  The reason for the * 3 is so that we can number commands &quot;just-after&quot;</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  <span class="comment">// existing indexes (by adding 1) and &quot;just-before&quot; (by subtracting 1).</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> num_commands = computation-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>.size(),</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;      num_matrices = matrix_accesses.size();</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  std::vector&lt;std::pair&lt;int32,NnetComputation::Command*&gt; &gt;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;      commands(num_commands);</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> c = 0; c &lt; num_commands; c++) {</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    commands[c].first = c * 3;</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    commands[c].second = &amp;(computation-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[c]);</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  }</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> m = 1; m &lt; num_matrices; m++) {</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;    <span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html">MatrixAccesses</a> &amp;ma = matrix_accesses[m];</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    <span class="keywordflow">if</span> (ma.<a class="code" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html#a6a26bfae0a795d6987c7db2476fdda1a">allocate_command</a> != -1) {</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;      <span class="comment">// first_access_command will be index of first non-initializing access.</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;      <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> first_access_command = -1;</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;      <span class="keywordflow">if</span> (!ma.<a class="code" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html#a36b3030ce98db1e72110930473d8b93e">accesses</a>.empty()) {</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;        first_access_command = ma.<a class="code" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html#a36b3030ce98db1e72110930473d8b93e">accesses</a>[0].command_index;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="keywordflow">if</span> (first_access_command == ma.<a class="code" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html#a6a26bfae0a795d6987c7db2476fdda1a">allocate_command</a>) {</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;          <span class="keywordflow">if</span> (ma.<a class="code" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html#a36b3030ce98db1e72110930473d8b93e">accesses</a>.size() &gt; 1)</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;            first_access_command = ma.<a class="code" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html#a36b3030ce98db1e72110930473d8b93e">accesses</a>[1].command_index;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;          <span class="keywordflow">else</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            first_access_command = -1;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;        }</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;      }</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;      <span class="keywordflow">if</span> (first_access_command != -1) {</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(first_access_command &gt; ma.<a class="code" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html#a6a26bfae0a795d6987c7db2476fdda1a">allocate_command</a>);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;        <span class="comment">// move the initialization command to just before the first access.</span></div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        commands[ma.<a class="code" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html#a6a26bfae0a795d6987c7db2476fdda1a">allocate_command</a>].first = first_access_command * 3 - 1;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;      }</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;    }</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keywordflow">if</span> (ma.<a class="code" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html#a7ca773444a9de6d9f8c01f693ec4ab16">deallocate_command</a> != -1) {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;      <span class="keywordflow">if</span> (!ma.<a class="code" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html#a36b3030ce98db1e72110930473d8b93e">accesses</a>.empty()) {</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> last_access_command = ma.<a class="code" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html#a36b3030ce98db1e72110930473d8b93e">accesses</a>.back().command_index;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="comment">// move the destruction command to just after the last access.</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        commands[ma.<a class="code" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html#a7ca773444a9de6d9f8c01f693ec4ab16">deallocate_command</a>].first = last_access_command * 3 + 1;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;      }</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    }</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;  }</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;  std::sort(commands.begin(), commands.end());</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;  std::vector&lt;NnetComputation::Command&gt; reordered_commands(num_commands);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> c = 0; c &lt; num_commands; c++)</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;    reordered_commands[c] = *(commands[c].second);</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;  computation-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a> = reordered_commands;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;}</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">// This command replaces commands of type kAllocMatrixZeroed with commands of</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">// type kAllocMatrixUndefined, where possible.</span></div>
<div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="namespacekaldi_1_1nnet3.html#aae053839b5ed781f2f7408489a1528dd">   90</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#aae053839b5ed781f2f7408489a1528dd">RemoveUnnecessaryZeroing</a>(<span class="keyword">const</span> <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet,</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                              <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) {</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;  <a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html">Analyzer</a> a;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;  a.<a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html#aab8a145e53802c80302dc498e388a2ad">Init</a>(nnet, *computation);</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;  <span class="comment">// OK, now we&#39;ll work out which matrices have all their pieces (i.e. all the</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;  <span class="comment">// variables belonging to that matrix) written to as the first instruction</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;  <span class="comment">// apart from the initial zeroing.  These matrices can have the initial</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;  <span class="comment">// zeroing replaced by a sizing operation that leaves the data undefined.</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> num_matrices = a.<a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html#a1451c041c35be895025d122f136b9959">matrix_accesses</a>.size();</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> matrix_index = 0; matrix_index &lt; num_matrices; matrix_index++) {</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    <span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html">MatrixAccesses</a> &amp;accesses = a.<a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html#a1451c041c35be895025d122f136b9959">matrix_accesses</a>[matrix_index];</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> allocate_command = accesses.<a class="code" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html#a6a26bfae0a795d6987c7db2476fdda1a">allocate_command</a>;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    <span class="keywordflow">if</span> (allocate_command == -1)  <span class="comment">// an input</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;      <span class="keywordflow">continue</span>;  <span class="comment">// nothing to do.</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">if</span> (computation-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[allocate_command].command_type !=</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;        <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8cf8e30f096831a33208ef1b9e22affc">kAllocMatrixZeroed</a>) {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(computation-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[allocate_command].command_type ==</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                   <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a45d4b0c9ccaa83d0f2ab46e59f6e51be">kAllocMatrixUndefined</a>);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;      <span class="keywordflow">continue</span>;  <span class="comment">// already leaving it undefined, so nothing to do.</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;    }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    std::vector&lt;int32&gt; variables_for_matrix;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    a.<a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html#afe662460f3e8b135d96fcd057638bd28">variables</a>.<a class="code" href="classkaldi_1_1nnet3_1_1ComputationVariables.html#abf8ca3ace52f6544f8931b862944d998">AppendVariablesForMatrix</a>(matrix_index, &amp;variables_for_matrix);</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;    <span class="keywordtype">bool</span> all_variables_ok = <span class="keyword">true</span>;  <span class="comment">// if this stays true, it means we don&#39;t need</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                                   <span class="comment">// the initial zeroing.</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; variables_for_matrix.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;      <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> variable_index = variables_for_matrix[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>];</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;      <span class="keyword">const</span> std::vector&lt;Access&gt; &amp;v_accesses =</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;          a.<a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html#a3b73c505d462ed9086dc5fc3735202a7">variable_accesses</a>[variable_index];</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;      <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(v_accesses.size() &gt; 0 &amp;&amp;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                   v_accesses[0].command_index == allocate_command &amp;&amp;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                   v_accesses[0].access_type == <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f">kWriteAccess</a>);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;      <span class="keywordflow">if</span> (v_accesses.size() &gt; 1 &amp;&amp;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;          v_accesses[1].access_type != <a class="code" href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f">kWriteAccess</a>) {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;        all_variables_ok = <span class="keyword">false</span>;  <span class="comment">// first access after zeroing was not a write</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;      }</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;      <span class="keywordflow">if</span> (v_accesses.size() == 1 &amp;&amp;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;          accesses.<a class="code" href="structkaldi_1_1nnet3_1_1MatrixAccesses.html#a7464ec491eeba4c23632a6ae583e9429">is_output</a>) {</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;        <span class="comment">// the only command that touches this variable is the allocation, and it</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;        <span class="comment">// is an output variable.  (this is unusual, but can happen e.g. if it&#39;s</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        <span class="comment">// a derivative, but due to min_deriv_time and max_deriv_time it ends up</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;        <span class="comment">// always being zero.</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;        all_variables_ok = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;      }</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    }</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordflow">if</span> (all_variables_ok) {</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;      <span class="comment">// Here is where the change actually happens.</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;      computation-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[allocate_command].command_type =</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;          <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a45d4b0c9ccaa83d0f2ab46e59f6e51be">kAllocMatrixUndefined</a>;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    }</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;  }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;}</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="comment">  This function is called from RemoveUnnecessaryAllocation.  The input is two</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;<span class="comment">  sorted, unique lists, of (deallocation-commands, allocation-commands)</span></div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;<span class="comment">  e.g. (d1, d2, d3.. ), (a1, a2, a3..); and to the output is *appended* a list</span></div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment">  of pairs (d, a).  Each output pair must satisfy the property that d &lt; a, and</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">  no member of the input lists may appear more than once in the output pairs</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment">  (although it&#39;s OK for input a and d values not to appear in any output pairs).</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;<span class="comment">  The goal of the implementation is to output as many pairs as possible, and</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;<span class="comment">  secondarily for the pairs to be as close as possible to each other (to avoid</span></div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;<span class="comment">  wasting too much memory).  I&#39;m not sure if this implementation achieves that.</span></div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00158"></a><span class="lineno"><a class="line" href="namespacekaldi_1_1nnet3.html#a4874b04bb051028a1b6cb08cff2d1994">  158</a></span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a4874b04bb051028a1b6cb08cff2d1994">ComputeCommandPairs</a>(</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;    <span class="keyword">const</span> std::pair&lt;std::vector&lt;int32&gt;, std::vector&lt;int32&gt; &gt; &amp;lists,</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    std::vector&lt;std::pair&lt;int32,int32&gt; &gt; *pairs) {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;  std::vector&lt;int32&gt; d_list = lists.first;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;  std::set&lt;int32&gt; a_set;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;  <a class="code" href="namespacekaldi.html#a3197e8bd3abedae8ba7ea37c38b08225">CopyVectorToSet</a>(lists.second, &amp;a_set);</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;  std::vector&lt;int32&gt;::reverse_iterator iter = d_list.rbegin(),</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;      end = d_list.rend();</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;  <span class="comment">// from the latest to the earliest deallocation command...</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;  <span class="keywordflow">for</span> (; iter != end; ++iter) {</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;    <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> <a class="code" href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">d</a> = *iter;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    std::set&lt;int32&gt;::iterator a_iter = a_set.upper_bound(d);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;    <span class="comment">// a_iter is an iterator to the first element a of the set &#39;a_set&#39; such</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="comment">// that a &gt; d, or a_set.end() if no such element exists.</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="keywordflow">if</span> (a_iter == a_set.end())</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;      <span class="keywordflow">continue</span>;  <span class="comment">// we will output no pair for this d.</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> a = *a_iter;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    <a class="code" href="group__error__group.html#ga2c852c1a15c7f195ec8021de2ab119a0">KALDI_PARANOID_ASSERT</a>(a &gt; d);  <span class="comment">// or code error</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    a_set.erase(a_iter);  <span class="comment">// remove this a from &#39;a_set&#39; so it doesn&#39;t get used</span></div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                          <span class="comment">// twice</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    pairs-&gt;push_back(std::pair&lt;int32,int32&gt;(d, a));</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;  }</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;}</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;</div>
<div class="line"><a name="l00185"></a><span class="lineno"><a class="line" href="namespacekaldi_1_1nnet3.html#a92c251003c3f612c5cfbcbd72cbd030b">  185</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a92c251003c3f612c5cfbcbd72cbd030b">RemoveUnnecessaryAllocation</a>(<span class="keyword">const</span> <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet,</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                                 <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) {</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;  <span class="comment">// For each size of matrix (i.e. each pair&lt;int32,int32&gt;), we</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;  <span class="comment">// accumulate a list of indexes of deallocation commands that</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;  <span class="comment">// are for that size, and a list of indexes of allocation commands</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;  <span class="comment">// for that size.</span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;  <span class="comment">// For each distinct matrix size, we then call ComputeCommandPairs on those</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;  <span class="comment">// two lists, to get pairs of (deallocation, allocation) command-indexes that</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;  <span class="comment">// we can optimize out to a single command.</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;  <span class="comment">// The map is from a (num-rows,num-columns) to two lists, of</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;  <span class="comment">// (deallocation-commands, allocation-commands).  The order may seem</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;  <span class="comment">// backwards, but that&#39;s the order of the pairs we are looking for.</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;  <span class="keyword">typedef</span> unordered_map&lt;std::pair&lt;int32,int32&gt;,</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;      std::pair&lt;std::vector&lt;int32&gt;,std::vector&lt;int32&gt; &gt;,</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;      <a class="code" href="structkaldi_1_1PairHasher.html">PairHasher&lt;int32&gt;</a> &gt; MapType;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;  MapType pair_map;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> num_commands = computation-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>.size();</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> command_index = 0; command_index &lt; num_commands; command_index++) {</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> &amp;command = computation-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[command_index];</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    <span class="keywordflow">if</span> (command.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html#a2d9ffb310ae91c656b84c1f68a897d02">command_type</a> == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8cf8e30f096831a33208ef1b9e22affc">kAllocMatrixZeroed</a> ||</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;        command.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html#a2d9ffb310ae91c656b84c1f68a897d02">command_type</a> == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a45d4b0c9ccaa83d0f2ab46e59f6e51be">kAllocMatrixUndefined</a> ||</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;        command.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html#a2d9ffb310ae91c656b84c1f68a897d02">command_type</a> == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kDeallocMatrix</a>) {</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;      <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> m = command.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html#a93be071b8aca6a02f5fe1f67c5e69273">arg1</a>, num_rows = computation-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a47a751a8db1c9c4856d04495f80620e9">matrices</a>[m].num_rows,</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;          num_cols = computation-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a47a751a8db1c9c4856d04495f80620e9">matrices</a>[m].num_cols;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;      std::pair&lt;int32,int32&gt; p(num_rows, num_cols);</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;      std::pair&lt;std::vector&lt;int32&gt;,std::vector&lt;int32&gt; &gt; &amp;lists = pair_map[p];</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;      <span class="keywordflow">if</span> (command.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html#a2d9ffb310ae91c656b84c1f68a897d02">command_type</a> == <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kDeallocMatrix</a>)</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;        lists.first.push_back(command_index);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;      <span class="keywordflow">else</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        lists.second.push_back(command_index);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;    }</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;  }</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;  MapType::const_iterator iter = pair_map.begin(), end = pair_map.end();</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;  std::vector&lt;std::pair&lt;int32,int32&gt; &gt; command_pairs;</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;  <span class="keywordflow">for</span> (; iter != end; ++iter)</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a4874b04bb051028a1b6cb08cff2d1994">ComputeCommandPairs</a>(iter-&gt;second, &amp;command_pairs);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;  <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0; <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a> &lt; command_pairs.size(); <a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;    <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> dealloc_index = command_pairs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].first,</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;        alloc_index = command_pairs[<a class="code" href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">i</a>].second;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        &amp;dealloc_command = computation-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[dealloc_index],</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;        &amp;alloc_command = computation-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[alloc_index];</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(dealloc_command.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html#a2d9ffb310ae91c656b84c1f68a897d02">command_type</a> ==</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                 <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kDeallocMatrix</a>);</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(alloc_command.command_type ==</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                 <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a45d4b0c9ccaa83d0f2ab46e59f6e51be">kAllocMatrixUndefined</a> ||</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                 alloc_command.command_type==</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                 <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8cf8e30f096831a33208ef1b9e22affc">kAllocMatrixZeroed</a>);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="comment">// remove the deallocation command.</span></div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    dealloc_command.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html#a2d9ffb310ae91c656b84c1f68a897d02">command_type</a> =  <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kNoOperation</a>;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;    alloc_command.arg2 = dealloc_command.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html#a93be071b8aca6a02f5fe1f67c5e69273">arg1</a>;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">if</span> (alloc_command.command_type ==</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a45d4b0c9ccaa83d0f2ab46e59f6e51be">kAllocMatrixUndefined</a>)</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;      alloc_command.command_type =</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;          <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ac68649c74ab0264e4db51c27d1394f6c">kAllocMatrixFromOther</a>;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;      alloc_command.command_type =</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;          <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a2ffa126c95db5cb37f86de49ae4d66ca">kAllocMatrixFromOtherZeroed</a>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;  }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a1146f4efa141a56210f9dbf1090b20f0">RemoveNoOps</a>(computation);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;}</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;</div>
<div class="line"><a name="l00251"></a><span class="lineno"><a class="line" href="namespacekaldi_1_1nnet3.html#a7464172a2f27484596c2d374bb1adcd6">  251</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a7464172a2f27484596c2d374bb1adcd6">VariableMergingOptimization</a>(<span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> &amp;config,</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                                 <span class="keyword">const</span> <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet,</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                                 <span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;request,</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                                 <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;  <span class="keywordtype">bool</span> changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;  <span class="keywordflow">while</span> (changed) {</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    changed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html">VariableMergingOptimizer</a> opt(config, nnet, request, computation);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <span class="keywordflow">if</span> (opt.<a class="code" href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a08a57d03b1828eeb8548ee5e8a942264">MergeVariables</a>())</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;      changed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;  }</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;}</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;<span class="comment">// This is a simplified top-level interface to the model-update consolidation</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;<span class="comment">// code from class ModelUpdateConsolidator.</span></div>
<div class="line"><a name="l00266"></a><span class="lineno"><a class="line" href="namespacekaldi_1_1nnet3.html#ad35855c00662ec8d8b2cf5e14569db0a">  266</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#ad35855c00662ec8d8b2cf5e14569db0a">ConsolidateModelUpdate</a>(<span class="keyword">const</span> <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet,</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                            <span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;request,</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                            <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) {</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;  <span class="keywordflow">if</span> (!request.<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a58c542fffb7e7f754148c264c90b4a5e">need_model_derivative</a>)</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;    <span class="keywordflow">return</span>;   <span class="comment">// An optimization; there would be nothing to do in this case.</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ModelUpdateConsolidator.html">ModelUpdateConsolidator</a> consolidator(nnet, computation);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;  consolidator.<a class="code" href="classkaldi_1_1nnet3_1_1ModelUpdateConsolidator.html#a1d8913b401bfd339536bdd60f97d6101">ConsolidateModelUpdate</a>();</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;}</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div>
<div class="line"><a name="l00276"></a><span class="lineno"><a class="line" href="namespacekaldi_1_1nnet3.html#ac759ea60772df625784bcc714f7a41da">  276</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#ac759ea60772df625784bcc714f7a41da">ConvertAdditionToAssignment</a>(<span class="keyword">const</span> <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet,</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                                 <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;  <a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html">Analyzer</a> analyzer;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;  analyzer.<a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html#aab8a145e53802c80302dc498e388a2ad">Init</a>(nnet, *computation);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1ComputationAnalysis.html">ComputationAnalysis</a> analysis(*computation, analyzer);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;  <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> num_commands = computation-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>.size();</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;  <span class="keywordflow">for</span> (<a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> command = 0; command &lt; num_commands; command++) {</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">NnetComputation::Command</a> &amp;c = computation-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">commands</a>[command];</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;    <span class="keywordflow">switch</span> (c.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html#a2d9ffb310ae91c656b84c1f68a897d02">command_type</a>) {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a45d4b0c9ccaa83d0f2ab46e59f6e51be">kAllocMatrixUndefined</a>: <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ac68649c74ab0264e4db51c27d1394f6c">kAllocMatrixFromOther</a>:</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Cannot call ConvertAdditionToAssignment after &quot;</span></div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                  &lt;&lt; <span class="stringliteral">&quot;allowing undefined initialization.&quot;</span>;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257">kMatrixAdd</a>: <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kAddRows</a>: <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kAddRowsMulti</a>:</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;      <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kAddToRowsMulti</a>: {</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <span class="keyword">const</span> std::vector&lt;int32&gt; &amp;submatrices_written =</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            analyzer.<a class="code" href="structkaldi_1_1nnet3_1_1Analyzer.html#ab90c860db5a4e29c2d4dbd81aae7b5ee">command_attributes</a>[command].submatrices_written;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;        <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(!submatrices_written.empty());</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        std::vector&lt;int32&gt;::const_iterator iter = submatrices_written.begin(),</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            end = submatrices_written.end();</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keywordtype">bool</span> can_convert = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        <span class="keywordflow">for</span> (; iter != end; ++iter) {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;          <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> submatrix_written = *iter;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;          <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> first_access_command = analysis.<a class="code" href="classkaldi_1_1nnet3_1_1ComputationAnalysis.html#a1329cc624adf8d30e394eafb14eb976d">FirstAccess</a>(submatrix_written);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;          <span class="comment">// first_access_command is first non-initialization command that</span></div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;          <span class="comment">// accesses this submatrix.  It can be assumed to be a write command,</span></div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;          <span class="comment">// since it makes no sense to read a variable before it&#39;s written to.</span></div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;          <span class="comment">// If it&#39;s before this command then we need to add rather than copy,</span></div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;          <span class="comment">// we can&#39;t do the conversion to a copy command.</span></div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;          <span class="keywordflow">if</span> (first_access_command != command) {</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            can_convert = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;          }</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        }</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        <span class="keywordflow">if</span> (can_convert) {  <span class="comment">// convert to a copy command.</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;          <span class="keywordflow">switch</span> (c.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html#a2d9ffb310ae91c656b84c1f68a897d02">command_type</a>) {</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257">kMatrixAdd</a>: c.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html#a2d9ffb310ae91c656b84c1f68a897d02">command_type</a> = <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74">kMatrixCopy</a>; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kAddRows</a>: c.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html#a2d9ffb310ae91c656b84c1f68a897d02">command_type</a> = <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258">kCopyRows</a>; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kAddRowsMulti</a>: c.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html#a2d9ffb310ae91c656b84c1f68a897d02">command_type</a> = <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5">kCopyRowsMulti</a>; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            <span class="keywordflow">case</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kAddToRowsMulti</a>: c.<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html#a2d9ffb310ae91c656b84c1f68a897d02">command_type</a> = <a class="code" href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c">kCopyToRowsMulti</a>; <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            <span class="keywordflow">default</span>: <a class="code" href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a> &lt;&lt; <span class="stringliteral">&quot;Unexpected command type.&quot;</span>;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;          }</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        }</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;      }</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;      <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    }</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;  }</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;}</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;</div>
<div class="line"><a name="l00326"></a><span class="lineno"><a class="line" href="namespacekaldi_1_1nnet3.html#a96e8c7c5766b9f5c698ce7195489efba">  326</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="namespacekaldi_1_1nnet3.html#a96e8c7c5766b9f5c698ce7195489efba">Optimize</a>(<span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">NnetOptimizeOptions</a> &amp;config,</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;              <span class="keyword">const</span> <a class="code" href="classkaldi_1_1nnet3_1_1Nnet.html">Nnet</a> &amp;nnet,</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;              <span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> &amp;request,</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;              <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) {</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;  <span class="keywordflow">if</span> (!config.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#ada3212723faff5ad5d718401c2b14abd">optimize</a>)</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 4)</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a28797c2cdd8990a88b55e122b2b2931a">CheckComputation</a>(nnet, request, *computation, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;  <span class="comment">// this will do nothing unless --min-deriv-time or --max-deriv-time was</span></div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;  <span class="comment">// set.</span></div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;  <a class="code" href="namespacekaldi_1_1nnet3.html#a6ed9b871bd28649b80165dc1af5d1a98">LimitDerivativeTimes</a>(nnet, config.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a3d087b2a181462f940490eeba587d5ed">min_deriv_time</a>, config.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a3eb30cd32859e75b85a514ee9747f9ef">max_deriv_time</a>,</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                       computation);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 4)</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a28797c2cdd8990a88b55e122b2b2931a">CheckComputation</a>(nnet, request, *computation, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;  <span class="keywordflow">if</span> (config.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#adecbb89738ead38979522ea3f9ca2de5">consolidate_model_update</a>)</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#ad35855c00662ec8d8b2cf5e14569db0a">ConsolidateModelUpdate</a>(nnet, request, computation);</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 4)</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a28797c2cdd8990a88b55e122b2b2931a">CheckComputation</a>(nnet, request, *computation, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;  <span class="keywordflow">if</span> (config.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a916c64dcfc34c507c77acdbb02457562">convert_addition</a>)</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#ac759ea60772df625784bcc714f7a41da">ConvertAdditionToAssignment</a>(nnet, computation);</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 4)</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a28797c2cdd8990a88b55e122b2b2931a">CheckComputation</a>(nnet, request, *computation, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;  <span class="keywordflow">if</span> (config.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a5a9cf0a0e6fa879ef136d18e4b3a7493">remove_assignments</a> || config.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a751610db82b663a3b2b415a839b0cad4">backprop_in_place</a> ||</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;      config.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a8de177378a5c3ef537b9d5927012427d">propagate_in_place</a>)</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a7464172a2f27484596c2d374bb1adcd6">VariableMergingOptimization</a>(config, nnet, request, computation);</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 4)</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a28797c2cdd8990a88b55e122b2b2931a">CheckComputation</a>(nnet, request, *computation, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;  <span class="keywordflow">if</span> (config.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#afc411b18b95a954ce30c56a8c802571c">initialize_undefined</a>)</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#aae053839b5ed781f2f7408489a1528dd">RemoveUnnecessaryZeroing</a>(nnet, computation);</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 4)</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a28797c2cdd8990a88b55e122b2b2931a">CheckComputation</a>(nnet, request, *computation, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;  <span class="keywordflow">if</span> (config.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#addc98e404df5dfefac47028896957554">move_sizing_commands</a>)</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a20e1e086f75487fe19752fd2b34ca627">MoveSizingCommands</a>(nnet, computation);</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 4)</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a28797c2cdd8990a88b55e122b2b2931a">CheckComputation</a>(nnet, request, *computation, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;  <span class="keywordflow">if</span> (config.<a class="code" href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#aeb266389b29b812033c443a46a906a15">allocate_from_other</a>)</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a92c251003c3f612c5cfbcbd72cbd030b">RemoveUnnecessaryAllocation</a>(nnet, computation);</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= 4)</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a28797c2cdd8990a88b55e122b2b2931a">CheckComputation</a>(nnet, request, *computation, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;}</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">// ComputationRequests are distinguished by the names and indexes</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">// of inputs and outputs</span></div>
<div class="line"><a name="l00384"></a><span class="lineno"><a class="line" href="structkaldi_1_1nnet3_1_1ComputationRequestHasher.html#a6d50471431e32e255329caaeb162ad05">  384</a></span>&#160;<span class="keywordtype">size_t</span> <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequestHasher.html#a6d50471431e32e255329caaeb162ad05">ComputationRequestHasher::operator() </a>(<span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *cr)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;  <span class="keywordtype">size_t</span> ans = 0;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;  std::vector&lt;IoSpecification&gt;::const_iterator itr = cr-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>.begin(),</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                                               end = cr-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">inputs</a>.end();</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;  <span class="keywordflow">for</span> (; itr != end; ++itr) {</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;    ans += <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequestHasher.html#a4bc19a14d90b1b1345864a001334b3ce">IoSpecificationToInt</a>(*itr);</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;  }</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;  itr = cr-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a75f6d03596c9241ae8d5791e6d0d84aa">outputs</a>.begin();</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;  end = cr-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a75f6d03596c9241ae8d5791e6d0d84aa">outputs</a>.end();</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;  <span class="keywordflow">for</span> (; itr != end; ++itr) {</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    ans += <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequestHasher.html#a4bc19a14d90b1b1345864a001334b3ce">IoSpecificationToInt</a>(*itr);</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;  }</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <span class="keywordflow">return</span> ans;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;}</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div>
<div class="line"><a name="l00399"></a><span class="lineno"><a class="line" href="structkaldi_1_1nnet3_1_1ComputationRequestHasher.html#a4bc19a14d90b1b1345864a001334b3ce">  399</a></span>&#160;<span class="keywordtype">size_t</span> <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequestHasher.html#a4bc19a14d90b1b1345864a001334b3ce">ComputationRequestHasher::IoSpecificationToInt</a>(<span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1IoSpecification.html">IoSpecification</a>&amp; spec)<span class="keyword"> const </span>{</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;  <span class="keywordtype">size_t</span> ans;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;  <a class="code" href="structkaldi_1_1StringHasher.html">StringHasher</a> string_hasher;</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;  ans = string_hasher(spec.<a class="code" href="structkaldi_1_1nnet3_1_1IoSpecification.html#a9b45b3e13bd9167aab02e17e08916231">name</a>);</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;  std::vector&lt;Index&gt;::const_iterator itr = spec.<a class="code" href="structkaldi_1_1nnet3_1_1IoSpecification.html#aa3daaa77b972f8dace077e94b418aab1">indexes</a>.begin(),</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                                     end = spec.<a class="code" href="structkaldi_1_1nnet3_1_1IoSpecification.html#aa3daaa77b972f8dace077e94b418aab1">indexes</a>.end();</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;  <span class="keywordflow">for</span> (; itr != end; ++itr) {</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;    ans += (*itr).n * 1619;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;    ans += (*itr).t * 15649;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;    ans += (*itr).x * 89809;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;  }</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;  <span class="keywordflow">return</span> ans;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;}</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div>
<div class="line"><a name="l00413"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a99d09d05ffe089e6854878af6c783e10">  413</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a99d09d05ffe089e6854878af6c783e10">CachingOptimizingCompiler::UpdateCache</a>(<span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *request,</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                                            <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation) {</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;  <span class="keywordflow">if</span> (<a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a6d889d796739f83d1af7a8a081e5a316">computation_cache_</a>.size() == <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a38be6b2c66f846512889b9fed7669815">cache_capacity_</a>) {</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;    <span class="comment">// full, locate the least-recently-accessed request</span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;    <span class="keyword">const</span> CacheType::iterator it =</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;        <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a6d889d796739f83d1af7a8a081e5a316">computation_cache_</a>.find(<a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#adc9736e62e5ba21e68fb538c9d573beb">access_queue_</a>.front());</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;    <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(it != <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a6d889d796739f83d1af7a8a081e5a316">computation_cache_</a>.end());</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;    <span class="comment">// purge the least-recently-accessed request</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;    <span class="keyword">delete</span> it-&gt;first;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;    <span class="keyword">delete</span> it-&gt;second.first;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a6d889d796739f83d1af7a8a081e5a316">computation_cache_</a>.erase(it);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#adc9736e62e5ba21e68fb538c9d573beb">access_queue_</a>.pop_front();</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;  }</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;  AqType::iterator ait = <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#adc9736e62e5ba21e68fb538c9d573beb">access_queue_</a>.insert(<a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#adc9736e62e5ba21e68fb538c9d573beb">access_queue_</a>.end(), request);</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a6d889d796739f83d1af7a8a081e5a316">computation_cache_</a>.insert(std::make_pair(request,</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                            std::make_pair(computation, ait)));</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;}</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div>
<div class="line"><a name="l00431"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a0434a0b1ee52e7a1a4f31acbf689a3b8">  431</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a0434a0b1ee52e7a1a4f31acbf689a3b8">CachingOptimizingCompiler::UpdateAccessQueue</a>(CacheType::iterator &amp;cit) {</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;  <span class="comment">// exist, update access record by moving the accessed</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;  <span class="comment">// request to the end of the access queue</span></div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;  <a class="code" href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a>(cit != <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a6d889d796739f83d1af7a8a081e5a316">computation_cache_</a>.end());</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;  <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#adc9736e62e5ba21e68fb538c9d573beb">access_queue_</a>.splice(<a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#adc9736e62e5ba21e68fb538c9d573beb">access_queue_</a>.end(), <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#adc9736e62e5ba21e68fb538c9d573beb">access_queue_</a>,</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                       cit-&gt;second.second);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;}</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;</div>
<div class="line"><a name="l00439"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a22f58fdec55e2b8025223847fb428ec9">  439</a></span>&#160;<a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a22f58fdec55e2b8025223847fb428ec9">CachingOptimizingCompiler::~CachingOptimizingCompiler</a>() {</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;  CacheType::const_iterator itr = <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a6d889d796739f83d1af7a8a081e5a316">computation_cache_</a>.begin(),</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      end = <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a6d889d796739f83d1af7a8a081e5a316">computation_cache_</a>.end();</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;  <span class="keywordflow">for</span> (; itr !=end; ++itr) {</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    <span class="keyword">delete</span> itr-&gt;first;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;    <span class="keyword">delete</span> itr-&gt;second.first;</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;  }</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;}</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;</div>
<div class="line"><a name="l00448"></a><span class="lineno"><a class="line" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a7362ae7f2c28fa8d444163e567802f7c">  448</a></span>&#160;<span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a>* <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a7362ae7f2c28fa8d444163e567802f7c">CachingOptimizingCompiler::Compile</a>(</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="keyword">const</span> <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a>  &amp;in_request) {</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;  <a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html">NnetComputation</a> *computation;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;  <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a> *request;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;  <span class="comment">// find computation in the cache</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;  CacheType::iterator cit = <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a6d889d796739f83d1af7a8a081e5a316">computation_cache_</a>.find(&amp;in_request);</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;  <span class="keywordflow">if</span> (cit == <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a6d889d796739f83d1af7a8a081e5a316">computation_cache_</a>.end()) {</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    <span class="comment">// if not found, compile and update cache</span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    request = <span class="keyword">new</span> <a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html">ComputationRequest</a>;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    *request = in_request;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html">Compiler</a> compiler(*request, <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>);</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <a class="code" href="structkaldi_1_1nnet3_1_1CompilerOptions.html">CompilerOptions</a> opts;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;    computation = <span class="keyword">new</span> <a class="code" href="namespacekaldi_1_1nnet2.html#a3c83004137bb16a4090ff862f0aceed4">NnetComputation</a>;</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;    compiler.<a class="code" href="classkaldi_1_1nnet3_1_1Compiler.html#a3ba7e6700716ba8e6dfb85784922001b">CreateComputation</a>(opts, computation);</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;    <a class="code" href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">int32</a> verbose_cutoff = 4;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= verbose_cutoff) {</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;      std::ostringstream os1;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;      request-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a8aa1a4815e8e109acb9e269385fd5e49">Print</a>(os1);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Computation request is &quot;</span> &lt;&lt; os1.str();</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;      std::ostringstream os2;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;      computation-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a1ec279d69756dd3c71dce72a83ea9020">Print</a>(os2, <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>);</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Generated computation is: &quot;</span> &lt;&lt; os2.str();</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    }</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    { <span class="comment">// some checking.</span></div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;      <a class="code" href="structkaldi_1_1nnet3_1_1CheckComputationOptions.html">CheckComputationOptions</a> check_config;</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;      <span class="comment">// we can do the rewrite check since it&#39;s before optimization.</span></div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;      check_config.<a class="code" href="structkaldi_1_1nnet3_1_1CheckComputationOptions.html#ab342a2855f4c0a04a1c4f565405e1b93">check_rewrite</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1ComputationChecker.html">ComputationChecker</a> checker(check_config, <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>, *computation);</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;      checker.<a class="code" href="classkaldi_1_1nnet3_1_1ComputationChecker.html#a434b035308434bbeb9b857f22b9f0db1">Check</a>();</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    }</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    <a class="code" href="namespacekaldi_1_1nnet3.html#a96e8c7c5766b9f5c698ce7195489efba">Optimize</a>(<a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a5f5dc05edfa0018d6f6b0b0cfa660e19">opt_config_</a>, <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>, *request, computation);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">GetVerboseLevel</a>() &gt;= verbose_cutoff) {</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;      std::ostringstream os;</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;      computation-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#a1ec279d69756dd3c71dce72a83ea9020">Print</a>(os, <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>);</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;      <a class="code" href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a> &lt;&lt; <span class="stringliteral">&quot;Optimized computation is: &quot;</span> &lt;&lt; os.str();</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    }</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    {  <span class="comment">// check the computation again.</span></div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;      <a class="code" href="structkaldi_1_1nnet3_1_1CheckComputationOptions.html">CheckComputationOptions</a> check_config;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;      <a class="code" href="classkaldi_1_1nnet3_1_1ComputationChecker.html">ComputationChecker</a> checker(check_config, <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#adbabf05a7702103113a02a113015205f">nnet_</a>, *computation);</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;      checker.<a class="code" href="classkaldi_1_1nnet3_1_1ComputationChecker.html#a434b035308434bbeb9b857f22b9f0db1">Check</a>();</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    }</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    computation-&gt;<a class="code" href="structkaldi_1_1nnet3_1_1NnetComputation.html#ac2af1facc3bf90819e78ea5b2bb2554d">ComputeCudaIndexes</a>();</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a99d09d05ffe089e6854878af6c783e10">UpdateCache</a>(request, computation);</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;  } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;    <span class="comment">// if found, update access queue</span></div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;    computation = cit-&gt;second.first;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;    <a class="code" href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a0434a0b1ee52e7a1a4f31acbf689a3b8">UpdateAccessQueue</a>(cit);</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;  }</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;  <span class="keywordflow">return</span> computation;</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;}</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;} <span class="comment">// namespace nnet3</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;} <span class="comment">// namespace kaldi</span></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationVariables_html_ae7def2293754ae347d6b9fe0cec63df0"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationVariables.html#ae7def2293754ae347d6b9fe0cec63df0">kaldi::nnet3::ComputationVariables::Init</a></div><div class="ttdeci">void Init(const NnetComputation &amp;computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l00133">nnet-analyze.cc:133</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_aeb266389b29b812033c443a46a906a15"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#aeb266389b29b812033c443a46a906a15">kaldi::nnet3::NnetOptimizeOptions::allocate_from_other</a></div><div class="ttdeci">bool allocate_from_other</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00045">nnet-optimize.h:45</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html">kaldi::nnet3::VariableMergingOptimizer</a></div><div class="ttdoc">This class is responsible for merging matrices, although you probably want to access it via the the f...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00133">nnet-optimize-utils.h:133</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a35d3d1a70d075561aaf91b263ea28f74">kaldi::nnet3::kMatrixCopy</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00205">nnet-computation.h:205</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler_html_a7362ae7f2c28fa8d444163e567802f7c"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a7362ae7f2c28fa8d444163e567802f7c">kaldi::nnet3::CachingOptimizingCompiler::Compile</a></div><div class="ttdeci">const NnetComputation * Compile(const ComputationRequest &amp;request)</div><div class="ttdoc">Does the compilation and returns a const pointer to the result, which is owned by this class...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00448">nnet-optimize.cc:448</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a7464172a2f27484596c2d374bb1adcd6"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a7464172a2f27484596c2d374bb1adcd6">kaldi::nnet3::VariableMergingOptimization</a></div><div class="ttdeci">void VariableMergingOptimization(const NnetOptimizeOptions &amp;config, const Nnet &amp;nnet, const ComputationRequest &amp;request, NnetComputation *computation)</div><div class="ttdoc">This wraps class VariableMergingOptimizer in a simplified interface. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00251">nnet-optimize.cc:251</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a58c542fffb7e7f754148c264c90b4a5e"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a58c542fffb7e7f754148c264c90b4a5e">kaldi::nnet3::ComputationRequest::need_model_derivative</a></div><div class="ttdeci">bool need_model_derivative</div><div class="ttdoc">if need_model_derivative is true, then we&#39;ll be doing either model training or model-derivative compu...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00110">nnet-computation.h:110</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_ac2af1facc3bf90819e78ea5b2bb2554d"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#ac2af1facc3bf90819e78ea5b2bb2554d">kaldi::nnet3::NnetComputation::ComputeCudaIndexes</a></div><div class="ttdeci">void ComputeCudaIndexes()</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8cc_source.html#l00083">nnet-computation.cc:83</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a4874b04bb051028a1b6cb08cff2d1994"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a4874b04bb051028a1b6cb08cff2d1994">kaldi::nnet3::ComputeCommandPairs</a></div><div class="ttdeci">static void ComputeCommandPairs(const std::pair&lt; std::vector&lt; int32 &gt;, std::vector&lt; int32 &gt; &gt; &amp;lists, std::vector&lt; std::pair&lt; int32, int32 &gt; &gt; *pairs)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00158">nnet-optimize.cc:158</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_addc98e404df5dfefac47028896957554"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#addc98e404df5dfefac47028896957554">kaldi::nnet3::NnetOptimizeOptions::move_sizing_commands</a></div><div class="ttdeci">bool move_sizing_commands</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00044">nnet-optimize.h:44</a></div></div>
<div class="ttc" id="group__error__group_html_gae77f5cf98f18f8cbe207690e49da166e"><div class="ttname"><a href="group__error__group.html#gae77f5cf98f18f8cbe207690e49da166e">kaldi::GetVerboseLevel</a></div><div class="ttdeci">int32 GetVerboseLevel()</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00060">kaldi-error.h:60</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1MatrixAccesses_html_a7464ec491eeba4c23632a6ae583e9429"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1MatrixAccesses.html#a7464ec491eeba4c23632a6ae583e9429">kaldi::nnet3::MatrixAccesses::is_output</a></div><div class="ttdeci">bool is_output</div><div class="ttdoc">true if this matrix is an output of the computation (i.e. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00267">nnet-analyze.h:267</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a79ca9eaa954dd29bb0671fb99e550439">kaldi::nnet3::kNoOperation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00207">nnet-computation.h:207</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_a5a9cf0a0e6fa879ef136d18e4b3a7493"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a5a9cf0a0e6fa879ef136d18e4b3a7493">kaldi::nnet3::NnetOptimizeOptions::remove_assignments</a></div><div class="ttdeci">bool remove_assignments</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00040">nnet-optimize.h:40</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ModelUpdateConsolidator_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ModelUpdateConsolidator.html">kaldi::nnet3::ModelUpdateConsolidator</a></div><div class="ttdoc">This class is responsible for consolidating the model-update part of backprop commands, for components in (e.g.) recurrent networks that need to have many separate backprop commands, into more efficient single commands operating on consolidated data in larger matrices. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8h_source.html#l00205">nnet-optimize-utils.h:205</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a8cf8e30f096831a33208ef1b9e22affc"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8cf8e30f096831a33208ef1b9e22affc">kaldi::nnet3::kAllocMatrixZeroed</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00202">nnet-computation.h:202</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a341a9c019757a7f1172d86bad51500a5">kaldi::nnet3::kCopyRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00206">nnet-computation.h:206</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ac759ea60772df625784bcc714f7a41da"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ac759ea60772df625784bcc714f7a41da">kaldi::nnet3::ConvertAdditionToAssignment</a></div><div class="ttdeci">void ConvertAdditionToAssignment(const Nnet &amp;nnet, NnetComputation *computation)</div><div class="ttdoc">This converts addition operations (things with Add in their names) to copy operations (things with Co...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00276">nnet-optimize.cc:276</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler_html_a22f58fdec55e2b8025223847fb428ec9"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a22f58fdec55e2b8025223847fb428ec9">kaldi::nnet3::CachingOptimizingCompiler::~CachingOptimizingCompiler</a></div><div class="ttdeci">~CachingOptimizingCompiler()</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00439">nnet-optimize.cc:439</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationChecker_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationChecker.html">kaldi::nnet3::ComputationChecker</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00394">nnet-analyze.h:394</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae77588ab7fc4ccf842de7ec941247062">kaldi::nnet3::kDeallocMatrix</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00203">nnet-computation.h:203</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a56ccdfeff2303e6dee20771d1a4fad78"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a56ccdfeff2303e6dee20771d1a4fad78">kaldi::nnet3::ComputationRequest::inputs</a></div><div class="ttdeci">std::vector&lt; IoSpecification &gt; inputs</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00104">nnet-computation.h:104</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_a47a751a8db1c9c4856d04495f80620e9"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#a47a751a8db1c9c4856d04495f80620e9">kaldi::nnet3::NnetComputation::matrices</a></div><div class="ttdeci">std::vector&lt; MatrixInfo &gt; matrices</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00259">nnet-computation.h:259</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a308b0ecf9083a7fde572d88f70af6258">kaldi::nnet3::kCopyRows</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00205">nnet-computation.h:205</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ae9638edeb0ada9a6373257fd508ae11f">kaldi::nnet3::kAddRows</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00205">nnet-computation.h:205</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1MatrixAccesses_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1MatrixAccesses.html">kaldi::nnet3::MatrixAccesses</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00248">nnet-analyze.h:248</a></div></div>
<div class="ttc" id="namespacekaldi_html_a3197e8bd3abedae8ba7ea37c38b08225"><div class="ttname"><a href="namespacekaldi.html#a3197e8bd3abedae8ba7ea37c38b08225">kaldi::CopyVectorToSet</a></div><div class="ttdeci">void CopyVectorToSet(const std::vector&lt; A &gt; &amp;v, std::set&lt; A &gt; *s)</div><div class="ttdoc">Copies the contents of a vector to a set. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00186">stl-utils.h:186</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a45d4b0c9ccaa83d0f2ab46e59f6e51be"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a45d4b0c9ccaa83d0f2ab46e59f6e51be">kaldi::nnet3::kAllocMatrixUndefined</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00202">nnet-computation.h:202</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler_html_adbabf05a7702103113a02a113015205f"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#adbabf05a7702103113a02a113015205f">kaldi::nnet3::CachingOptimizingCompiler::nnet_</a></div><div class="ttdeci">const Nnet &amp; nnet_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00151">nnet-optimize.h:151</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1IoSpecification_html_a9b45b3e13bd9167aab02e17e08916231"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1IoSpecification.html#a9b45b3e13bd9167aab02e17e08916231">kaldi::nnet3::IoSpecification::name</a></div><div class="ttdeci">std::string name</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00070">nnet-computation.h:70</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_aa02a576b6e9aa0977f3eb52471742b85"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aa02a576b6e9aa0977f3eb52471742b85">kaldi::nnet3::ComputeCommandAttributes</a></div><div class="ttdeci">void ComputeCommandAttributes(const Nnet &amp;nnet, const NnetComputation &amp;computation, const ComputationVariables &amp;vars, std::vector&lt; CommandAttributes &gt; *attributes)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l00267">nnet-analyze.cc:267</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_afeb2e3e7413a0649c8a60e3bcd66981b"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#afeb2e3e7413a0649c8a60e3bcd66981b">kaldi::nnet3::NnetComputation::commands</a></div><div class="ttdeci">std::vector&lt; Command &gt; commands</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00303">nnet-computation.h:303</a></div></div>
<div class="ttc" id="structkaldi_1_1StringHasher_html"><div class="ttname"><a href="structkaldi_1_1StringHasher.html">kaldi::StringHasher</a></div><div class="ttdoc">A hashing function object for strings. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00262">stl-utils.h:262</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_a3d087b2a181462f940490eeba587d5ed"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a3d087b2a181462f940490eeba587d5ed">kaldi::nnet3::NnetOptimizeOptions::min_deriv_time</a></div><div class="ttdeci">int32 min_deriv_time</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00046">nnet-optimize.h:46</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a6ed9b871bd28649b80165dc1af5d1a98"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a6ed9b871bd28649b80165dc1af5d1a98">kaldi::nnet3::LimitDerivativeTimes</a></div><div class="ttdeci">void LimitDerivativeTimes(const Nnet &amp;nnet, int32 min_deriv_time, int32 max_deriv_time, NnetComputation *computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l01805">nnet-optimize-utils.cc:1805</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Analyzer_html_ab90c860db5a4e29c2d4dbd81aae7b5ee"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Analyzer.html#ab90c860db5a4e29c2d4dbd81aae7b5ee">kaldi::nnet3::Analyzer::command_attributes</a></div><div class="ttdeci">std::vector&lt; CommandAttributes &gt; command_attributes</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00293">nnet-analyze.h:293</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1MatrixAccesses_html_a36b3030ce98db1e72110930473d8b93e"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1MatrixAccesses.html#a36b3030ce98db1e72110930473d8b93e">kaldi::nnet3::MatrixAccesses::accesses</a></div><div class="ttdeci">std::vector&lt; Access &gt; accesses</div><div class="ttdoc">Records the indexes of commands that access the matrix, and the type (read, read/write, write). </div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00261">nnet-analyze.h:261</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a8ce789ab4782758335cc37349fb97257">kaldi::nnet3::kMatrixAdd</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00205">nnet-computation.h:205</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequestHasher_html_a6d50471431e32e255329caaeb162ad05"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequestHasher.html#a6d50471431e32e255329caaeb162ad05">kaldi::nnet3::ComputationRequestHasher::operator()</a></div><div class="ttdeci">size_t operator()(const ComputationRequest *cr) const </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00384">nnet-optimize.cc:384</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command_html_a93be071b8aca6a02f5fe1f67c5e69273"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html#a93be071b8aca6a02f5fe1f67c5e69273">kaldi::nnet3::NnetComputation::Command::arg1</a></div><div class="ttdeci">int32 arg1</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00242">nnet-computation.h:242</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a20e1e086f75487fe19752fd2b34ca627"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a20e1e086f75487fe19752fd2b34ca627">kaldi::nnet3::MoveSizingCommands</a></div><div class="ttdeci">void MoveSizingCommands(const Nnet &amp;nnet, NnetComputation *computation)</div><div class="ttdoc">This optimization moves commands that initialize matrices to as late as possible, and commands that e...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00028">nnet-optimize.cc:28</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_ada3212723faff5ad5d718401c2b14abd"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#ada3212723faff5ad5d718401c2b14abd">kaldi::nnet3::NnetOptimizeOptions::optimize</a></div><div class="ttdeci">bool optimize</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00035">nnet-optimize.h:35</a></div></div>
<div class="ttc" id="nnet-optimize_8h_html"><div class="ttname"><a href="nnet-optimize_8h.html">nnet-optimize.h</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_adecbb89738ead38979522ea3f9ca2de5"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#adecbb89738ead38979522ea3f9ca2de5">kaldi::nnet3::NnetOptimizeOptions::consolidate_model_update</a></div><div class="ttdeci">bool consolidate_model_update</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00036">nnet-optimize.h:36</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler_html_adc9736e62e5ba21e68fb538c9d573beb"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#adc9736e62e5ba21e68fb538c9d573beb">kaldi::nnet3::CachingOptimizingCompiler::access_queue_</a></div><div class="ttdeci">AqType access_queue_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00161">nnet-optimize.h:161</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1CompilerOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1CompilerOptions.html">kaldi::nnet3::CompilerOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00034">nnet-compile.h:34</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a5161c1dfc34a4df1b19e9d3b8dc9499c">kaldi::nnet3::kCopyToRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00206">nnet-computation.h:206</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html">kaldi::nnet3::ComputationRequest</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00103">nnet-computation.h:103</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationVariables_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationVariables.html">kaldi::nnet3::ComputationVariables</a></div><div class="ttdoc">This class relates the matrices and sub-matrices in the computation to imaginary &quot;variables&quot;, such that we can think of the operations as operating on sets of individual variables, and we can then do analysis that lets us do optimization. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00122">nnet-analyze.h:122</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Analyzer_html_aab8a145e53802c80302dc498e388a2ad"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Analyzer.html#aab8a145e53802c80302dc498e388a2ad">kaldi::nnet3::Analyzer::Init</a></div><div class="ttdeci">void Init(const Nnet &amp;nnet, const NnetComputation &amp;computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l01233">nnet-analyze.cc:1233</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a92c251003c3f612c5cfbcbd72cbd030b"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a92c251003c3f612c5cfbcbd72cbd030b">kaldi::nnet3::RemoveUnnecessaryAllocation</a></div><div class="ttdeci">void RemoveUnnecessaryAllocation(const Nnet &amp;nnet, NnetComputation *computation)</div><div class="ttdoc">This optimization detects cases where we deallocate a matrix, and then later allocate another matrix ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00185">nnet-optimize.cc:185</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_aae053839b5ed781f2f7408489a1528dd"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#aae053839b5ed781f2f7408489a1528dd">kaldi::nnet3::RemoveUnnecessaryZeroing</a></div><div class="ttdeci">void RemoveUnnecessaryZeroing(const Nnet &amp;nnet, NnetComputation *computation)</div><div class="ttdoc">This optimization function changes, where possible, matrix initializations of type kAllocMatrixZeroed...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00090">nnet-optimize.cc:90</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a474b6a19fd42f428dd178f9af05150a8"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a474b6a19fd42f428dd178f9af05150a8">kaldi::nnet3::ComputeVariableAccesses</a></div><div class="ttdeci">void ComputeVariableAccesses(const ComputationVariables &amp;variables, const std::vector&lt; CommandAttributes &gt; &amp;command_attributes, std::vector&lt; std::vector&lt; Access &gt; &gt; *variable_accesses)</div><div class="ttdoc">After the command-level attributes have been computed, this function organizes them per variable (see...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l00390">nnet-analyze.cc:390</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a96e8c7c5766b9f5c698ce7195489efba"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a96e8c7c5766b9f5c698ce7195489efba">kaldi::nnet3::Optimize</a></div><div class="ttdeci">void Optimize(const NnetOptimizeOptions &amp;config, const Nnet &amp;nnet, const ComputationRequest &amp;request, NnetComputation *computation)</div><div class="ttdoc">This is the top-level function for optimizing a computation. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00326">nnet-optimize.cc:326</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequestHasher_html_a4bc19a14d90b1b1345864a001334b3ce"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequestHasher.html#a4bc19a14d90b1b1345864a001334b3ce">kaldi::nnet3::ComputationRequestHasher::IoSpecificationToInt</a></div><div class="ttdeci">size_t IoSpecificationToInt(const IoSpecification &amp;spec) const </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00399">nnet-optimize.cc:399</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html">kaldi::nnet3::NnetComputation::Command</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00240">nnet-computation.h:240</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_a916c64dcfc34c507c77acdbb02457562"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a916c64dcfc34c507c77acdbb02457562">kaldi::nnet3::NnetOptimizeOptions::convert_addition</a></div><div class="ttdeci">bool convert_addition</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00039">nnet-optimize.h:39</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_a8de177378a5c3ef537b9d5927012427d"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a8de177378a5c3ef537b9d5927012427d">kaldi::nnet3::NnetOptimizeOptions::propagate_in_place</a></div><div class="ttdeci">bool propagate_in_place</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00037">nnet-optimize.h:37</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html">kaldi::nnet3::NnetOptimizeOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00034">nnet-optimize.h:34</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Nnet_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Nnet.html">kaldi::nnet3::Nnet</a></div><div class="ttdef"><b>Definition:</b> <a href="_2nnet-nnet_8h_source.html#l00115">nnet-nnet.h:115</a></div></div>
<div class="ttc" id="group__error__group_html_ga0251fa005e2fdb1dcc6e24f06afe3b1f"><div class="ttname"><a href="group__error__group.html#ga0251fa005e2fdb1dcc6e24f06afe3b1f">KALDI_ERR</a></div><div class="ttdeci">#define KALDI_ERR</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00160">kaldi-error.h:160</a></div></div>
<div class="ttc" id="group__error__group_html_ga2c852c1a15c7f195ec8021de2ab119a0"><div class="ttname"><a href="group__error__group.html#ga2c852c1a15c7f195ec8021de2ab119a0">KALDI_PARANOID_ASSERT</a></div><div class="ttdeci">#define KALDI_PARANOID_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00156">kaldi-error.h:156</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationVariables_html_abf8ca3ace52f6544f8931b862944d998"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationVariables.html#abf8ca3ace52f6544f8931b862944d998">kaldi::nnet3::ComputationVariables::AppendVariablesForMatrix</a></div><div class="ttdeci">void AppendVariablesForMatrix(int32 matrix_index, std::vector&lt; int32 &gt; *variable_indexes) const </div><div class="ttdoc">Appends to variables_indexes the sorted list of variables corresponding to a matrix index...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l00156">nnet-analyze.cc:156</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Analyzer_html_a3b73c505d462ed9086dc5fc3735202a7"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Analyzer.html#a3b73c505d462ed9086dc5fc3735202a7">kaldi::nnet3::Analyzer::variable_accesses</a></div><div class="ttdeci">std::vector&lt; std::vector&lt; Access &gt; &gt; variable_accesses</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00294">nnet-analyze.h:294</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a26009d8f2bc3f61d214925ae25af9962">kaldi::nnet3::kAddRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00206">nnet-computation.h:206</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1MatrixAccesses_html_a7ca773444a9de6d9f8c01f693ec4ab16"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1MatrixAccesses.html#a7ca773444a9de6d9f8c01f693ec4ab16">kaldi::nnet3::MatrixAccesses::deallocate_command</a></div><div class="ttdeci">int32 deallocate_command</div><div class="ttdoc">Index of the command that deallocates the matrix, or -1 if never gets deallocated (e...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00254">nnet-analyze.h:254</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ad8aff9e545a5f496a179a16667431478a6c8aa74b13e6c53c03527cac24060e4f">kaldi::nnet3::kWriteAccess</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00078">nnet-analyze.h:78</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command_html_a2d9ffb310ae91c656b84c1f68a897d02"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation_1_1Command.html#a2d9ffb310ae91c656b84c1f68a897d02">kaldi::nnet3::NnetComputation::Command::command_type</a></div><div class="ttdeci">CommandType command_type</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00241">nnet-computation.h:241</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a8aa1a4815e8e109acb9e269385fd5e49"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a8aa1a4815e8e109acb9e269385fd5e49">kaldi::nnet3::ComputationRequest::Print</a></div><div class="ttdeci">void Print(std::ostream &amp;os) const </div><div class="ttdoc">This function is for printing info about the computation request in a human-readable way...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8cc_source.html#l00478">nnet-computation.cc:478</a></div></div>
<div class="ttc" id="namespacekaldi_html_ab7903878916593daecbeb95b98115ab0"><div class="ttname"><a href="namespacekaldi.html#ab7903878916593daecbeb95b98115ab0">kaldi::int32</a></div><div class="ttdeci">int32_t int32</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-types_8h_source.html#l00047">kaldi-types.h:47</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1CheckComputationOptions_html_ab342a2855f4c0a04a1c4f565405e1b93"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1CheckComputationOptions.html#ab342a2855f4c0a04a1c4f565405e1b93">kaldi::nnet3::CheckComputationOptions::check_rewrite</a></div><div class="ttdeci">bool check_rewrite</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00388">nnet-analyze.h:388</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1IoSpecification_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1IoSpecification.html">kaldi::nnet3::IoSpecification</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00069">nnet-computation.h:69</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationChecker_html_a434b035308434bbeb9b857f22b9f0db1"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationChecker.html#a434b035308434bbeb9b857f22b9f0db1">kaldi::nnet3::ComputationChecker::Check</a></div><div class="ttdeci">void Check()</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l00554">nnet-analyze.cc:554</a></div></div>
<div class="ttc" id="namespacernnlm_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="namespacernnlm.html#acb559820d9ca11295b4500f179ef6392">rnnlm::i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00066">mikolov-rnnlm-lib.cc:66</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a2f107eabc73f1b70436ed117375778c1"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a2f107eabc73f1b70436ed117375778c1">kaldi::nnet3::ComputeMatrixAccesses</a></div><div class="ttdeci">void ComputeMatrixAccesses(const Nnet &amp;nnet, const NnetComputation &amp;computation, const ComputationVariables &amp;variables, const std::vector&lt; CommandAttributes &gt; &amp;command_attributes, std::vector&lt; MatrixAccesses &gt; *matrix_accesses)</div><div class="ttdoc">This function organizes information in the CommandAttributes in a way that is convenient to access pe...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l00436">nnet-analyze.cc:436</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler_html_a6d889d796739f83d1af7a8a081e5a316"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a6d889d796739f83d1af7a8a081e5a316">kaldi::nnet3::CachingOptimizingCompiler::computation_cache_</a></div><div class="ttdeci">CacheType computation_cache_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00169">nnet-optimize.h:169</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1IoSpecification_html_aa3daaa77b972f8dace077e94b418aab1"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1IoSpecification.html#aa3daaa77b972f8dace077e94b418aab1">kaldi::nnet3::IoSpecification::indexes</a></div><div class="ttdeci">std::vector&lt; Index &gt; indexes</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00071">nnet-computation.h:71</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Analyzer_html_a1451c041c35be895025d122f136b9959"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Analyzer.html#a1451c041c35be895025d122f136b9959">kaldi::nnet3::Analyzer::matrix_accesses</a></div><div class="ttdeci">std::vector&lt; MatrixAccesses &gt; matrix_accesses</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00295">nnet-analyze.h:295</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a2ffa126c95db5cb37f86de49ae4d66ca"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a2ffa126c95db5cb37f86de49ae4d66ca">kaldi::nnet3::kAllocMatrixFromOtherZeroed</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00203">nnet-computation.h:203</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html_a3ba7e6700716ba8e6dfb85784922001b"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html#a3ba7e6700716ba8e6dfb85784922001b">kaldi::nnet3::Compiler::CreateComputation</a></div><div class="ttdeci">void CreateComputation(const CompilerOptions &amp;opts, NnetComputation *computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8cc_source.html#l00033">nnet-compile.cc:33</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html">kaldi::nnet3::NnetComputation</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00213">nnet-computation.h:213</a></div></div>
<div class="ttc" id="group__error__group_html_gad5710173d69cddcda4fa21ded3c77f16"><div class="ttname"><a href="group__error__group.html#gad5710173d69cddcda4fa21ded3c77f16">KALDI_ASSERT</a></div><div class="ttdeci">#define KALDI_ASSERT(cond)</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00143">kaldi-error.h:143</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetComputation_html_a1ec279d69756dd3c71dce72a83ea9020"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetComputation.html#a1ec279d69756dd3c71dce72a83ea9020">kaldi::nnet3::NnetComputation::Print</a></div><div class="ttdeci">void Print(std::ostream &amp;os, const Nnet &amp;nnet) const </div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8cc_source.html#l00401">nnet-computation.cc:401</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1ComputationRequest_html_a75f6d03596c9241ae8d5791e6d0d84aa"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1ComputationRequest.html#a75f6d03596c9241ae8d5791e6d0d84aa">kaldi::nnet3::ComputationRequest::outputs</a></div><div class="ttdeci">std::vector&lt; IoSpecification &gt; outputs</div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00105">nnet-computation.h:105</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a1146f4efa141a56210f9dbf1090b20f0"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a1146f4efa141a56210f9dbf1090b20f0">kaldi::nnet3::RemoveNoOps</a></div><div class="ttdeci">void RemoveNoOps(NnetComputation *computation)</div><div class="ttdoc">Removes commands of type kNoOperation in the computation. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00604">nnet-optimize-utils.cc:604</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_a751610db82b663a3b2b415a839b0cad4"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a751610db82b663a3b2b415a839b0cad4">kaldi::nnet3::NnetOptimizeOptions::backprop_in_place</a></div><div class="ttdeci">bool backprop_in_place</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00038">nnet-optimize.h:38</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1Compiler_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1Compiler.html">kaldi::nnet3::Compiler</a></div><div class="ttdoc">This class creates an initial version of the NnetComputation, without any optimization or sharing of ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-compile_8h_source.html#l00044">nnet-compile.h:44</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1VariableMergingOptimizer_html_a08a57d03b1828eeb8548ee5e8a942264"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1VariableMergingOptimizer.html#a08a57d03b1828eeb8548ee5e8a942264">kaldi::nnet3::VariableMergingOptimizer::MergeVariables</a></div><div class="ttdeci">bool MergeVariables()</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l00706">nnet-optimize-utils.cc:706</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ModelUpdateConsolidator_html_a1d8913b401bfd339536bdd60f97d6101"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ModelUpdateConsolidator.html#a1d8913b401bfd339536bdd60f97d6101">kaldi::nnet3::ModelUpdateConsolidator::ConsolidateModelUpdate</a></div><div class="ttdeci">void ConsolidateModelUpdate()</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize-utils_8cc_source.html#l01157">nnet-optimize-utils.cc:1157</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_a3eb30cd32859e75b85a514ee9747f9ef"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#a3eb30cd32859e75b85a514ee9747f9ef">kaldi::nnet3::NnetOptimizeOptions::max_deriv_time</a></div><div class="ttdeci">int32 max_deriv_time</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00047">nnet-optimize.h:47</a></div></div>
<div class="ttc" id="nnet-optimize-utils_8h_html"><div class="ttname"><a href="nnet-optimize-utils_8h.html">nnet-optimize-utils.h</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1MatrixAccesses_html_a6a26bfae0a795d6987c7db2476fdda1a"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1MatrixAccesses.html#a6a26bfae0a795d6987c7db2476fdda1a">kaldi::nnet3::MatrixAccesses::allocate_command</a></div><div class="ttdeci">int32 allocate_command</div><div class="ttdoc">Index of the command that allocates the matrix, or -1 if the command doesn&#39;t exist (e...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00251">nnet-analyze.h:251</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationAnalysis_html_a1329cc624adf8d30e394eafb14eb976d"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationAnalysis.html#a1329cc624adf8d30e394eafb14eb976d">kaldi::nnet3::ComputationAnalysis::FirstAccess</a></div><div class="ttdeci">int32 FirstAccess(int32 s) const </div><div class="ttdoc">If the matrix underlying submatrix &#39;s&#39; is an input then this returns -1; otherwise it returns the fir...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l01001">nnet-analyze.cc:1001</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a28797c2cdd8990a88b55e122b2b2931a"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a28797c2cdd8990a88b55e122b2b2931a">kaldi::nnet3::CheckComputation</a></div><div class="ttdeci">void CheckComputation(const Nnet &amp;nnet, const ComputationRequest &amp;request, const NnetComputation &amp;computation, bool check_rewrite)</div><div class="ttdoc">This is a convenience interface for class ComputationChecker. </div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8cc_source.html#l00975">nnet-analyze.cc:975</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Analyzer_html_afe662460f3e8b135d96fcd057638bd28"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Analyzer.html#afe662460f3e8b135d96fcd057638bd28">kaldi::nnet3::Analyzer::variables</a></div><div class="ttdeci">ComputationVariables variables</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00292">nnet-analyze.h:292</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler_html_a5f5dc05edfa0018d6f6b0b0cfa660e19"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a5f5dc05edfa0018d6f6b0b0cfa660e19">kaldi::nnet3::CachingOptimizingCompiler::opt_config_</a></div><div class="ttdeci">NnetOptimizeOptions opt_config_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00152">nnet-optimize.h:152</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352a662aa95978d72cd24fde262e35941fad">kaldi::nnet3::kAddToRowsMulti</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00206">nnet-computation.h:206</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler_html_a38be6b2c66f846512889b9fed7669815"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a38be6b2c66f846512889b9fed7669815">kaldi::nnet3::CachingOptimizingCompiler::cache_capacity_</a></div><div class="ttdeci">int32 cache_capacity_</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00181">nnet-optimize.h:181</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet2_html_a3c83004137bb16a4090ff862f0aceed4"><div class="ttname"><a href="namespacekaldi_1_1nnet2.html#a3c83004137bb16a4090ff862f0aceed4">kaldi::nnet2::NnetComputation</a></div><div class="ttdeci">void NnetComputation(const Nnet &amp;nnet, const CuMatrixBase&lt; BaseFloat &gt; &amp;input, bool pad_input, CuMatrixBase&lt; BaseFloat &gt; *output)</div><div class="ttdoc">Does the basic neural net computation, on a sequence of data (e.g. </div><div class="ttdef"><b>Definition:</b> <a href="nnet2_2nnet-compute_8cc_source.html#l00160">nnet-compute.cc:160</a></div></div>
<div class="ttc" id="group__error__group_html_gaf8fb55454306b60c9c1e07a6ef9d341a"><div class="ttname"><a href="group__error__group.html#gaf8fb55454306b60c9c1e07a6ef9d341a">KALDI_LOG</a></div><div class="ttdeci">#define KALDI_LOG</div><div class="ttdef"><b>Definition:</b> <a href="kaldi-error_8h_source.html#l00164">kaldi-error.h:164</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1CheckComputationOptions_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1CheckComputationOptions.html">kaldi::nnet3::CheckComputationOptions</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00385">nnet-analyze.h:385</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler_html_a0434a0b1ee52e7a1a4f31acbf689a3b8"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a0434a0b1ee52e7a1a4f31acbf689a3b8">kaldi::nnet3::CachingOptimizingCompiler::UpdateAccessQueue</a></div><div class="ttdeci">void UpdateAccessQueue(CacheType::iterator &amp;cit)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00431">nnet-optimize.cc:431</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_a21e038f5b8958e203d28bc4f18472352ac68649c74ab0264e4db51c27d1394f6c"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#a21e038f5b8958e203d28bc4f18472352ac68649c74ab0264e4db51c27d1394f6c">kaldi::nnet3::kAllocMatrixFromOther</a></div><div class="ttdef"><b>Definition:</b> <a href="nnet-computation_8h_source.html#l00203">nnet-computation.h:203</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1NnetOptimizeOptions_html_afc411b18b95a954ce30c56a8c802571c"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1NnetOptimizeOptions.html#afc411b18b95a954ce30c56a8c802571c">kaldi::nnet3::NnetOptimizeOptions::initialize_undefined</a></div><div class="ttdeci">bool initialize_undefined</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8h_source.html#l00043">nnet-optimize.h:43</a></div></div>
<div class="ttc" id="namespacekaldi_1_1nnet3_html_ad35855c00662ec8d8b2cf5e14569db0a"><div class="ttname"><a href="namespacekaldi_1_1nnet3.html#ad35855c00662ec8d8b2cf5e14569db0a">kaldi::nnet3::ConsolidateModelUpdate</a></div><div class="ttdeci">void ConsolidateModelUpdate(const Nnet &amp;nnet, const ComputationRequest &amp;request, NnetComputation *computation)</div><div class="ttdoc">This consolidates the model-update parts of the backprop into larger operations (applicable mostly to...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00266">nnet-optimize.cc:266</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler_html_a99d09d05ffe089e6854878af6c783e10"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1CachingOptimizingCompiler.html#a99d09d05ffe089e6854878af6c783e10">kaldi::nnet3::CachingOptimizingCompiler::UpdateCache</a></div><div class="ttdeci">void UpdateCache(const ComputationRequest *request, NnetComputation *computation)</div><div class="ttdef"><b>Definition:</b> <a href="nnet-optimize_8cc_source.html#l00413">nnet-optimize.cc:413</a></div></div>
<div class="ttc" id="structkaldi_1_1nnet3_1_1Analyzer_html"><div class="ttname"><a href="structkaldi_1_1nnet3_1_1Analyzer.html">kaldi::nnet3::Analyzer</a></div><div class="ttdoc">This struct exists to set up various pieces of analysis; it helps avoid the repetition of code where ...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00291">nnet-analyze.h:291</a></div></div>
<div class="ttc" id="namespacernnlm_html_a873684cefeb665f3d5e6b495de57fc0d"><div class="ttname"><a href="namespacernnlm.html#a873684cefeb665f3d5e6b495de57fc0d">rnnlm::d</a></div><div class="ttdeci">double d</div><div class="ttdef"><b>Definition:</b> <a href="mikolov-rnnlm-lib_8cc_source.html#l00064">mikolov-rnnlm-lib.cc:64</a></div></div>
<div class="ttc" id="structkaldi_1_1PairHasher_html"><div class="ttname"><a href="structkaldi_1_1PairHasher.html">kaldi::PairHasher</a></div><div class="ttdoc">A hashing function-object for pairs of ints. </div><div class="ttdef"><b>Definition:</b> <a href="stl-utils_8h_source.html#l00249">stl-utils.h:249</a></div></div>
<div class="ttc" id="classkaldi_1_1nnet3_1_1ComputationAnalysis_html"><div class="ttname"><a href="classkaldi_1_1nnet3_1_1ComputationAnalysis.html">kaldi::nnet3::ComputationAnalysis</a></div><div class="ttdoc">This class performs various kinds of specific analysis on top of what class Analyzer gives you immedi...</div><div class="ttdef"><b>Definition:</b> <a href="nnet-analyze_8h_source.html#l00305">nnet-analyze.h:305</a></div></div>
</div><!-- fragment --></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="dir_67a0a17020b8eedc08ffa5626b1d53a1.html">nnet3</a></li><li class="navelem"><a class="el" href="nnet-optimize_8cc.html">nnet-optimize.cc</a></li>
    <li class="footer">Generated on Thu Apr 28 2016 15:42:32 for Kaldi by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
