<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>Kaldi: Kaldi Tutorial: Version control with Git (5 minutes)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link rel="icon" href="favicon.ico" type="image/x-icon" />
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="stylesheet.css" rel="stylesheet" type="text/css" /> 
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
 <td id="projectlogo"><a href="http://kaldi-asr.org/"><img alt="Logo" src="KaldiTextAndLogoSmall.png"/ style="padding: 3px 5px 1px 5px"></a></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname" style="display:none">Kaldi
   </div>
  </td>
    <td style="padding-left: 0.5em;">
    <div id="projectbrief" style="display:none"></div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('tutorial_git.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(12)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Kaldi Tutorial: Version control with Git (5 minutes) </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="el" href="tutorial.html">Up: Kaldi tutorial</a> <br/>
 <a class="el" href="tutorial_setup.html">Previous: Getting started</a> <br/>
 <a class="el" href="tutorial_looking.html">Next: Overview of the distribution</a> <br/>
</p>
<p>Git is a distributed version control system. This means that, unlike Subversion, there are multiple copies of the repository, and the changes are transferred between these copies in multiple different ways explicitly, but most of the time one's work is backed by a single copy of the repository. Because of this multiplicity of copies, there are multiple possible <em>workflows</em> that you may want to follow. Here's one we think best suits you if you just want to <em>compile and use</em> Kaldi at first, but then at some point optionally decide to <em>contribute</em> your work back to the project.</p>
<h1><a class="anchor" id="tutorial_git_git_setup"></a>
First-time Git setup</h1>
<p>If you have never used Git before, <a href="https://git-scm.com/book/en/v2/Getting-Started-First-Time-Git-Setup">perform some minimal configuration first</a>. At the very least, set up your name and e-mail address:</p>
<pre class="fragment">$ git config --global user.name "John Doe"
$ git config --global user.email johndoe@example.com
</pre><p>Also, set short names for the most useful git commands you type most often.</p>
<pre class="fragment">$ git config --global alias.co checkout
$ git config --global alias.br branch
$ git config --global alias.st status
</pre><p>Another very useful utility comes with <code>git-prompts.sh</code>, a bash prompt extension utility for Git (if you do not have it, search the internet how to install it on your system). When installed, it provides a shell function <code>__git_ps1</code> that, when added to the prompt, expands into the current branch name and pending commit markers, so you do not forget where you are. You may modify your <code>PS1</code> shell variable so that it includes literally <code>$(__git_ps1 "[%s]")</code>. I have this in my <code>~/</code>.bashrc:</p>
<div class="fragment"><div class="line">PS1=<span class="stringliteral">&#39;\[\033[00;32m\]\u@\h\[\033[0m\]:\[\033[00;33m\]\w\[\033[01;36m\]$(__git_ps1 &quot;[%s]&quot;)\[\033[01;33m\]\$\[\033[00m\] &#39;</span></div>
<div class="line">export GIT_PS1_SHOWDIRTYSTATE=<span class="keyword">true</span> GIT_PS1_SHOWSTASHSTATE=<span class="keyword">true</span></div>
<div class="line"><span class="preprocessor"># fake __git_ps1 when git-prompts.sh not installed</span></div>
<div class="line"><span class="preprocessor"></span><span class="keywordflow">if</span> [ <span class="stringliteral">&quot;$(type -t __git_ps1)&quot;</span> == <span class="stringliteral">&quot;&quot;</span> ]; then</div>
<div class="line">  <span class="keyword">function</span> __git_ps1() { :; }</div>
<div class="line">fi</div>
</div><!-- fragment --><h1><a class="anchor" id="tutorial_git_workflow"></a>
The User Workflow</h1>
<p>Set up your repository and the working directory with this command:</p>
<pre class="fragment">kkm@yupana:~$ git clone https://github.com/kaldi-asr/kaldi.git --branch master --single-branch --origin golden
Cloning into 'kaldi'...
remote: Counting objects: 51770, done.
remote: Compressing objects: 100% (8/8), done.
remote: Total 51770 (delta 2), reused 0 (delta 0), pack-reused 51762
Receiving objects: 100% (51770/51770), 67.72 MiB | 6.52 MiB/s, done.
Resolving deltas: 100% (41117/41117), done.
Checking connectivity... done.
kkm@yupana:~$ cd kaldi/
kkm@yupana:~/kaldi[master]$
</pre><p>Now, you are ready to configure and compile Kaldi and work with it. Once in a while you want the latest changes in your local branch. This is akin to what you usually did with <code>svn update</code>.</p>
<p>But please first let's agree to one thing: you do not commit any files on the master branch. We'll get to that below. So far, you are only using the code. It will be hard to untangle if you do not follow the rule, and Git is so amazingly easy at branching, that you always want to do your work on a branch.</p>
<pre class="fragment">kkm@yupana:~/kaldi[master]$ git pull golden
remote: Counting objects: 148, done.
remote: Compressing objects: 100% (55/55), done.
remote: Total 148 (delta 111), reused 130 (delta 93), pack-reused 0
Receiving objects: 100% (148/148), 18.39 KiB | 0 bytes/s, done.
Resolving deltas: 100% (111/111), completed with 63 local objects.
From https://github.com/kaldi-asr/kaldi
   658e1b4..827a5d6  master     -&gt; golden/master
</pre><p>The command you use is <code>git pull</code>, and <code>golden</code> is the alias we used to designate the main replica of the Kaldi repository before.</p>
<h1><a class="anchor" id="tutorial_git_contributor"></a>
From User To Contributor</h1>
<p>At some point you decided to change Kaldi code, be it scripts or source. Maybe you made a simple bug fix. Maybe you are contributing a whole recipe. In any case, your always do your work on a branch. Even if you have uncommitted changes, Git handles that. For example, you just realized that the <code>fisher_english</code> recipe does not actually make use of <code>hubscr.pl</code> for scoring, but checks it exists and fails. You quickly fixed that in your work tree and want to share this change with the project.</p>
<h2><a class="anchor" id="tutorial_git_branch"></a>
Work locally on a branch</h2>
<pre class="fragment">kkm@yupana:~/kaldi[master *]$ git fetch golden
kkm@yupana:~/kaldi[master *]$ git co golden/master -b fishfix --no-track
M       fisher_english/s5/local/score.sh
Branch fishfix set up to track remote branch master from golden.
Switched to a new branch 'fishfix'
kkm@yupana:~/kaldi[myfix *]$
</pre><p>So what we did here, we first <em>fetched</em> the current changes to the golden repository to your machine. This did not update your master (in fact, you cannot pull if you have local worktree changes), but did update the remote reference <code>golden/master</code>. In the second command, we forked off a branch in your local repository, called <code>fishfix</code>. Was it more logical to branch off <code>master</code>? Not at all! First, this is one operation more. You do not *need* to update the master, so why would you? Second, we agreed (remember?) that master will have no changes, and you had some. Third, and believe me, this happens, you might have committed something to your master by mistake, and you do not want to bring this feral change into your new branch.</p>
<p>Now you examine your changes, and, since they are good, you commit them:</p>
<div class="fragment"><div class="line">kkm@yupana:~/kaldi[fishfix *]$ git diff</div>
<div class="line">diff --git a/egs/fisher_english/s5/local/score.sh b/egs/fisher_english/s5/local/score.sh</div>
<div class="line">index 60e4706..552fada 100755</div>
<div class="line">--- a/egs/fisher_english/s5/local/score.sh</div>
<div class="line">+++ b/egs/fisher_english/s5/local/score.sh</div>
<div class="line">@@ -27,10 +27,6 @@ dir=$3</div>
<div class="line"></div>
<div class="line"> model=$dir/../<span class="keyword">final</span>.mdl # assume model one level up from decoding dir.</div>
<div class="line"></div>
<div class="line">-hubscr=$KALDI_ROOT/tools/sctk/bin/hubscr.pl</div>
<div class="line">-[ ! -f $hubscr ] &amp;&amp; echo <span class="stringliteral">&quot;Cannot find scoring program at $hubscr&quot;</span> &amp;&amp; exit 1;</div>
<div class="line">-hubdir=`dirname $hubscr`</div>
<div class="line">-</div>
<div class="line"> <span class="keywordflow">for</span> f in $data/text $lang/<a class="code" href="arpa-file-parser-test_8cc.html#a1e047defc56305925400c84666b87df3">words</a>.txt $dir/lat.1.gz; <span class="keywordflow">do</span></div>
<div class="line">   [ ! -f $f ] &amp;&amp; echo <span class="stringliteral">&quot;$0: expecting file $f to exist&quot;</span> &amp;&amp; exit 1;</div>
<div class="line"> done</div>
<div class="line">kkm@yupana:~/kaldi[fishfix *]$ git commit -am <span class="stringliteral">&#39;fisher_english scoring does not really need hubscr.pl from sctk.&#39;</span></div>
<div class="line">[fishfix d7d76fe] fisher_english scoring does not really need hubscr.pl from sctk.</div>
<div class="line"> 1 file changed, 4 deletions(-)</div>
<div class="line">kkm@yupana:~/kaldi[fishfix]$</div>
</div><!-- fragment --><p>Note that the <code>-a</code> switch to <code>git commit</code> makes it commit all modified files (we had only one changed, so why not?). If you want to separate file modifications into multiple features to submit separately, <code>git add</code> specific files followed by <code>git commit</code> without the <code>-a</code> switch, and then start another branch off the same point as the first one for the next fix: <code>git co golden/master -b another-fix &ndash;no-track</code>, where you could add and commit other changed files. With Git, it is not uncommon to have a dozen branches going. Remember that it is extremely easy to combine multiple feature branches into one, but splitting one large changeset into many smaller features involves more work.</p>
<p>Now you need to create a pull request to the maintaners of Kaldi, so that they can pull the change from your repository. For that, <em>your repository</em> needs to be available online to them. And for that, you need a GitHub account.</p>
<h2><a class="anchor" id="tutorial_git_github_setup"></a>
One-time GitHub setup</h2>
<ul>
<li>Go to <a href="https://github.com/kaldi-asr/kaldi">main Kaldi repository page</a> and click on the Fork button. If you do not have an account, GitHub will lead you through necessary steps. </li>
<li><a href="https://help.github.com/articles/generating-ssh-keys/">Generate and register an SSH key</a> with GitHub so that GitHub can identify you. Everyone can read everything on GitHub, but only you can write to your forked repository!</li>
</ul>
<h2><a class="anchor" id="pull_request"></a>
Creating a pull request</h2>
<p>Make sure your fork is registered under the name <code>origin</code> (the alias is arbitrary, this is what we'll use here). If not, add it. The URL is listed on your repository page under "SSH clone URL", and looks like <code><a href="#" onclick="location.href='mai'+'lto:'+'git'+'@g'+'ith'+'ub'+'.co'+'m'; return false;">git@g<span style="display: none;">.nosp@m.</span>ithu<span style="display: none;">.nosp@m.</span>b.com</a>:YOUR_USER_NAME/kaldi.git</code>.</p>
<pre class="fragment">kkm@yupana:~/kaldi[fishfix]$ git remote -v
golden  https://github.com/kaldi-asr/kaldi.git (fetch)
golden  https://github.com/kaldi-asr/kaldi.git (push)
kkm@yupana:~/kaldi[fishfix]$ git remote add origin git@github.com:kkm000/kaldi.git
kkm@yupana:~/kaldi[fishfix]$ git remote -v
golden  https://github.com/kaldi-asr/kaldi.git (fetch)
golden  https://github.com/kaldi-asr/kaldi.git (push)
origin  git@github.com:kkm000/kaldi.git (fetch)
origin  git@github.com:kkm000/kaldi.git (push)
</pre><p>Now push the branch into your fork of Kaldi:</p>
<pre class="fragment">kkm@yupana:~/kaldi[fishfix]$ git push origin HEAD -u
Counting objects: 632, done.
Delta compression using up to 12 threads.
Compressing objects: 100% (153/153), done.
Writing objects: 100% (415/415), 94.45 KiB | 0 bytes/s, done.
Total 415 (delta 324), reused 326 (delta 262)
To git@github.com:kkm000/kaldi.git
 * [new branch]      HEAD -&gt; fishfix
Branch fishfix set up to track remote branch fishfix from origin.
</pre><p><code>HEAD</code> in <code>git push</code> tells Git "create branch in the remote repo with
the same name as the current branch", and <code>-u</code> remembers the connection between your local branch <code>fishfix</code> and <code>origin/fishfix</code> in your repository.</p>
<p>Now go to your repository page and <a href="https://help.github.com/articles/creating-a-pull-request/">create a pull request</a>. <a href="https://github.com/kaldi-asr/kaldi/pull/31">Examine your changes</a>, and submit the request if everything looks good. The maintainers will receive the request and either accept it or comment on it. Follow the comments, commit fixes on your branch, push to <code>origin</code> again, and GitHub will automatically update the pull request web page. Then reply e. g. "Done" under the comments that you received, so that they know you followed up on their comments.</p>
<p>If you are creating a pull request only for a review of an incomplete piece of work, which makes sense and is encouraged if you want early feedback on a proposed feature, begin the title of your pull request with the prefix <code>WIP:</code>. This will tell the maintainers not to merge the pull request yet. When you push more commits to your branch, they automatically show in the pull request. When you think the work is complete, edit the pull request title to remove the <code>WIP</code> prefix and then add a comment to this effect, so that the maintainers are notified.</p>
<p><a class="el" href="tutorial.html">Up: Kaldi tutorial</a> <br/>
 <a class="el" href="tutorial_setup.html">Previous: Getting started</a> <br/>
 <a class="el" href="tutorial_looking.html">Next: Overview of the distribution</a> <br/>
 </p>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="index.html">Kaldi</a></li><li class="navelem"><a class="el" href="tutorial.html">Kaldi tutorial</a></li>
    <li class="footer">Generated on Thu Apr 28 2016 15:42:38 for Kaldi by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
